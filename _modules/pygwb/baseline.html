<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>pygwb.baseline &mdash; pygwb 1.3 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=fa44fd50" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../../_static/tabs.css?v=a5c4661c" />

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js?v=0264ad83"></script>
        <script src="../../_static/doctools.js?v=888ff710"></script>
        <script src="../../_static/sphinx_highlight.js?v=4825356b"></script>
        <script src="../../_static/tabs.js?v=3030b3cb"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="author" title="About these documents" href="../../about.html" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html">
            
              <img src="../../_static/pygwb_logo_plasma_cropped.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                1.3
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../about.html">About <code class="docutils literal notranslate"><span class="pre">pygwb</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorials.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../demos.html">Demos</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api.html">API</a></li>
<li class="toctree-l1"><a class="reference external" href="https://arxiv.org/pdf/2303.15696.pdf">pygwb paper</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../citing.html">Citing <code class="docutils literal notranslate"><span class="pre">pygwb</span></code></a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/a-renzini/pygwb">GitHub</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contributing.html">Contributing guide</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/a-renzini/pygwb/issues/new">Submit an issue</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">pygwb</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Module code</a></li>
      <li class="breadcrumb-item active">pygwb.baseline</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for pygwb.baseline</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">The ``Baseline`` module is by design the core of the pygwb stochastic analysis. Its main role is to manage the cross-</span>
<span class="sd">correlation between ``Interferometer`` data products, combine these into a single cross-spectrum, which represents the</span>
<span class="sd">point estimate of the analysis, and calculate the associated error.</span>

<span class="sd">The ``Baseline`` object relies on the ``pygwb.spectral`` module to calculate cross-correlations between the data</span>
<span class="sd">streams. Similarly, it relies on the ``pygwb.postprocessing`` module to obtain the point estimate and its variance.</span>
<span class="sd">Calculating these, as well as performing parameter estimation on the gravitational-wave background (GWB) spectrum, requires the two-detector</span>
<span class="sd">overlap reduction function (ORF). The ORF is calculated using the ``pygwb.orfs`` module at ``Baseline`` object </span>
<span class="sd">initialization, then stored as an attribute.</span>

<span class="sd">Examples</span>
<span class="sd">--------</span>

<span class="sd">To show how a ``Baseline`` object can be instantiated, we start by importing the relevant</span>
<span class="sd">packages:</span>

<span class="sd">&gt;&gt;&gt; import numpy as np</span>
<span class="sd">&gt;&gt;&gt; from pygwb.detector import Interferometer</span>
<span class="sd">&gt;&gt;&gt; from pygwb.baseline import Baseline</span>

<span class="sd">For concreteness, we work with the LIGO Hanford and Livingston detectors, which we </span>
<span class="sd">instantiate through:</span>

<span class="sd">&gt;&gt;&gt; H1 = Interferometer.get_empty_interferometer(&quot;H1&quot;)</span>
<span class="sd">&gt;&gt;&gt; L1 = Interferometer.get_empty_interferometer(&quot;L1&quot;)</span>

<span class="sd">The standard initialization of a ``Baseline`` object then simply requires a pair of </span>
<span class="sd">``Interferometer`` objects:</span>

<span class="sd">&gt;&gt;&gt; H1L1_baseline = baseline.Baseline(&quot;H1-L1&quot;, H1, L1)</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">pickle</span>
<span class="kn">import</span> <span class="nn">warnings</span>

<span class="kn">import</span> <span class="nn">h5py</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">gwpy.frequencyseries</span> <span class="kn">import</span> <span class="n">FrequencySeries</span>
<span class="kn">from</span> <span class="nn">loguru</span> <span class="kn">import</span> <span class="n">logger</span>

<span class="kn">from</span> <span class="nn">.coherence</span> <span class="kn">import</span> <span class="n">calculate_coherence</span>
<span class="kn">from</span> <span class="nn">.constants</span> <span class="kn">import</span> <span class="n">h0</span>
<span class="kn">from</span> <span class="nn">.delta_sigma_cut</span> <span class="kn">import</span> <span class="n">run_dsc</span>
<span class="kn">from</span> <span class="nn">.notch</span> <span class="kn">import</span> <span class="n">StochNotchList</span>
<span class="kn">from</span> <span class="nn">.omega_spectra</span> <span class="kn">import</span> <span class="n">OmegaSpectrogram</span><span class="p">,</span> <span class="n">OmegaSpectrum</span>
<span class="kn">from</span> <span class="nn">.orfs</span> <span class="kn">import</span> <span class="n">calc_orf</span>
<span class="kn">from</span> <span class="nn">.postprocessing</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">calc_Y_sigma_from_Yf_sigmaf</span><span class="p">,</span>
    <span class="n">calculate_point_estimate_sigma_spectra</span><span class="p">,</span>
    <span class="n">postprocess_Y_sigma</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">.spectral</span> <span class="kn">import</span> <span class="n">cross_spectral_density</span>


<div class="viewcode-block" id="Baseline"><a class="viewcode-back" href="../../api/pygwb.baseline.Baseline.html#pygwb.baseline.Baseline">[docs]</a><span class="k">class</span> <span class="nc">Baseline</span><span class="p">:</span>
<div class="viewcode-block" id="Baseline.__init__"><a class="viewcode-back" href="../../api/pygwb.baseline.Baseline.html#pygwb.baseline.Baseline.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">name</span><span class="p">,</span>
        <span class="n">interferometer_1</span><span class="p">,</span>
        <span class="n">interferometer_2</span><span class="p">,</span>
        <span class="n">duration</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">frequencies</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">calibration_epsilon</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">notch_list_path</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">coarse_grain_psd</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">coarse_grain_csd</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">overlap_factor_welch</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
        <span class="n">overlap_factor</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
        <span class="n">window_fftgram_dict</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;window_fftgram&quot;</span><span class="p">:</span> <span class="s2">&quot;hann&quot;</span><span class="p">},</span>
        <span class="n">window_fftgram_dict_welch</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;window_fftgram&quot;</span><span class="p">:</span> <span class="s2">&quot;hann&quot;</span><span class="p">},</span>
        <span class="n">N_average_segments_psd</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
        <span class="n">sampling_frequency</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Instantiate a Baseline.</span>

<span class="sd">        Parameters</span>
<span class="sd">        =======</span>

<span class="sd">        name: ``str``</span>
<span class="sd">            Name for the baseline, e.g H1H2</span>
<span class="sd">        interferometer_1/2: ``bilby.Interferometer`` object</span>
<span class="sd">            The two detectors spanning the baseline.</span>
<span class="sd">        duration: ``float``, optional</span>
<span class="sd">            The duration in seconds of each data segment in the interferometers.</span>
<span class="sd">            None by default, in which case duration is inherited from the interferometers.</span>
<span class="sd">        frequencies: ``array_like``, optional</span>
<span class="sd">            The frequency array for the Baseline and</span>
<span class="sd">            interferometers.</span>
<span class="sd">        calibration_epsilon: ``float``, optional</span>
<span class="sd">            Calibration uncertainty for this baseline.</span>
<span class="sd">        notch_list_path: ``str``, optional</span>
<span class="sd">            File path of the baseline notch list.</span>
<span class="sd">        coarse_grain_psd: ``bool``, optional</span>
<span class="sd">            Whether to apply coarse graining to obtain PSD spectra. Default is False.</span>
<span class="sd">        coarse_grain_csd: ``bool``, optional</span>
<span class="sd">            Whether to apply coarse graining to obtain CSD spectra. Default is True.</span>
<span class="sd">        overlap_factor_welch: ``float``, optional</span>
<span class="sd">            Overlap factor to use when if using Welch&#39;s method to estimate spectra (NOT coarsegraining). </span>
<span class="sd">            For \&quot;hann\&quot; window use 0.5 overlap_factor and for \&quot;boxcar&quot;\ window use 0 overlap_factor. Default is 0.5 (50% overlap), </span>
<span class="sd">            which is optimal when using Welch&#39;s method with a \&quot;hann\&quot; window.</span>
<span class="sd">        overlap_factor: ``float``, optional</span>
<span class="sd">            Factor by which to overlap the segments in the psd and csd estimation.</span>
<span class="sd">            Default is 1/2, if set to 0 no overlap is performed.</span>
<span class="sd">        window_fftgram_dict: ``dict``, optional</span>
<span class="sd">            Dictionary containing name and parameters describing which window to use when producing fftgrams for csds (and psds if these are coarse-grained). Default is \&quot;hann\&quot;.</span>
<span class="sd">        window_fftgram_dict_welch: ``dict``, optional</span>
<span class="sd">            Dictionary containing name and parameters describing which window to use when producing fftgrams with Welch&#39;s method. Default is \&quot;hann\&quot;.</span>
<span class="sd">        N_average_segments_psd: ``int``, optional</span>
<span class="sd">            Number of segments used for PSD averaging (from both sides of the segment of interest)</span>
<span class="sd">            N_avg_segs should be even and &gt;= 2.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interferometer_1</span> <span class="o">=</span> <span class="n">interferometer_1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interferometer_2</span> <span class="o">=</span> <span class="n">interferometer_2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">calibration_epsilon</span> <span class="o">=</span> <span class="n">calibration_epsilon</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">notch_list_path</span> <span class="o">=</span> <span class="n">notch_list_path</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">coarse_grain_psd</span> <span class="o">=</span> <span class="n">coarse_grain_psd</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">coarse_grain_csd</span> <span class="o">=</span> <span class="n">coarse_grain_csd</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">overlap_factor_welch</span> <span class="o">=</span> <span class="n">overlap_factor_welch</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">overlap_factor</span> <span class="o">=</span> <span class="n">overlap_factor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">window_fftgram_dict</span> <span class="o">=</span> <span class="n">window_fftgram_dict</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">window_fftgram_dict_welch</span> <span class="o">=</span> <span class="n">window_fftgram_dict_welch</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">N_average_segments_psd</span> <span class="o">=</span> <span class="n">N_average_segments_psd</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tensor_orf_calculated</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_vector_orf_calculated</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_scalar_orf_calculated</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_gamma_v_calculated</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_orf_polarization_set</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_point_estimate_spectrogram_set</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_point_estimate_spectrum_set</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_point_estimate_set</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sigma_spectrogram_set</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sigma_spectrum_set</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sigma_set</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_coherence_spectrum_set</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sampling_frequency</span> <span class="o">=</span> <span class="n">sampling_frequency</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">duration</span> <span class="o">=</span> <span class="n">duration</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frequencies</span> <span class="o">=</span> <span class="n">frequencies</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">minimum_frequency</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span>
            <span class="n">interferometer_1</span><span class="o">.</span><span class="n">minimum_frequency</span><span class="p">,</span> <span class="n">interferometer_2</span><span class="o">.</span><span class="n">minimum_frequency</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">maximum_frequency</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span>
            <span class="n">interferometer_1</span><span class="o">.</span><span class="n">maximum_frequency</span><span class="p">,</span> <span class="n">interferometer_2</span><span class="o">.</span><span class="n">maximum_frequency</span>
        <span class="p">)</span>
        <span class="c1"># if CSD is estimated by coarse-graining, it must be zeropaded. </span>
        <span class="bp">self</span><span class="o">.</span><span class="n">zeropad_csd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">coarse_grain_csd</span>
        <span class="c1"># if PSD is estimated by coarse-graining, no overlap is used between PSD estimates. This is required for the bias factor calculation.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">coarse_grain_psd</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">overlap_factor_psd</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">window_fftgram_dict_psd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">window_fftgram_dict</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">window_fftgram_dict_for_bias_factors</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;window_fftgram&quot;</span><span class="p">:</span> <span class="s2">&quot;boxcar&quot;</span><span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">overlap_factor_psd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">overlap_factor_welch</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">window_fftgram_dict_psd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">window_fftgram_dict_welch</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">window_fftgram_dict_for_bias_factors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">window_fftgram_dict_psd</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">coarse_grain_csd</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">window_fftgram_dict_csd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">window_fftgram_dict</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">window_fftgram_dict_csd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">window_fftgram_dict_welch</span>
        <span class="c1"># throw a warning if overlap factors are unsupported</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">overlap_factor</span><span class="o">&gt;</span><span class="mf">0.5</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Overlap factor not fully supported. Overlap factor should be overlap_factor &lt;= 0.5.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">overlap_factor_welch</span><span class="o">&gt;</span><span class="mf">0.5</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Overlap factor for spectral estimation using Welch&#39;s method not fully supported. Overlap factor should be overlap_factor_welch &lt;= 0.5.&quot;</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">==</span> <span class="nb">type</span><span class="p">(</span><span class="n">other</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">all</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span> <span class="o">==</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span>
                        <span class="s2">&quot;name&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;interferometer_1&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;interferometer_2&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;calibration_epsilon&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;duration&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;frequencies&quot;</span><span class="p">,</span>
                    <span class="p">]</span>
                <span class="p">]</span>
            <span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">overlap_reduction_function</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Overlap reduction function associated to this baseline, calculated for the requested polarization.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_orf_polarization</span> <span class="o">==</span> <span class="s2">&quot;tensor&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">tensor_overlap_reduction_function</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_orf_polarization</span> <span class="o">==</span> <span class="s2">&quot;vector&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">vector_overlap_reduction_function</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_orf_polarization</span> <span class="o">==</span> <span class="s2">&quot;scalar&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">scalar_overlap_reduction_function</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_orf_polarization</span> <span class="o">==</span> <span class="s2">&quot;right_left&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">gamma_v</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span>
                <span class="s2">&quot;Overlap reduction function to be used has not yet been set. To set it, set the orf_polarization property.&quot;</span>
            <span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">orf_polarization</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Overlap reduction function polarization&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_orf_polarization_set</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_orf_polarization</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span>
                <span class="s2">&quot;Overlap reduction function polarization han not yet been set.&quot;</span>
            <span class="p">)</span>

    <span class="nd">@orf_polarization</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">orf_polarization</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pol</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_orf_polarization</span> <span class="o">=</span> <span class="n">pol</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_orf_polarization_set</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">tensor_overlap_reduction_function</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Overlap reduction function calculated for tensor polarization.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tensor_orf_calculated</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_tensor_orf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calc_baseline_orf</span><span class="p">(</span>
                <span class="n">polarization</span><span class="o">=</span><span class="s2">&quot;tensor&quot;</span><span class="p">,</span> <span class="n">frequencies</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">frequencies</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_tensor_orf_calculated</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tensor_orf</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">vector_overlap_reduction_function</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Overlap reduction function calculated for vector polarization.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vector_orf_calculated</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_vector_orf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calc_baseline_orf</span><span class="p">(</span><span class="n">polarization</span><span class="o">=</span><span class="s2">&quot;vector&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_vector_orf_calculated</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vector_orf</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">scalar_overlap_reduction_function</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Overlap reduction function calculated for scalar polarization.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scalar_orf_calculated</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_scalar_orf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calc_baseline_orf</span><span class="p">(</span><span class="n">polarization</span><span class="o">=</span><span class="s2">&quot;scalar&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_scalar_orf_calculated</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scalar_orf</span>

<div class="viewcode-block" id="Baseline.set_frequency_mask"><a class="viewcode-back" href="../../api/pygwb.baseline.Baseline.html#pygwb.baseline.Baseline.set_frequency_mask">[docs]</a>    <span class="k">def</span> <span class="nf">set_frequency_mask</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">notch_list_path</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">apply_notches</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set frequency mask to frequencies attribute.</span>

<span class="sd">        Parameters</span>
<span class="sd">        =======</span>

<span class="sd">        notch_list_path: ``str``, optional</span>
<span class="sd">            Path to notch list to apply to frequency array. If not </span>
<span class="sd">            provided, no notching will be applied at this point.</span>

<span class="sd">        apply_notches: ``bool``, optional</span>
<span class="sd">            If True, apply frequency notches. Default is True.</span>

<span class="sd">        See also</span>
<span class="sd">        --------</span>
<span class="sd">        pygwb.notch.StochNotchList : Used to read in the frequency notches.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frequencies</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">minimum_frequency</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">frequencies</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">maximum_frequency</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">apply_notches</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">notch_list_path</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">notch_list_path</span> <span class="o">=</span> <span class="n">notch_list_path</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">notch_list_path</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;loading notches from &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">notch_list_path</span><span class="p">))</span>
                <span class="n">notch_list</span> <span class="o">=</span> <span class="n">StochNotchList</span><span class="o">.</span><span class="n">load_from_file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">notch_list_path</span><span class="p">)</span>
                <span class="n">notch_mask</span> <span class="o">=</span> <span class="n">notch_list</span><span class="o">.</span><span class="n">get_notch_mask</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frequencies</span><span class="p">)</span>
                <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">notch_mask</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;no notching will be applied at this point.&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">frequency_mask</span> <span class="o">=</span> <span class="n">mask</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">gamma_v</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frequencies</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Overlap reduction function for asymmetrically polarised backgrounds,</span>
<span class="sd">        as described in https://arxiv.org/pdf/0707.0535.pdf</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_gamma_v_calculated</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_gamma_v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calc_baseline_orf</span><span class="p">(</span><span class="n">polarization</span><span class="o">=</span><span class="s2">&quot;right_left&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_gamma_v_calculated</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_gamma_v</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">duration</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Duration in seconds of a unit segment of data stored in the baseline detectors.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_duration_set</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_duration</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s2">&quot;Duration not yet set.&quot;</span><span class="p">)</span>

    <span class="nd">@duration</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">duration</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dur</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the duration for the Baseline and interferometers.</span>

<span class="sd">        Parameters</span>
<span class="sd">        =======</span>
<span class="sd">        dur: ``float``</span>
<span class="sd">            The duration to set for the Baseline and interferometers.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>

<span class="sd">        If `duration` is passed, check that it matches the `duration`</span>
<span class="sd">        in the interferometers, if present.</span>
<span class="sd">        If not passed, check that the durations in the interferometers</span>
<span class="sd">        match each other, if present, and set the Baseline duration from</span>
<span class="sd">        the interferometer durations.</span>
<span class="sd">        If not passed and only one of the interferometers has the duration</span>
<span class="sd">        set, set the Baseline duration and duration for the other</span>
<span class="sd">        interferometer from that.</span>
<span class="sd">        Requires that either `duration` is not None or at least one of the</span>
<span class="sd">        interferometers has the `duration` set.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">dur</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_check_durations_match_baseline_ifos</span><span class="p">(</span><span class="n">dur</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_duration</span> <span class="o">=</span> <span class="n">dur</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">interferometer_1</span><span class="o">.</span><span class="n">duration</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">interferometer_1</span><span class="o">.</span><span class="n">duration</span> <span class="o">=</span> <span class="n">dur</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">interferometer_2</span><span class="o">.</span><span class="n">duration</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">interferometer_2</span><span class="o">.</span><span class="n">duration</span> <span class="o">=</span> <span class="n">dur</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_duration_set</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">interferometer_1</span><span class="o">.</span><span class="n">duration</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">interferometer_2</span><span class="o">.</span><span class="n">duration</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_check_ifo_durations_match</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">duration</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">interferometer_1</span><span class="o">.</span><span class="n">duration</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_duration_set</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">interferometer_1</span><span class="o">.</span><span class="n">duration</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">duration</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">interferometer_1</span><span class="o">.</span><span class="n">duration</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">interferometer_2</span><span class="o">.</span><span class="n">duration</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">interferometer_1</span><span class="o">.</span><span class="n">duration</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_duration_set</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">interferometer_2</span><span class="o">.</span><span class="n">duration</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">duration</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">interferometer_2</span><span class="o">.</span><span class="n">duration</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">interferometer_1</span><span class="o">.</span><span class="n">duration</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">interferometer_2</span><span class="o">.</span><span class="n">duration</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_duration_set</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Neither baseline nor interferometer duration is set.&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_duration</span> <span class="o">=</span> <span class="n">dur</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_duration_set</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">csd_segment_offset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;CSD segment offset to use for this baseline.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_duration_set</span><span class="p">:</span>
            <span class="n">stride</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">duration</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">overlap_factor</span><span class="p">)</span>
            <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">duration</span> <span class="o">/</span> <span class="n">stride</span><span class="p">))</span> <span class="o">*</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N_average_segments_psd</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Trying to calculate CSD segment offset before setting duration. Need to set duration before attempting this.&quot;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">frequencies</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Frequency array associated to this baseline.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_frequencies_set</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_frequencies</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s2">&quot;frequencies have not yet been set.&quot;</span><span class="p">)</span>

    <span class="nd">@frequencies</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">frequencies</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">freqs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_frequencies</span> <span class="o">=</span> <span class="n">freqs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_frequencies_set</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frequency_mask</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># delete the orfs, set the calculated flag to zero</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tensor_orf_calculated</span><span class="p">:</span>
            <span class="nb">delattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_tensor_orf&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_tensor_orf_calculated</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scalar_orf_calculated</span><span class="p">:</span>
            <span class="nb">delattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_scalar_orf&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_scalar_orf_calculated</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vector_orf_calculated</span><span class="p">:</span>
            <span class="nb">delattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_vector_orf&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_vector_orf_calculated</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">point_estimate_spectrogram</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Point estimate spectrogram (in Omega units) calculated using data in this baseline.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_point_estimate_spectrogram_set</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_point_estimate_spectrogram</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span>
                <span class="s2">&quot;Omega point estimate spectrogram not yet set. To set it, use `set_point_estimate_sigma_spectrogram` method.&quot;</span>
            <span class="p">)</span>

    <span class="nd">@point_estimate_spectrogram</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">point_estimate_spectrogram</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pt_est</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_point_estimate_spectrogram</span> <span class="o">=</span> <span class="n">pt_est</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_point_estimate_spectrogram_set</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">sigma_spectrogram</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Sigma spectrogram (in Omega units) calculated using data in this baseline.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sigma_spectrogram_set</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sigma_spectrogram</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span>
                <span class="s2">&quot;Omega sigma spectrogram not yet set. To set it, use `set_point_estimate_sigma_spectrogram` method.&quot;</span>
            <span class="p">)</span>

    <span class="nd">@sigma_spectrogram</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">sigma_spectrogram</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sig</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sigma_spectrogram</span> <span class="o">=</span> <span class="n">sig</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sigma_spectrogram_set</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">point_estimate_spectrum</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Point estimate spectrum (in Omega units) calculated using data in this baseline.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_point_estimate_spectrum_set</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_point_estimate_spectrum</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span>
                <span class="s2">&quot;Omega point estimate spectrum not yet set. To set it, use `set_point_estimate_sigma_spectrum` method.&quot;</span>
            <span class="p">)</span>

    <span class="nd">@point_estimate_spectrum</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">point_estimate_spectrum</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pt_est</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_point_estimate_spectrum</span> <span class="o">=</span> <span class="n">pt_est</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_point_estimate_spectrum_set</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">sigma_spectrum</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Sigma spectrum (in Omega units) calculated using data in this baseline.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sigma_spectrum_set</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sigma_spectrum</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span>
                <span class="s2">&quot;Omega sigma spectrum not yet set. To set it, use `set_point_estimate_sigma_spectrum` method.&quot;</span>
            <span class="p">)</span>

    <span class="nd">@sigma_spectrum</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">sigma_spectrum</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sig</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sigma_spectrum</span> <span class="o">=</span> <span class="n">sig</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sigma_spectrum_set</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">point_estimate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Point estimate (in Omega units) calculated using data in this baseline.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_point_estimate_set</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_point_estimate</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span>
                <span class="s2">&quot;Omega point estimate not yet set. To set it, use `set_point_estimate_sigma` method.&quot;</span>
            <span class="p">)</span>

    <span class="nd">@point_estimate</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">point_estimate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pt_est</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_point_estimate</span> <span class="o">=</span> <span class="n">pt_est</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_point_estimate_set</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">sigma</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Sigma (in Omega units) calculated using data in this baseline.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sigma_set</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sigma</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span>
                <span class="s2">&quot;Omega sigma not yet set. To set it, use `set_point_estimate_sigma` method.&quot;</span>
            <span class="p">)</span>

    <span class="nd">@sigma</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">sigma</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sig</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sigma</span> <span class="o">=</span> <span class="n">sig</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sigma_set</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">coherence_spectrum</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Coherence spectrum calculated using data in this baseline.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_coherence_spectrum_set</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_coherence_spectrum</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span>
                <span class="s2">&quot;Coherence spectrum not yet set. To set it, use `set_coherence_spectrum` method.&quot;</span>
            <span class="p">)</span>

    <span class="nd">@coherence_spectrum</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">coherence_spectrum</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">coh</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_coherence_spectrum</span> <span class="o">=</span> <span class="n">coh</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_coherence_spectrum_set</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">coherence_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Coherence dictionary based on data in this baseline.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_coherence_spectrum_set</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_coherence_dict</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span>
                <span class="s2">&quot;Coherence spectrum not yet set. To set it, use `set_coherence_spectrum` method.&quot;</span>
            <span class="p">)</span>

    <span class="nd">@coherence_dict</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">coherence_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cohdict</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_coherence_dict</span> <span class="o">=</span> <span class="n">cohdict</span>

    <span class="k">def</span> <span class="nf">_check_durations_match_baseline_ifos</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">duration</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks whether the baseline duration matches the duration set in </span>
<span class="sd">        the interferometers of the baseline.</span>

<span class="sd">        Parameters</span>
<span class="sd">        =======</span>

<span class="sd">        duration: ``float``</span>
<span class="sd">            Duration of the baseline.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">interferometer_1</span><span class="o">.</span><span class="n">duration</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">interferometer_2</span><span class="o">.</span><span class="n">duration</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_check_ifo_durations_match</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">duration</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">interferometer_1</span><span class="o">.</span><span class="n">duration</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span>
                    <span class="s2">&quot;Interferometer durations do not match given Baseline duration!&quot;</span>
                <span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">interferometer_1</span><span class="o">.</span><span class="n">duration</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">duration</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">interferometer_1</span><span class="o">.</span><span class="n">duration</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span>
                    <span class="s2">&quot;Interferometer_1 duration does not match given Baseline duration!&quot;</span>
                <span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">interferometer_2</span><span class="o">.</span><span class="n">duration</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">duration</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">interferometer_2</span><span class="o">.</span><span class="n">duration</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span>
                    <span class="s2">&quot;Interferometer_2 duration does not match given Baseline duration!&quot;</span>
                <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_check_ifo_durations_match</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks whether the duration in both interferometers agree.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">interferometer_1</span><span class="o">.</span><span class="n">duration</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">interferometer_2</span><span class="o">.</span><span class="n">duration</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span><span class="s2">&quot;Interferometer durations do not match each other!&quot;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">sampling_frequency</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Sampling frequency of the data stored in this baseline. This must match the</span>
<span class="sd">        sampling frequency stored in this baseline&#39;s interferometers.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_sampling_frequency&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sampling_frequency</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s2">&quot;sampling frequency not set.&quot;</span><span class="p">)</span>

    <span class="nd">@sampling_frequency</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">sampling_frequency</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sampling_frequency</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Sets the sampling_frequency for the Baseline and interferometers</span>

<span class="sd">        Parameters</span>
<span class="sd">        =======</span>

<span class="sd">        sampling_frequency: ``float``, optional</span>
<span class="sd">            The sampling frequency to set for the Baseline and interferometers</span>

<span class="sd">        Warning</span>
<span class="sd">        -------</span>

<span class="sd">        If `sampling_frequency` is passed, check that it matches the `sampling_frequency`</span>
<span class="sd">        in the interferometers, if present.</span>
<span class="sd">        If not passed, check that the sampling_frequencies in the interferometers</span>
<span class="sd">        match each other, if present, and set the Baseline sampling_frequency from</span>
<span class="sd">        the sampling_frequencies.</span>
<span class="sd">        If not passed and only one of the interferometers has the sampling_frequency</span>
<span class="sd">        set, set the Baseline sampling_frequency and sampling_frequency for the other</span>
<span class="sd">        interferometer from that.</span>
<span class="sd">        Requires that either `sampling_frequency` is not None or at least one of the</span>
<span class="sd">        interferometers has the `sampling_frequency` set.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">sampling_frequency</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">check_sampling_frequencies_match_baseline_ifos</span><span class="p">(</span><span class="n">sampling_frequency</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_sampling_frequency</span> <span class="o">=</span> <span class="n">sampling_frequency</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">interferometer_1</span><span class="o">.</span><span class="n">sampling_frequency</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">interferometer_1</span><span class="o">.</span><span class="n">sampling_frequency</span> <span class="o">=</span> <span class="n">sampling_frequency</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">interferometer_2</span><span class="o">.</span><span class="n">sampling_frequency</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">interferometer_2</span><span class="o">.</span><span class="n">sampling_frequency</span> <span class="o">=</span> <span class="n">sampling_frequency</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_sampling_frequency_set</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">interferometer_1</span><span class="o">.</span><span class="n">sampling_frequency</span>
            <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">interferometer_2</span><span class="o">.</span><span class="n">sampling_frequency</span>
        <span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_check_ifo_sampling_frequencies_match</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_sampling_frequency</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">interferometer_1</span><span class="o">.</span><span class="n">sampling_frequency</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_sampling_frequency_set</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">interferometer_1</span><span class="o">.</span><span class="n">sampling_frequency</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sampling_frequency</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">interferometer_1</span><span class="o">.</span><span class="n">sampling_frequency</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">interferometer_2</span><span class="o">.</span><span class="n">sampling_frequency</span> <span class="o">=</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">interferometer_1</span><span class="o">.</span><span class="n">sampling_frequency</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_sampling_frequency_set</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">interferometer_2</span><span class="o">.</span><span class="n">sampling_frequency</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_sampling_frequency</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">interferometer_2</span><span class="o">.</span><span class="n">sampling_frequency</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">interferometer_1</span><span class="o">.</span><span class="n">sampling_frequency</span> <span class="o">=</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">interferometer_2</span><span class="o">.</span><span class="n">sampling_frequency</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_sampling_frequency_set</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="s2">&quot;Neither baseline nor interferometer sampling_frequency is set.&quot;</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_sampling_frequency</span> <span class="o">=</span> <span class="n">sampling_frequency</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_sampling_frequency_set</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">badGPStimes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;GPS times flagged by delta sigma cut.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_badGPStimes&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_badGPStimes</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span>
                <span class="s2">&quot;bad GPS times are not set - need to run delta_sigma_cut first.&quot;</span>
            <span class="p">)</span>

    <span class="nd">@badGPStimes</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">badGPStimes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">badGPStimes</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_badGPStimes</span> <span class="o">=</span> <span class="n">badGPStimes</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">delta_sigmas</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Values of delta sigmas for data segments in the baseline.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_delta_sigmas&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_delta_sigmas</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span>
                <span class="s2">&quot;delta_sigmas are not set - need to run delta_sigma_cut first.&quot;</span>
            <span class="p">)</span>

    <span class="nd">@delta_sigmas</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">delta_sigmas</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">delta_sigmas</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_delta_sigmas</span> <span class="o">=</span> <span class="n">delta_sigmas</span>

<div class="viewcode-block" id="Baseline.check_sampling_frequencies_match_baseline_ifos"><a class="viewcode-back" href="../../api/pygwb.baseline.Baseline.html#pygwb.baseline.Baseline.check_sampling_frequencies_match_baseline_ifos">[docs]</a>    <span class="k">def</span> <span class="nf">check_sampling_frequencies_match_baseline_ifos</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sampling_frequency</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check that the sampling frequency of the two interferometers in this Baseline match the Baseline sampling frequency.</span>

<span class="sd">        Parameters</span>
<span class="sd">        =======</span>

<span class="sd">        sampling_frequency: ``float``</span>
<span class="sd">            The sampling frequency that is being set for the Baseline.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>

<span class="sd">        If the sampling frequency passed is `None`, the Baseline sampling frequency will be set to that of the interferometers, if these</span>
<span class="sd">        match. If these don&#39;t match, an error will be raised. If the sampling frequency of the interferometers is also `None`, then no</span>
<span class="sd">        sampling frequency will be set, and the user can set it at a later time.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">interferometer_1</span><span class="o">.</span><span class="n">sampling_frequency</span>
            <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">interferometer_2</span><span class="o">.</span><span class="n">sampling_frequency</span>
        <span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_check_ifo_sampling_frequencies_match</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">sampling_frequency</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">interferometer_1</span><span class="o">.</span><span class="n">sampling_frequency</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span>
                    <span class="s2">&quot;Interferometer sampling_frequencies do not match given Baseline sampling_frequency!&quot;</span>
                <span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">interferometer_1</span><span class="o">.</span><span class="n">sampling_frequency</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">sampling_frequency</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">interferometer_1</span><span class="o">.</span><span class="n">sampling_frequency</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span>
                    <span class="s2">&quot;Interferometer_1 sampling_frequency does not match given Baseline sampling_frequency!&quot;</span>
                <span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">interferometer_2</span><span class="o">.</span><span class="n">sampling_frequency</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">sampling_frequency</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">interferometer_2</span><span class="o">.</span><span class="n">sampling_frequency</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span>
                    <span class="s2">&quot;Interferometer_2 sampling_frequency does not match given Baseline sampling_frequency!&quot;</span>
                <span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_check_ifo_sampling_frequencies_match</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check whether the sampling frequencies of the interferometers match.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">interferometer_1</span><span class="o">.</span><span class="n">sampling_frequency</span>
            <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">interferometer_2</span><span class="o">.</span><span class="n">sampling_frequency</span>
        <span class="p">):</span>
            <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span>
                <span class="s2">&quot;Interferometer sampling_frequencies do not match each other!&quot;</span>
            <span class="p">)</span>

<div class="viewcode-block" id="Baseline.calc_baseline_orf"><a class="viewcode-back" href="../../api/pygwb.baseline.Baseline.html#pygwb.baseline.Baseline.calc_baseline_orf">[docs]</a>    <span class="k">def</span> <span class="nf">calc_baseline_orf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">polarization</span><span class="o">=</span><span class="s2">&quot;tensor&quot;</span><span class="p">,</span> <span class="n">frequencies</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate the overlap reduction function for this baseline.</span>
<span class="sd">        Wraps the ORF module.</span>

<span class="sd">        Parameters</span>
<span class="sd">        =======</span>

<span class="sd">        polarization: ``str``, optional</span>
<span class="sd">            Polarization of the signal to consider (scalar, vector, tensor) for the ORF calculation.</span>
<span class="sd">            Default is tensor.</span>

<span class="sd">        frequencies: ``array_like``, optional</span>
<span class="sd">            Frequency array to use in the calculation of the ORF. By default, self.frequencies is used.</span>

<span class="sd">        Returns</span>
<span class="sd">        =======</span>

<span class="sd">        orf: ``array_like``</span>
<span class="sd">            Overlap reduction function for the required polarization.</span>

<span class="sd">        See also</span>
<span class="sd">        --------</span>
<span class="sd">        pygwb.orfs.calc_orf</span>
<span class="sd">            Method to compute the overlap reduction function.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">frequencies</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">calc_orf</span><span class="p">(</span>
                <span class="n">frequencies</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">interferometer_1</span><span class="o">.</span><span class="n">vertex</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">interferometer_2</span><span class="o">.</span><span class="n">vertex</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">interferometer_1</span><span class="o">.</span><span class="n">x</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">interferometer_2</span><span class="o">.</span><span class="n">x</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">interferometer_1</span><span class="o">.</span><span class="n">y</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">interferometer_2</span><span class="o">.</span><span class="n">y</span><span class="p">,</span>
                <span class="n">polarization</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequencies</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">calc_orf</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">frequencies</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">interferometer_1</span><span class="o">.</span><span class="n">vertex</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">interferometer_2</span><span class="o">.</span><span class="n">vertex</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">interferometer_1</span><span class="o">.</span><span class="n">x</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">interferometer_2</span><span class="o">.</span><span class="n">x</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">interferometer_1</span><span class="o">.</span><span class="n">y</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">interferometer_2</span><span class="o">.</span><span class="n">y</span><span class="p">,</span>
                <span class="n">polarization</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Frequencies have not been provided for the orf calculation; user should either pass frequencies in or set them for this Baseline.&quot;</span>
            <span class="p">)</span></div>

<div class="viewcode-block" id="Baseline.from_interferometers"><a class="viewcode-back" href="../../api/pygwb.baseline.Baseline.html#pygwb.baseline.Baseline.from_interferometers">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_interferometers</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">interferometers</span><span class="p">,</span>
        <span class="n">duration</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">calibration_epsilon</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Load a Baseline from a list of interferometers.</span>

<span class="sd">        Parameters</span>
<span class="sd">        =======</span>

<span class="sd">        interferometers: ``list``</span>
<span class="sd">            List of two bilby Interferometer objects.</span>

<span class="sd">        duration: ``float``, optional</span>
<span class="sd">            Segment duration in seconds. Default is None.</span>

<span class="sd">        calibration_epsilon: ``float``, optional</span>
<span class="sd">            Calibration uncertainty for this baseline. Default is 0.</span>

<span class="sd">        Returns</span>
<span class="sd">        =======</span>

<span class="sd">        Baseline: cls</span>
<span class="sd">            Baseline class</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">ifo</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">ifo</span> <span class="ow">in</span> <span class="n">interferometers</span><span class="p">])</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
            <span class="n">interferometer_1</span><span class="o">=</span><span class="n">interferometers</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="n">interferometer_2</span><span class="o">=</span><span class="n">interferometers</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
            <span class="n">duration</span><span class="o">=</span><span class="n">duration</span><span class="p">,</span>
            <span class="n">calibration_epsilon</span><span class="o">=</span><span class="n">calibration_epsilon</span><span class="p">,</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="Baseline.from_parameters"><a class="viewcode-back" href="../../api/pygwb.baseline.Baseline.html#pygwb.baseline.Baseline.from_parameters">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_parameters</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">interferometer_1</span><span class="p">,</span>
        <span class="n">interferometer_2</span><span class="p">,</span>
        <span class="n">parameters</span><span class="p">,</span>
        <span class="n">frequencies</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Load a Baseline from a Parameters object.</span>

<span class="sd">        Parameters</span>
<span class="sd">        =======</span>

<span class="sd">        interferometer_1/2: ``bilby.Interferometer`` object</span>
<span class="sd">            The two detectors spanning this baseline.</span>

<span class="sd">        parameters: ``pygwb.parameters`` object</span>
<span class="sd">            Parameters object containing necessary parameters for</span>
<span class="sd">            the instantiation of the baseline, and subsequent</span>
<span class="sd">            analyses.</span>

<span class="sd">        frequencies: ``array_like``, optional</span>
<span class="sd">            Frequency array to use in the instantiation of this baseline.</span>
<span class="sd">            Default is None.</span>

<span class="sd">        Returns</span>
<span class="sd">        =======</span>

<span class="sd">        Baseline: cls</span>
<span class="sd">            Baseline class</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">interferometer_1</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="n">interferometer_2</span><span class="o">.</span><span class="n">name</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
            <span class="n">interferometer_1</span><span class="o">=</span><span class="n">interferometer_1</span><span class="p">,</span>
            <span class="n">interferometer_2</span><span class="o">=</span><span class="n">interferometer_2</span><span class="p">,</span>
            <span class="n">duration</span><span class="o">=</span><span class="n">parameters</span><span class="o">.</span><span class="n">segment_duration</span><span class="p">,</span>
            <span class="n">calibration_epsilon</span><span class="o">=</span><span class="n">parameters</span><span class="o">.</span><span class="n">calibration_epsilon</span><span class="p">,</span>
            <span class="n">frequencies</span><span class="o">=</span><span class="n">frequencies</span><span class="p">,</span>
            <span class="n">notch_list_path</span><span class="o">=</span><span class="n">parameters</span><span class="o">.</span><span class="n">notch_list_path</span><span class="p">,</span>
            <span class="n">coarse_grain_psd</span><span class="o">=</span><span class="n">parameters</span><span class="o">.</span><span class="n">coarse_grain_psd</span><span class="p">,</span>
            <span class="n">coarse_grain_csd</span><span class="o">=</span><span class="n">parameters</span><span class="o">.</span><span class="n">coarse_grain_csd</span><span class="p">,</span>
            <span class="n">overlap_factor_welch</span><span class="o">=</span><span class="n">parameters</span><span class="o">.</span><span class="n">overlap_factor_welch</span><span class="p">,</span>
            <span class="n">overlap_factor</span><span class="o">=</span><span class="n">parameters</span><span class="o">.</span><span class="n">overlap_factor</span><span class="p">,</span>
            <span class="n">window_fftgram_dict</span><span class="o">=</span><span class="n">parameters</span><span class="o">.</span><span class="n">window_fft_dict</span><span class="p">,</span>
            <span class="n">window_fftgram_dict_welch</span><span class="o">=</span><span class="n">parameters</span><span class="o">.</span><span class="n">window_fft_dict_welch</span><span class="p">,</span>
            <span class="n">N_average_segments_psd</span><span class="o">=</span><span class="n">parameters</span><span class="o">.</span><span class="n">N_average_segments_psd</span><span class="p">,</span>
            <span class="n">sampling_frequency</span><span class="o">=</span><span class="n">parameters</span><span class="o">.</span><span class="n">new_sample_rate</span><span class="p">,</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="Baseline.load_from_pickle"><a class="viewcode-back" href="../../api/pygwb.baseline.Baseline.html#pygwb.baseline.Baseline.load_from_pickle">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">load_from_pickle</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Load baseline object from pickle file.</span>

<span class="sd">        Parameters</span>
<span class="sd">        =======</span>

<span class="sd">        filename: ``str``</span>
<span class="sd">            Filename (inclusive of path) to load the pickled baseline from.</span>

<span class="sd">        Returns</span>
<span class="sd">        =======</span>

<span class="sd">        Baseline: ``cls``</span>
<span class="sd">            Baseline class.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span></div>

<div class="viewcode-block" id="Baseline.save_to_pickle"><a class="viewcode-back" href="../../api/pygwb.baseline.Baseline.html#pygwb.baseline.Baseline.save_to_pickle">[docs]</a>    <span class="k">def</span> <span class="nf">save_to_pickle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">wipe</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Save baseline object to pickle file.</span>

<span class="sd">        Parameters</span>
<span class="sd">        =======</span>

<span class="sd">        filename: ``str``</span>
<span class="sd">            Filename (inclusive of path) to save the pickled baseline to.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">wipe</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">interferometer_1</span><span class="o">.</span><span class="n">timeseries</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">interferometer_2</span><span class="o">.</span><span class="n">timeseries</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span></div>

<div class="viewcode-block" id="Baseline.set_cross_and_power_spectral_density"><a class="viewcode-back" href="../../api/pygwb.baseline.Baseline.html#pygwb.baseline.Baseline.set_cross_and_power_spectral_density">[docs]</a>    <span class="k">def</span> <span class="nf">set_cross_and_power_spectral_density</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frequency_resolution</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the power spectral density in each interferometer</span>
<span class="sd">        and the cross spectral density for the baseline object when data are available.</span>

<span class="sd">        Parameters</span>
<span class="sd">        =======</span>

<span class="sd">        frequency_resolution: ``float``</span>
<span class="sd">            The frequency resolution at which the cross and power spectral densities are calculated.</span>

<span class="sd">        See also</span>
<span class="sd">        --------</span>
<span class="sd">        pygwb.spectral.cross_spectral_density</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">interferometer_1</span><span class="o">.</span><span class="n">set_psd_spectrogram</span><span class="p">(</span>
                <span class="n">frequency_resolution</span><span class="p">,</span>
                <span class="n">coarse_grain</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">coarse_grain_psd</span><span class="p">,</span>
                <span class="n">overlap_factor</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">overlap_factor</span><span class="p">,</span>
                <span class="n">window_fftgram_dict</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">window_fftgram_dict_psd</span><span class="p">,</span>
                <span class="n">overlap_factor_welch</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">overlap_factor_welch</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span>
                <span class="s2">&quot;Interferometer </span><span class="si">{self.interferometer_1.name}</span><span class="s2"> has no timeseries data! Need to set timeseries data in the interferometer first.&quot;</span>
            <span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">interferometer_2</span><span class="o">.</span><span class="n">set_psd_spectrogram</span><span class="p">(</span>
                <span class="n">frequency_resolution</span><span class="p">,</span>
                <span class="n">coarse_grain</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">coarse_grain_psd</span><span class="p">,</span>
                <span class="n">overlap_factor</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">overlap_factor</span><span class="p">,</span>
                <span class="n">window_fftgram_dict</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">window_fftgram_dict_psd</span><span class="p">,</span>
                <span class="n">overlap_factor_welch</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">overlap_factor_welch</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span>
                <span class="s2">&quot;Interferometer </span><span class="si">{self.interferometer_2.name}</span><span class="s2"> has no timeseries data! Need to set timeseries data in the interferometer first.&quot;</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">csd</span> <span class="o">=</span> <span class="n">cross_spectral_density</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">interferometer_1</span><span class="o">.</span><span class="n">timeseries</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">interferometer_2</span><span class="o">.</span><span class="n">timeseries</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">duration</span><span class="p">,</span>
            <span class="n">frequency_resolution</span><span class="p">,</span>
            <span class="n">coarse_grain</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">coarse_grain_csd</span><span class="p">,</span>
            <span class="n">overlap_factor</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">overlap_factor</span><span class="p">,</span>
            <span class="n">zeropad</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">zeropad_csd</span><span class="p">,</span>
            <span class="n">window_fftgram_dict</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">window_fftgram_dict_csd</span><span class="p">,</span>
            <span class="n">overlap_factor_welch</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">overlap_factor_welch</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># TODO: make this less fragile.</span>
        <span class="c1"># For now, reset frequencies,</span>
        <span class="c1"># recalculate ORF in case frequencies have changed.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tensor_orf_calculated</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frequencies</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">csd</span><span class="o">.</span><span class="n">frequencies</span><span class="o">.</span><span class="n">value</span></div>

<div class="viewcode-block" id="Baseline.set_average_power_spectral_densities"><a class="viewcode-back" href="../../api/pygwb.baseline.Baseline.html#pygwb.baseline.Baseline.set_average_power_spectral_densities">[docs]</a>    <span class="k">def</span> <span class="nf">set_average_power_spectral_densities</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;If psds have been calculated, sets the average psd in each ifo.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">interferometer_1</span><span class="o">.</span><span class="n">set_average_psd</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N_average_segments_psd</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">interferometer_2</span><span class="o">.</span><span class="n">set_average_psd</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N_average_segments_psd</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="s2">&quot;PSDs have not been calculated yet! Need to set_cross_and_power_spectral_density first.&quot;</span>
            <span class="p">)</span></div>

        <span class="c1"># TODO: make this less fragile.</span>
        <span class="c1"># For now, recalculate ORF in case frequencies have changed.</span>
        <span class="c1"># self._tensor_orf_calculated = False</span>
        <span class="c1"># self.frequencies = self.csd.frequencies.value</span>

<div class="viewcode-block" id="Baseline.set_average_cross_spectral_density"><a class="viewcode-back" href="../../api/pygwb.baseline.Baseline.html#pygwb.baseline.Baseline.set_average_cross_spectral_density">[docs]</a>    <span class="k">def</span> <span class="nf">set_average_cross_spectral_density</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;If csd has been calculated, sets the average csd for the baseline.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">average_csd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">csd</span><span class="p">[</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">csd_segment_offset</span> <span class="p">:</span> <span class="o">-</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">csd_segment_offset</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="p">]</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="s2">&quot;CSD has not been calculated yet! Need to set_cross_and_power_spectral_density first.&quot;</span>
            <span class="p">)</span>
        <span class="c1"># TODO: make this less fragile.</span>
        <span class="c1"># For now, recalculate ORF in case frequencies have changed.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tensor_orf_calculated</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frequencies</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">csd</span><span class="o">.</span><span class="n">frequencies</span><span class="o">.</span><span class="n">value</span></div>

<div class="viewcode-block" id="Baseline.crop_frequencies_average_psd_csd"><a class="viewcode-back" href="../../api/pygwb.baseline.Baseline.html#pygwb.baseline.Baseline.crop_frequencies_average_psd_csd">[docs]</a>    <span class="k">def</span> <span class="nf">crop_frequencies_average_psd_csd</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">flow</span><span class="p">,</span> <span class="n">fhigh</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Crop frequencies of average PSDs and CSDS. Done in place. This is not completely implemented yet.</span>

<span class="sd">        Parameters</span>
<span class="sd">        =======</span>

<span class="sd">        flow: ``float``</span>
<span class="sd">            Low frequency to crop.</span>

<span class="sd">        fhigh: ``float``</span>
<span class="sd">            High frequency to crop.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">deltaF</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequencies</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequencies</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c1"># reset frequencies using the same calculation as in crop_frequencies so we get</span>
        <span class="c1"># consistent frequency ranges</span>
        <span class="n">idx0</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">flow</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequencies</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">//</span> <span class="n">deltaF</span><span class="p">)</span>
        <span class="n">idx1</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">fhigh</span> <span class="o">+</span> <span class="n">deltaF</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequencies</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">//</span> <span class="n">deltaF</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frequencies</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequencies</span><span class="p">[</span><span class="n">idx0</span><span class="p">:</span><span class="n">idx1</span><span class="p">]</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">interferometer_1</span><span class="p">,</span> <span class="s2">&quot;average_psd&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">interferometer_1</span><span class="o">.</span><span class="n">average_psd</span> <span class="o">=</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">interferometer_1</span><span class="o">.</span><span class="n">average_psd</span><span class="o">.</span><span class="n">crop_frequencies</span><span class="p">(</span><span class="n">flow</span><span class="p">,</span> <span class="n">fhigh</span> <span class="o">+</span> <span class="n">deltaF</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">interferometer_2</span><span class="p">,</span> <span class="s2">&quot;average_psd&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">interferometer_2</span><span class="o">.</span><span class="n">average_psd</span> <span class="o">=</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">interferometer_2</span><span class="o">.</span><span class="n">average_psd</span><span class="o">.</span><span class="n">crop_frequencies</span><span class="p">(</span><span class="n">flow</span><span class="p">,</span> <span class="n">fhigh</span> <span class="o">+</span> <span class="n">deltaF</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;average_csd&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">average_csd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">average_csd</span><span class="o">.</span><span class="n">crop_frequencies</span><span class="p">(</span><span class="n">flow</span><span class="p">,</span> <span class="n">fhigh</span> <span class="o">+</span> <span class="n">deltaF</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_point_estimate_spectrogram_set</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">point_estimate_spectrogram</span> <span class="o">=</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">point_estimate_spectrogram</span><span class="o">.</span><span class="n">crop_frequencies</span><span class="p">(</span><span class="n">flow</span><span class="p">,</span> <span class="n">fhigh</span> <span class="o">+</span> <span class="n">deltaF</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sigma_spectrogram_set</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sigma_spectrogram</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sigma_spectrogram</span><span class="o">.</span><span class="n">crop_frequencies</span><span class="p">(</span>
                <span class="n">flow</span><span class="p">,</span> <span class="n">fhigh</span> <span class="o">+</span> <span class="n">deltaF</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_point_estimate_spectrum_set</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">point_estimate_spectrum</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">point_estimate_spectrum</span><span class="o">.</span><span class="n">crop</span><span class="p">(</span>
                <span class="n">flow</span><span class="p">,</span> <span class="n">fhigh</span> <span class="o">+</span> <span class="n">deltaF</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sigma_spectrum_set</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sigma_spectrum</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sigma_spectrum</span><span class="o">.</span><span class="n">crop</span><span class="p">(</span><span class="n">flow</span><span class="p">,</span> <span class="n">fhigh</span> <span class="o">+</span> <span class="n">deltaF</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_point_estimate_set</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_point_estimate_sigma</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_coherence_spectrum_set</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">coherence_spectrum</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">coherence_spectrum</span><span class="o">.</span><span class="n">crop</span><span class="p">(</span><span class="n">flow</span><span class="p">,</span> <span class="n">fhigh</span> <span class="o">+</span> <span class="n">deltaF</span><span class="p">)</span></div>

<div class="viewcode-block" id="Baseline.set_point_estimate_sigma_spectrogram"><a class="viewcode-back" href="../../api/pygwb.baseline.Baseline.html#pygwb.baseline.Baseline.set_point_estimate_sigma_spectrogram">[docs]</a>    <span class="k">def</span> <span class="nf">set_point_estimate_sigma_spectrogram</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">fref</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span> <span class="n">flow</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">fhigh</span><span class="o">=</span><span class="mi">1726</span><span class="p">,</span> <span class="n">polarization</span><span class="o">=</span><span class="s2">&quot;tensor&quot;</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set point estimate and sigma spectrogram. Resulting spectrogram</span>
<span class="sd">        *does not include frequency weighting for alpha*.</span>

<span class="sd">        Parameters</span>
<span class="sd">        =======</span>

<span class="sd">        alpha: ``float``, optional</span>
<span class="sd">            Spectral index to use in the weighting. Default is 0.</span>

<span class="sd">        fref: ``float``, optional</span>
<span class="sd">            Reference frequency to use in the weighting calculation.</span>
<span class="sd">            Final result refers to this frequency. Default is 25 Hz.</span>

<span class="sd">        flow: ``float``, optional</span>
<span class="sd">            Lowest frequency to consider. Default is 20 Hz.</span>

<span class="sd">        fhigh: ``float``, optional</span>
<span class="sd">            Highest frequency to consider. Default is 1726 Hz.</span>

<span class="sd">        polarization: ``str``, optional</span>
<span class="sd">            Polarization of the signal to consider (scalar, vector, tensor) for the ORF calculation.</span>
<span class="sd">            Default is tensor.</span>

<span class="sd">        See also</span>
<span class="sd">        --------</span>
<span class="sd">        pygwb.omega_spectra.OmegaSpectrogram</span>

<span class="sd">        pygwb.postprocessing.calculate_point_estimate_sigma_spectra</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># set CSD if not set</span>
        <span class="c1"># self.set_average_cross_spectral_density()</span>

        <span class="c1"># set PSDs if not set</span>
        <span class="c1"># self.set_average_power_spectral_densities()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">crop_frequencies_average_psd_csd</span><span class="p">(</span><span class="n">flow</span><span class="p">,</span> <span class="n">fhigh</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_orf_polarization_set</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">orf_polarization</span> <span class="o">=</span> <span class="n">polarization</span>

        <span class="n">Y_fs</span><span class="p">,</span> <span class="n">var_fs</span> <span class="o">=</span> <span class="n">calculate_point_estimate_sigma_spectra</span><span class="p">(</span>
            <span class="n">freqs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">frequencies</span><span class="p">,</span>
            <span class="n">csd</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">average_csd</span><span class="p">,</span>
            <span class="n">avg_psd_1</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">interferometer_1</span><span class="o">.</span><span class="n">average_psd</span><span class="p">,</span>
            <span class="n">avg_psd_2</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">interferometer_2</span><span class="o">.</span><span class="n">average_psd</span><span class="p">,</span>
            <span class="n">orf</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">overlap_reduction_function</span><span class="p">,</span>
            <span class="n">sample_rate</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sampling_frequency</span><span class="p">,</span>
            <span class="n">segment_duration</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">duration</span><span class="p">,</span>
            <span class="n">fref</span><span class="o">=</span><span class="n">fref</span><span class="p">,</span>
            <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span>
            <span class="n">overlap_factor</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">overlap_factor</span><span class="p">,</span>
            <span class="n">window_fftgram_dict</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">window_fftgram_dict_csd</span>
        <span class="p">)</span> 

        <span class="n">sigma_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> sigma spectrogram alpha=</span><span class="si">{</span><span class="n">alpha</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">point_estimate_spectrogram</span> <span class="o">=</span> <span class="n">OmegaSpectrogram</span><span class="p">(</span>
            <span class="n">Y_fs</span><span class="p">,</span>
            <span class="n">times</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">average_csd</span><span class="o">.</span><span class="n">times</span><span class="p">,</span>
            <span class="n">frequencies</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">average_csd</span><span class="o">.</span><span class="n">frequencies</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot; with alpha=</span><span class="si">{</span><span class="n">alpha</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span>
            <span class="n">fref</span><span class="o">=</span><span class="n">fref</span><span class="p">,</span>
            <span class="n">h0</span><span class="o">=</span><span class="n">h0</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">sigma_spectrogram</span> <span class="o">=</span> <span class="n">OmegaSpectrogram</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">var_fs</span><span class="p">),</span>
            <span class="n">times</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">average_csd</span><span class="o">.</span><span class="n">times</span><span class="p">,</span>
            <span class="n">frequencies</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">average_csd</span><span class="o">.</span><span class="n">frequencies</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="n">sigma_name</span><span class="p">,</span>
            <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span>
            <span class="n">fref</span><span class="o">=</span><span class="n">fref</span><span class="p">,</span>
            <span class="n">h0</span><span class="o">=</span><span class="n">h0</span><span class="p">,</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="Baseline.set_point_estimate_sigma_spectrum"><a class="viewcode-back" href="../../api/pygwb.baseline.Baseline.html#pygwb.baseline.Baseline.set_point_estimate_sigma_spectrum">[docs]</a>    <span class="k">def</span> <span class="nf">set_point_estimate_sigma_spectrum</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">badtimes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">alpha</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
        <span class="n">fref</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span>
        <span class="n">flow</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
        <span class="n">fhigh</span><span class="o">=</span><span class="mi">1726</span><span class="p">,</span>
        <span class="n">notch_list_path</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">polarization</span><span class="o">=</span><span class="s2">&quot;tensor&quot;</span><span class="p">,</span>
        <span class="n">apply_dsc</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">apply_notches</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set time-integrated point estimate spectrum and variance in each frequency bin.</span>

<span class="sd">        Parameters</span>
<span class="sd">        =======</span>

<span class="sd">        badtimes: ``array_like``, optional</span>
<span class="sd">            Array of times to exclude from point estimate/sigma calculation.</span>
<span class="sd">            If no times are passed, none will be excluded.</span>

<span class="sd">        alpha: ``float``, optional</span>
<span class="sd">            Spectral index to use in the re-weighting. Default is 0.</span>

<span class="sd">        fref: ``float``, optional</span>
<span class="sd">            Reference frequency to use in the re-weighting. Default is 25 Hz.</span>

<span class="sd">        flow: ``float``, optional</span>
<span class="sd">            Low frequency. Default is 20 Hz.</span>

<span class="sd">        fhigh: ``float``, optional</span>
<span class="sd">            High frequency. Default is 1726 Hz.</span>

<span class="sd">        notch_list_path: ``str``, optional</span>
<span class="sd">            Path to the notch list to use in the spectrum. Default is empty string.</span>

<span class="sd">        polarization: ``str``, optional</span>
<span class="sd">            Polarization of the signal to consider (scalar, vector, tensor) for the orf calculation.</span>
<span class="sd">            Default is tensor.</span>

<span class="sd">        apply_dsc: ``bool``, optional</span>
<span class="sd">            Apply delta sigma cut flag; if True, removes the badGPStimes from the spectra calculations.</span>
<span class="sd">            Default is True.</span>

<span class="sd">        apply_notches: ``bool``, optional</span>
<span class="sd">            Apply spectral notches flag; if True, remove the notches specified in the notch_list from the spectra calculations.</span>
<span class="sd">            Default is True.</span>

<span class="sd">        See also</span>
<span class="sd">        --------</span>
<span class="sd">        pygwb.postprocessing.postprocess_Y_sigma</span>

<span class="sd">        pygwb.omega_spectra.OmegaSpectrum</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">apply_dsc</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;badGPStimes&quot;</span><span class="p">):</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                    <span class="s2">&quot;Delta sigma cut has not been calculated yet, hence no delta sigma cut will be applied... If this is a mistake, please run `calculate_delta_sigma_cut` first, then re-calculate point estimate/sigma spectra.&quot;</span>
                <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_point_estimate_spectrogram_set</span><span class="p">:</span>
            <span class="c1"># reweight based on alpha that has been supplied</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">point_estimate_spectrogram</span><span class="o">.</span><span class="n">reweight</span><span class="p">(</span><span class="n">new_alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span> <span class="n">new_fref</span><span class="o">=</span><span class="n">fref</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sigma_spectrogram</span><span class="o">.</span><span class="n">reweight</span><span class="p">(</span><span class="n">new_alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span> <span class="n">new_fref</span><span class="o">=</span><span class="n">fref</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="s2">&quot;Point estimate and sigma spectrograms are not set yet. setting now...&quot;</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_point_estimate_sigma_spectrogram</span><span class="p">(</span>
                <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span>
                <span class="n">fref</span><span class="o">=</span><span class="n">fref</span><span class="p">,</span>
                <span class="n">flow</span><span class="o">=</span><span class="n">flow</span><span class="p">,</span>
                <span class="n">fhigh</span><span class="o">=</span><span class="n">fhigh</span><span class="p">,</span>
                <span class="n">polarization</span><span class="o">=</span><span class="n">polarization</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="n">deltaF</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequencies</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequencies</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1"># should be True for each bad time</span>
        <span class="n">bad_times_indexes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_bad_times_indexes</span><span class="p">(</span><span class="n">times</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">point_estimate_spectrogram</span><span class="o">.</span><span class="n">times</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">badtimes</span><span class="o">=</span><span class="n">badtimes</span><span class="p">,</span> <span class="n">apply_dsc</span><span class="o">=</span><span class="n">apply_dsc</span><span class="p">)</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">bad_times_indexes</span><span class="p">)</span><span class="si">}</span><span class="s2"> bad segments removed.&quot;</span><span class="p">)</span>

        <span class="c1"># start time, for metadata</span>
        <span class="n">epoch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">point_estimate_spectrogram</span><span class="o">.</span><span class="n">times</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sampling_frequency</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span>
                <span class="s2">&quot;the sampling frequency is not set! Cannot proceed with spectrum calculation.&quot;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">apply_dsc</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">delta_sigmas</span><span class="p">[</span><span class="s2">&quot;times&quot;</span><span class="p">])</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">badGPStimes</span><span class="p">):</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                    <span class="s2">&quot;The delta sigma cut has flagged all times in this dataset. No point estimate/sigma values can be calculated.&quot;</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">point_estimate_spectrum</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frequencies</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sigma_spectrum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frequencies</span><span class="p">))</span>
                <span class="k">return</span> 
            
        <span class="c1"># setting the frequency mask for the before/after calculation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_frequency_mask</span><span class="p">(</span>
            <span class="n">notch_list_path</span><span class="o">=</span><span class="n">notch_list_path</span><span class="p">,</span> <span class="n">apply_notches</span><span class="o">=</span><span class="n">apply_notches</span>
        <span class="p">)</span>

        <span class="n">point_estimate</span><span class="p">,</span> <span class="n">sigma</span> <span class="o">=</span> <span class="n">postprocess_Y_sigma</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">point_estimate_spectrogram</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sigma_spectrogram</span><span class="o">.</span><span class="n">value</span> <span class="o">**</span> <span class="mi">2</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">duration</span><span class="p">,</span>
            <span class="n">deltaF</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sampling_frequency</span><span class="p">,</span>
            <span class="n">frequency_mask</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency_mask</span><span class="p">,</span>
            <span class="n">window_fftgram_dict</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">window_fftgram_dict</span><span class="p">,</span>
            <span class="n">window_fftgram_dict_welch</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">window_fftgram_dict_for_bias_factors</span><span class="p">,</span>
            <span class="n">badtimes_mask</span><span class="o">=</span><span class="n">bad_times_indexes</span><span class="p">,</span>
            <span class="n">overlap_factor</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">overlap_factor</span><span class="p">,</span>
            <span class="n">overlap_factor_welch</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">overlap_factor_psd</span><span class="p">,</span>
            <span class="n">N_avg_segs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">N_average_segments_psd</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">point_estimate_spectrum</span> <span class="o">=</span> <span class="n">OmegaSpectrum</span><span class="p">(</span>
            <span class="n">point_estimate</span><span class="p">,</span>
            <span class="n">frequencies</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">frequencies</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot; point estimate spectrum&quot;</span><span class="p">,</span>
            <span class="n">epoch</span><span class="o">=</span><span class="n">epoch</span><span class="p">,</span>
            <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span>
            <span class="n">fref</span><span class="o">=</span><span class="n">fref</span><span class="p">,</span>
            <span class="n">h0</span><span class="o">=</span><span class="n">h0</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sigma_spectrum</span> <span class="o">=</span> <span class="n">OmegaSpectrum</span><span class="p">(</span>
            <span class="n">sigma</span><span class="p">,</span>
            <span class="n">frequencies</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">frequencies</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot; sigma spectrum&quot;</span><span class="p">,</span>
            <span class="n">epoch</span><span class="o">=</span><span class="n">epoch</span><span class="p">,</span>
            <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span>
            <span class="n">fref</span><span class="o">=</span><span class="n">fref</span><span class="p">,</span>
            <span class="n">h0</span><span class="o">=</span><span class="n">h0</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">point_estimate_alpha</span> <span class="o">=</span> <span class="mi">0</span></div>

<div class="viewcode-block" id="Baseline.set_point_estimate_sigma"><a class="viewcode-back" href="../../api/pygwb.baseline.Baseline.html#pygwb.baseline.Baseline.set_point_estimate_sigma">[docs]</a>    <span class="k">def</span> <span class="nf">set_point_estimate_sigma</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">badtimes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">alpha</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
        <span class="n">fref</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span>
        <span class="n">flow</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
        <span class="n">fhigh</span><span class="o">=</span><span class="mi">1726</span><span class="p">,</span>
        <span class="n">notch_list_path</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">polarization</span><span class="o">=</span><span class="s2">&quot;tensor&quot;</span><span class="p">,</span>
        <span class="n">apply_dsc</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">apply_notches</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set point estimate sigma based on a set of parameters. This is estimate of omega_gw in each frequency bin.</span>

<span class="sd">        Parameters</span>
<span class="sd">        =======</span>

<span class="sd">        badtimes: ``array_like``, optional</span>
<span class="sd">            Array of times to exclude from point estimate/sigma calculation.</span>
<span class="sd">            If no times are passed, none will be excluded.</span>

<span class="sd">        alpha: ``float``, optional</span>
<span class="sd">            Spectral index to use in the re-weighting. Default is 0.</span>

<span class="sd">        fref: ``float``, optional</span>
<span class="sd">            Reference frequency to use in the re-weighting. Default is 25.</span>

<span class="sd">        flow: ``float``, optional</span>
<span class="sd">            Low frequency. Default is 20 Hz.</span>

<span class="sd">        fhigh: ``float``, optional</span>
<span class="sd">            High frequency. Default is 1726 Hz.</span>

<span class="sd">        notch_list_path: ``str``, optional</span>
<span class="sd">            Path to the notch list to use in the spectrum; if the notch_list isn&#39;t set in the baseline,</span>
<span class="sd">            user can pass it directly here. If it is not set and if none is passed no notches will be applied.</span>

<span class="sd">        polarization: ``str``, optional</span>
<span class="sd">            Polarization of the signal to consider (scalar, vector, tensor) for the orf calculation.</span>
<span class="sd">            Default is Tensor.</span>

<span class="sd">        apply_dsc: ``bool``, optional</span>
<span class="sd">            Apply delta sigma cut flag; if True, removes the badGPStimes from the spectra calculations.</span>
<span class="sd">            Default is True.</span>

<span class="sd">        apply_notches: ``bool``, optional</span>
<span class="sd">            Apply spectral notches flag; if True, remove the notches specified in the notch_list from the spectra calculations.</span>
<span class="sd">            Default is True.</span>

<span class="sd">        See also</span>
<span class="sd">        --------</span>
<span class="sd">        pygwb.postprocessing.calc_Y_sigma_from_Yf_sigmaf</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_point_estimate_spectrum_set</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">point_estimate_spectrum</span><span class="o">.</span><span class="n">reweight</span><span class="p">(</span><span class="n">new_alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span> <span class="n">new_fref</span><span class="o">=</span><span class="n">fref</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sigma_spectrum</span><span class="o">.</span><span class="n">reweight</span><span class="p">(</span><span class="n">new_alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span> <span class="n">new_fref</span><span class="o">=</span><span class="n">fref</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">point_estimate_spectrogram</span><span class="o">.</span><span class="n">reweight</span><span class="p">(</span><span class="n">new_alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span> <span class="n">new_fref</span><span class="o">=</span><span class="n">fref</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sigma_spectrogram</span><span class="o">.</span><span class="n">reweight</span><span class="p">(</span><span class="n">new_alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span> <span class="n">new_fref</span><span class="o">=</span><span class="n">fref</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="s2">&quot;Point estimate and sigma spectra have not been set before. Setting it now...&quot;</span>
            <span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                <span class="s2">&quot;No weighting supplied in setting of spectrum. Supplied when combining for final sigma&quot;</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_point_estimate_sigma_spectrum</span><span class="p">(</span>
                <span class="n">badtimes</span><span class="o">=</span><span class="n">badtimes</span><span class="p">,</span>
                <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span>
                <span class="n">fref</span><span class="o">=</span><span class="n">fref</span><span class="p">,</span>
                <span class="n">flow</span><span class="o">=</span><span class="n">flow</span><span class="p">,</span>
                <span class="n">fhigh</span><span class="o">=</span><span class="n">fhigh</span><span class="p">,</span>
                <span class="n">polarization</span><span class="o">=</span><span class="n">polarization</span><span class="p">,</span>
                <span class="n">apply_dsc</span><span class="o">=</span><span class="n">apply_dsc</span><span class="p">,</span>
                <span class="n">notch_list_path</span><span class="o">=</span><span class="n">notch_list_path</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">set_frequency_mask</span><span class="p">(</span>
            <span class="n">notch_list_path</span><span class="o">=</span><span class="n">notch_list_path</span><span class="p">,</span> <span class="n">apply_notches</span><span class="o">=</span><span class="n">apply_notches</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sigma_spectrum</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">infty</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sigma</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">point_estimate</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">return</span> 

        <span class="n">Y</span><span class="p">,</span> <span class="n">sigma</span> <span class="o">=</span> <span class="n">calc_Y_sigma_from_Yf_sigmaf</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">point_estimate_spectrum</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sigma_spectrum</span><span class="p">,</span>
            <span class="n">frequency_mask</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency_mask</span><span class="p">,</span>
            <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span>
            <span class="n">fref</span><span class="o">=</span><span class="n">fref</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">point_estimate</span> <span class="o">=</span> <span class="n">Y</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sigma</span> <span class="o">=</span> <span class="n">sigma</span></div>

<div class="viewcode-block" id="Baseline.reweight"><a class="viewcode-back" href="../../api/pygwb.baseline.Baseline.html#pygwb.baseline.Baseline.reweight">[docs]</a>    <span class="k">def</span> <span class="nf">reweight</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_alpha</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">new_fref</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Reweight all the frequency-weighted attributes of this Baseline, if these are set.</span>

<span class="sd">        Parameters</span>
<span class="sd">        =======</span>

<span class="sd">        new_alpha: ``float``, optional</span>
<span class="sd">            New alpha to weight the spectra to. Default is None.</span>

<span class="sd">        new_fref: ``float``, optional</span>
<span class="sd">            New reference frequency to refer the spectra to. Default is None.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_point_estimate_sigma</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="n">new_alpha</span><span class="p">,</span> <span class="n">fref</span><span class="o">=</span><span class="n">new_fref</span><span class="p">)</span></div>

<div class="viewcode-block" id="Baseline.calculate_delta_sigma_cut"><a class="viewcode-back" href="../../api/pygwb.baseline.Baseline.html#pygwb.baseline.Baseline.calculate_delta_sigma_cut">[docs]</a>    <span class="k">def</span> <span class="nf">calculate_delta_sigma_cut</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">delta_sigma_cut</span><span class="p">,</span>
        <span class="n">alphas</span><span class="p">,</span>
        <span class="n">fref</span><span class="p">,</span>
        <span class="n">flow</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
        <span class="n">fhigh</span><span class="o">=</span><span class="mi">1726</span><span class="p">,</span>
        <span class="n">notch_list_path</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">polarization</span><span class="o">=</span><span class="s2">&quot;tensor&quot;</span><span class="p">,</span>
        <span class="n">return_naive_and_averaged_sigmas</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate the delta sigma cut using the naive and average psds, if set in the baseline.</span>

<span class="sd">        Parameters</span>
<span class="sd">        =======</span>

<span class="sd">        delta_sigma_cut: ``float``</span>
<span class="sd">            The cutoff to implement in the delta sigma cut.</span>

<span class="sd">        alphas: ``list``</span>
<span class="sd">            Set of spectral indices to use in the delta sigma cut calculation.</span>

<span class="sd">        flow: ``float``, optional</span>
<span class="sd">            Low frequency. Default is 20 Hz.</span>

<span class="sd">        fhigh: ``float``, optional</span>
<span class="sd">            High frequency. Default is 1726 Hz.</span>

<span class="sd">        notch_list_path: ``str``, optional</span>
<span class="sd">            File path of the baseline notch list.</span>

<span class="sd">        fref: ``int``</span>
<span class="sd">            Reference frequency (Hz).</span>

<span class="sd">        return_naive_and_averaged_sigmas: ``bool``, optional</span>
<span class="sd">            Option to return naive and sliding sigmas. Default is False.</span>

<span class="sd">        polarization: ``str``, optional</span>
<span class="sd">            Polarization of the signal to consider (scalar, vector, tensor) for the orf calculation.</span>
<span class="sd">            Default is tensor.</span>

<span class="sd">        See also</span>
<span class="sd">        --------</span>
<span class="sd">        pygwb.delta_sigma_cut.run_dsc</span>
<span class="sd">            Function used to run the delta sigma cut.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_orf_polarization_set</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">orf_polarization</span> <span class="o">=</span> <span class="n">polarization</span>

        <span class="n">deltaF</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequencies</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequencies</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">crop_frequencies_average_psd_csd</span><span class="p">(</span><span class="n">flow</span><span class="o">=</span><span class="n">flow</span><span class="p">,</span> <span class="n">fhigh</span><span class="o">=</span><span class="n">fhigh</span><span class="p">)</span>

        <span class="n">naive_psd_1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">interferometer_1</span><span class="o">.</span><span class="n">psd_spectrogram</span><span class="p">[</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">csd_segment_offset</span><span class="p">:</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">csd_segment_offset</span>
        <span class="p">]</span>
        <span class="n">naive_psd_2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">interferometer_2</span><span class="o">.</span><span class="n">psd_spectrogram</span><span class="p">[</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">csd_segment_offset</span><span class="p">:</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">csd_segment_offset</span>
        <span class="p">]</span>

        <span class="n">naive_psd_1_cropped</span> <span class="o">=</span> <span class="n">naive_psd_1</span><span class="o">.</span><span class="n">crop_frequencies</span><span class="p">(</span><span class="n">flow</span><span class="p">,</span> <span class="n">fhigh</span> <span class="o">+</span> <span class="n">deltaF</span><span class="p">)</span>
        <span class="n">naive_psd_2_cropped</span> <span class="o">=</span> <span class="n">naive_psd_2</span><span class="o">.</span><span class="n">crop_frequencies</span><span class="p">(</span><span class="n">flow</span><span class="p">,</span> <span class="n">fhigh</span> <span class="o">+</span> <span class="n">deltaF</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">notch_list_path</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">notch_list_path</span> <span class="o">=</span> <span class="n">notch_list_path</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">notch_list_path</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                <span class="s2">&quot;loading notches for delta sigma cut from &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">notch_list_path</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_frequency_mask</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">notch_list_path</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_frequency_mask</span><span class="p">()</span>

        <span class="n">badGPStimes</span><span class="p">,</span> <span class="n">delta_sigmas</span> <span class="o">=</span> <span class="n">run_dsc</span><span class="p">(</span>
            <span class="n">dsc</span><span class="o">=</span><span class="n">delta_sigma_cut</span><span class="p">,</span>
            <span class="n">segment_duration</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">duration</span><span class="p">,</span>
            <span class="n">psd1_naive</span><span class="o">=</span><span class="n">naive_psd_1_cropped</span><span class="p">,</span>
            <span class="n">psd2_naive</span><span class="o">=</span><span class="n">naive_psd_2_cropped</span><span class="p">,</span>
            <span class="n">psd1_slide</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">interferometer_1</span><span class="o">.</span><span class="n">average_psd</span><span class="p">,</span>
            <span class="n">psd2_slide</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">interferometer_2</span><span class="o">.</span><span class="n">average_psd</span><span class="p">,</span>
            <span class="n">alphas</span><span class="o">=</span><span class="n">alphas</span><span class="p">,</span>
            <span class="n">sample_rate</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sampling_frequency</span><span class="p">,</span>
            <span class="n">orf</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">overlap_reduction_function</span><span class="p">,</span>
            <span class="n">fref</span><span class="o">=</span><span class="n">fref</span><span class="p">,</span>
            <span class="n">frequency_mask</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency_mask</span><span class="p">,</span>
            <span class="n">window_fftgram_dict</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">window_fftgram_dict_for_bias_factors</span><span class="p">,</span>
            <span class="n">overlap_factor</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">overlap_factor_psd</span><span class="p">,</span> 
            <span class="n">N_average_segments_psd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">N_average_segments_psd</span><span class="p">,</span>
            <span class="n">return_naive_and_averaged_sigmas</span><span class="o">=</span><span class="n">return_naive_and_averaged_sigmas</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">badGPStimes</span> <span class="o">=</span> <span class="n">badGPStimes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">delta_sigmas</span> <span class="o">=</span> <span class="n">delta_sigmas</span></div>

<div class="viewcode-block" id="Baseline.set_coherence_spectrum"><a class="viewcode-back" href="../../api/pygwb.baseline.Baseline.html#pygwb.baseline.Baseline.set_coherence_spectrum">[docs]</a>    <span class="k">def</span> <span class="nf">set_coherence_spectrum</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">flow</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">fhigh</span><span class="o">=</span><span class="mi">1726</span><span class="p">,</span> <span class="n">badtimes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">apply_dsc</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the coherence spectrum between detectors, averaged over all data in the baseline.</span>

<span class="sd">        Parameters</span>
<span class="sd">        =======</span>

<span class="sd">        flow: ``float``, optional</span>
<span class="sd">            Low frequency. Default is 20 Hz.</span>

<span class="sd">        fhigh: ``float``, optional</span>
<span class="sd">            High frequency. Default is 1726 Hz.</span>

<span class="sd">        badtimes: ``array_like``, optional</span>
<span class="sd">            Array of times to exclude from the coherence calculation.</span>
<span class="sd">            Default is None.</span>

<span class="sd">        apply_dsc: ``bool``, optional</span>
<span class="sd">            Apply delta sigma cut flag; if True, removes the badGPStimes from the spectra calculations.</span>
<span class="sd">            Default is True.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>

<span class="sd">        The coherence calculation uses averaged naive PSD estimates as the coherence is calculated using CSD and PSD estimates of each individual segment, calculated \&quot;on shell\&quot;.</span>
<span class="sd">        </span>
<span class="sd">        See also</span>
<span class="sd">        --------</span>
<span class="sd">        pygwb.coherence.calculate_coherence</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">bad_times_indexes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_bad_times_indexes</span><span class="p">(</span><span class="n">times</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">interferometer_1</span><span class="o">.</span><span class="n">psd_spectrogram</span><span class="o">.</span><span class="n">times</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">apply_dsc</span><span class="o">=</span><span class="n">apply_dsc</span><span class="p">)</span>

        <span class="n">deltaF</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequencies</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequencies</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">n_segs</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">interferometer_1</span><span class="o">.</span><span class="n">psd_spectrogram</span><span class="p">[</span><span class="o">~</span><span class="n">bad_times_indexes</span><span class="p">])</span>

        <span class="n">psd_1_average</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">interferometer_1</span><span class="o">.</span><span class="n">psd_spectrogram</span><span class="p">[</span><span class="o">~</span><span class="n">bad_times_indexes</span><span class="p">]</span><span class="o">.</span><span class="n">crop_frequencies</span><span class="p">(</span><span class="n">flow</span><span class="p">,</span> <span class="n">fhigh</span> <span class="o">+</span> <span class="n">deltaF</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">psd_2_average</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">interferometer_2</span><span class="o">.</span><span class="n">psd_spectrogram</span><span class="p">[</span><span class="o">~</span><span class="n">bad_times_indexes</span><span class="p">]</span><span class="o">.</span><span class="n">crop_frequencies</span><span class="p">(</span><span class="n">flow</span><span class="p">,</span> <span class="n">fhigh</span> <span class="o">+</span> <span class="n">deltaF</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">csd_average</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">csd</span><span class="p">[</span><span class="o">~</span><span class="n">bad_times_indexes</span><span class="p">]</span><span class="o">.</span><span class="n">crop_frequencies</span><span class="p">(</span><span class="n">flow</span><span class="p">,</span> <span class="n">fhigh</span> <span class="o">+</span> <span class="n">deltaF</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="n">coherence</span> <span class="o">=</span> <span class="n">calculate_coherence</span><span class="p">(</span>
            <span class="n">psd_1_average</span><span class="p">,</span>
            <span class="n">psd_2_average</span><span class="p">,</span>
            <span class="n">csd_average</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">epoch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">csd</span><span class="o">.</span><span class="n">times</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">coherence_spectrum</span> <span class="o">=</span> <span class="n">FrequencySeries</span><span class="p">(</span>
            <span class="n">coherence</span><span class="p">,</span>
            <span class="n">frequencies</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">frequencies</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot; coherence spectrum&quot;</span><span class="p">,</span>
            <span class="n">epoch</span><span class="o">=</span><span class="n">epoch</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">coherence_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">coherence_dict</span><span class="p">[</span><span class="s1">&#39;psd_1_average&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">psd_1_average</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">coherence_dict</span><span class="p">[</span><span class="s1">&#39;psd_2_average&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">psd_2_average</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">coherence_dict</span><span class="p">[</span><span class="s1">&#39;csd_average&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">csd_average</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">coherence_dict</span><span class="p">[</span><span class="s1">&#39;n_segs&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">n_segs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">coherence_dict</span><span class="p">[</span><span class="s1">&#39;coherence&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">coherence</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">coherence_dict</span><span class="p">[</span><span class="s1">&#39;frequencies&#39;</span><span class="p">]</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequencies</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">coherence_dict</span><span class="p">[</span><span class="s1">&#39;epoch&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">epoch</span></div>

    <span class="k">def</span> <span class="nf">_get_bad_times_indexes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">times</span><span class="p">,</span> <span class="n">badtimes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">apply_dsc</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get indices for segments with bad GPS times, to be removed from analysis.</span>

<span class="sd">        Parameters</span>
<span class="sd">        =======</span>

<span class="sd">        badtimes: ``array_like``, optional</span>
<span class="sd">            Array of times to exclude from further calculation.</span>
<span class="sd">            Default is None.</span>

<span class="sd">        apply_dsc: ``bool``</span>
<span class="sd">            If True, calculates the indexes of the segments with a bad GPS time, according to the delta sigma cut. If False, returns None.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">apply_dsc</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;badGPStimes&quot;</span><span class="p">):</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                    <span class="s2">&quot;Delta sigma cut has not been calculated yet, hence no delta sigma cut will be applied... If this is a mistake, please run `calculate_delta_sigma_cut` first, then re-calculate point estimate/sigma spectra.&quot;</span>
                <span class="p">)</span>
            <span class="k">if</span> <span class="n">badtimes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;badGPStimes&quot;</span><span class="p">):</span>
                    <span class="n">badtimes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">badtimes</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">badGPStimes</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">badGPStimes</span> <span class="o">=</span> <span class="n">badtimes</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">badtimes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">badGPStimes</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">badtimes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>

        <span class="n">bad_times_indexes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
            <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">t</span> <span class="o">==</span> <span class="n">badtimes</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">times</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">bad_times_indexes</span>

<div class="viewcode-block" id="Baseline.save_point_estimate_spectra"><a class="viewcode-back" href="../../api/pygwb.baseline.Baseline.html#pygwb.baseline.Baseline.save_point_estimate_spectra">[docs]</a>    <span class="k">def</span> <span class="nf">save_point_estimate_spectra</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">save_data_type</span><span class="p">,</span>
        <span class="n">filename</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Save the overall point estimate Y, its error bar sigma,</span>
<span class="sd">        the frequency-dependent estimates and variances and the corresponding frequencies</span>
<span class="sd">        in the required save_data_type, which can be npz, pickle, json or hdf5.</span>
<span class="sd">        You can call upon this data afterwards when loaoding in using the [&#39;key&#39;] dictionary format.</span>

<span class="sd">        Parameters</span>
<span class="sd">        =======</span>
<span class="sd">        </span>
<span class="sd">        save_data_type: ``str``</span>
<span class="sd">            The required type of data file where the information will be stored.</span>

<span class="sd">        filename: ``str``</span>
<span class="sd">            The path/name of the file in which you want to save.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">save_data_type</span> <span class="o">==</span> <span class="s2">&quot;pickle&quot;</span><span class="p">:</span>
            <span class="n">save</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pickle_save</span>
            <span class="n">ext</span> <span class="o">=</span> <span class="s2">&quot;.p&quot;</span>

        <span class="k">elif</span> <span class="n">save_data_type</span> <span class="o">==</span> <span class="s2">&quot;npz&quot;</span><span class="p">:</span>
            <span class="n">save</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_npz_save</span>
            <span class="n">ext</span> <span class="o">=</span> <span class="s2">&quot;.npz&quot;</span>

        <span class="k">elif</span> <span class="n">save_data_type</span> <span class="o">==</span> <span class="s2">&quot;json&quot;</span><span class="p">:</span>
            <span class="n">save</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_json_save</span>
            <span class="n">ext</span> <span class="o">=</span> <span class="s2">&quot;.json&quot;</span>

        <span class="k">elif</span> <span class="n">save_data_type</span> <span class="o">==</span> <span class="s2">&quot;hdf5&quot;</span> <span class="ow">or</span> <span class="n">save_data_type</span> <span class="o">==</span> <span class="s2">&quot;h5&quot;</span><span class="p">:</span>
            <span class="n">save</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hdf5_save</span>
            <span class="n">ext</span> <span class="o">=</span> <span class="s2">&quot;.h5&quot;</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;The provided data type is not supported, try using &#39;pickle&#39;, &#39;npz&#39;, &#39;json&#39; or &#39;hdf5&#39; instead.&quot;</span>
            <span class="p">)</span>

        <span class="n">save</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">filename</span><span class="si">}{</span><span class="n">ext</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">frequencies</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">frequency_mask</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">point_estimate_spectrum</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sigma_spectrum</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">point_estimate</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sigma</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">point_estimate_spectrogram</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sigma_spectrogram</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">badGPStimes</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">delta_sigmas</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">interferometer_1</span><span class="o">.</span><span class="n">gates</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">interferometer_1</span><span class="o">.</span><span class="n">gate_pad</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">interferometer_2</span><span class="o">.</span><span class="n">gates</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">interferometer_2</span><span class="o">.</span><span class="n">gate_pad</span><span class="p">,</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="Baseline.save_psds_csds"><a class="viewcode-back" href="../../api/pygwb.baseline.Baseline.html#pygwb.baseline.Baseline.save_psds_csds">[docs]</a>    <span class="k">def</span> <span class="nf">save_psds_csds</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">save_data_type</span><span class="p">,</span>
        <span class="n">filename</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Save the average and naive psds and csds and the corresponding frequencies</span>
<span class="sd">        in the required save_data_type, which can be npz, pickle, json or hdf5.</span>
<span class="sd">        One can call upon the data afterwards when loading in using the [&#39;key&#39;] dictionary format.</span>

<span class="sd">        Parameters</span>
<span class="sd">        =======</span>

<span class="sd">        save_data_type: ``str``</span>
<span class="sd">            The required type of data file where the information will be stored.</span>

<span class="sd">        filename: ``str``</span>
<span class="sd">            The path/name of the file in which you want to save.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">save_data_type</span> <span class="o">==</span> <span class="s2">&quot;pickle&quot;</span><span class="p">:</span>
            <span class="n">save_csd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pickle_save_csd</span>
            <span class="n">ext</span> <span class="o">=</span> <span class="s2">&quot;.p&quot;</span>

        <span class="k">elif</span> <span class="n">save_data_type</span> <span class="o">==</span> <span class="s2">&quot;npz&quot;</span><span class="p">:</span>
            <span class="n">save_csd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_npz_save_csd</span>
            <span class="n">ext</span> <span class="o">=</span> <span class="s2">&quot;.npz&quot;</span>

        <span class="k">elif</span> <span class="n">save_data_type</span> <span class="o">==</span> <span class="s2">&quot;json&quot;</span><span class="p">:</span>
            <span class="n">save_csd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_json_save_csd</span>
            <span class="n">ext</span> <span class="o">=</span> <span class="s2">&quot;.json&quot;</span>

        <span class="k">elif</span> <span class="n">save_data_type</span> <span class="o">==</span> <span class="s2">&quot;hdf5&quot;</span> <span class="ow">or</span> <span class="n">save_data_type</span> <span class="o">==</span> <span class="s2">&quot;h5&quot;</span><span class="p">:</span>
            <span class="n">save_csd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hdf5_save_csd</span>
            <span class="n">ext</span> <span class="o">=</span> <span class="s2">&quot;.h5&quot;</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;The provided data type is not supported, try using &#39;pickle&#39;, &#39;npz&#39;, &#39;json&#39; or &#39;hdf5&#39; instead.&quot;</span>
            <span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">coherence</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">coherence_spectrum</span>
            <span class="n">psd_1_coh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">coherence_dict</span><span class="p">[</span><span class="s1">&#39;psd_1_average&#39;</span><span class="p">]</span>
            <span class="n">psd_2_coh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">coherence_dict</span><span class="p">[</span><span class="s1">&#39;psd_2_average&#39;</span><span class="p">]</span>
            <span class="n">csd_coh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">coherence_dict</span><span class="p">[</span><span class="s1">&#39;csd_average&#39;</span><span class="p">]</span>
            <span class="n">n_segs_coh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">coherence_dict</span><span class="p">[</span><span class="s1">&#39;n_segs&#39;</span><span class="p">]</span>

        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="n">coherence</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">psd_1_coh</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">psd_2_coh</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">csd_coh</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">n_segs_coh</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="n">save_csd</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">filename</span><span class="si">}{</span><span class="n">ext</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">csd</span><span class="o">.</span><span class="n">frequencies</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">average_csd</span><span class="o">.</span><span class="n">frequencies</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">csd</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">average_csd</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">interferometer_1</span><span class="o">.</span><span class="n">psd_spectrogram</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">interferometer_2</span><span class="o">.</span><span class="n">psd_spectrogram</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">interferometer_1</span><span class="o">.</span><span class="n">average_psd</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">interferometer_2</span><span class="o">.</span><span class="n">average_psd</span><span class="p">,</span>
            <span class="n">coherence</span><span class="p">,</span>
            <span class="n">psd_1_coh</span><span class="p">,</span>
            <span class="n">psd_2_coh</span><span class="p">,</span>
            <span class="n">csd_coh</span><span class="p">,</span>
            <span class="n">n_segs_coh</span><span class="p">,</span>
        <span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_npz_save</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">filename</span><span class="p">,</span>
        <span class="n">frequencies</span><span class="p">,</span>
        <span class="n">frequency_mask</span><span class="p">,</span>
        <span class="n">point_estimate_spectrum</span><span class="p">,</span>
        <span class="n">sigma_spectrum</span><span class="p">,</span>
        <span class="n">point_estimate</span><span class="p">,</span>
        <span class="n">sigma</span><span class="p">,</span>
        <span class="n">point_estimate_spectrogram</span><span class="p">,</span>
        <span class="n">sigma_spectrogram</span><span class="p">,</span>
        <span class="n">badGPStimes</span><span class="p">,</span>
        <span class="n">delta_sigmas</span><span class="p">,</span>
        <span class="n">ifo_1_gates</span><span class="p">,</span>
        <span class="n">ifo_1_gate_pad</span><span class="p">,</span>
        <span class="n">ifo_2_gates</span><span class="p">,</span>
        <span class="n">ifo_2_gate_pad</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">naive_sigma_values</span> <span class="o">=</span> <span class="n">delta_sigmas</span><span class="p">[</span><span class="s2">&quot;naive_sigmas&quot;</span><span class="p">]</span>
            <span class="n">slide_sigma_values</span> <span class="o">=</span> <span class="n">delta_sigmas</span><span class="p">[</span><span class="s2">&quot;slide_sigmas&quot;</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="n">naive_sigma_values</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">slide_sigma_values</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="n">np</span><span class="o">.</span><span class="n">savez</span><span class="p">(</span>
            <span class="n">filename</span><span class="p">,</span>
            <span class="n">frequencies</span><span class="o">=</span><span class="n">frequencies</span><span class="p">,</span>
            <span class="n">frequency_mask</span><span class="o">=</span><span class="n">frequency_mask</span><span class="p">,</span>
            <span class="n">point_estimate_spectrum</span><span class="o">=</span><span class="n">point_estimate_spectrum</span><span class="p">,</span>
            <span class="n">sigma_spectrum</span><span class="o">=</span><span class="n">sigma_spectrum</span><span class="p">,</span>
            <span class="n">point_estimate</span><span class="o">=</span><span class="n">point_estimate</span><span class="p">,</span>
            <span class="n">sigma</span><span class="o">=</span><span class="n">sigma</span><span class="p">,</span>
            <span class="n">point_estimate_spectrogram</span><span class="o">=</span><span class="n">point_estimate_spectrogram</span><span class="p">,</span>
            <span class="n">sigma_spectrogram</span><span class="o">=</span><span class="n">sigma_spectrogram</span><span class="p">,</span>
            <span class="n">badGPStimes</span><span class="o">=</span><span class="n">badGPStimes</span><span class="p">,</span>
            <span class="n">delta_sigma_alphas</span><span class="o">=</span><span class="n">delta_sigmas</span><span class="p">[</span><span class="s2">&quot;alphas&quot;</span><span class="p">],</span>
            <span class="n">delta_sigma_times</span><span class="o">=</span><span class="n">delta_sigmas</span><span class="p">[</span><span class="s2">&quot;times&quot;</span><span class="p">],</span>
            <span class="n">delta_sigma_values</span><span class="o">=</span><span class="n">delta_sigmas</span><span class="p">[</span><span class="s2">&quot;values&quot;</span><span class="p">],</span>
            <span class="n">naive_sigma_values</span><span class="o">=</span><span class="n">naive_sigma_values</span><span class="p">,</span>
            <span class="n">slide_sigma_values</span><span class="o">=</span><span class="n">slide_sigma_values</span><span class="p">,</span>
            <span class="n">ifo_1_gates</span><span class="o">=</span><span class="n">ifo_1_gates</span><span class="p">,</span>
            <span class="n">ifo_1_gate_pad</span><span class="o">=</span><span class="n">ifo_1_gate_pad</span><span class="p">,</span>
            <span class="n">ifo_2_gates</span><span class="o">=</span><span class="n">ifo_2_gates</span><span class="p">,</span>
            <span class="n">ifo_2_gate_pad</span><span class="o">=</span><span class="n">ifo_2_gate_pad</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_pickle_save</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">filename</span><span class="p">,</span>
        <span class="n">frequencies</span><span class="p">,</span>
        <span class="n">frequency_mask</span><span class="p">,</span>
        <span class="n">point_estimate_spectrum</span><span class="p">,</span>
        <span class="n">sigma_spectrum</span><span class="p">,</span>
        <span class="n">point_estimate</span><span class="p">,</span>
        <span class="n">sigma</span><span class="p">,</span>
        <span class="n">point_estimate_spectrogram</span><span class="p">,</span>
        <span class="n">sigma_spectrogram</span><span class="p">,</span>
        <span class="n">badGPStimes</span><span class="p">,</span>
        <span class="n">delta_sigmas</span><span class="p">,</span>
        <span class="n">ifo_1_gates</span><span class="p">,</span>
        <span class="n">ifo_1_gate_pad</span><span class="p">,</span>
        <span class="n">ifo_2_gates</span><span class="p">,</span>
        <span class="n">ifo_2_gate_pad</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="n">save_dictionary</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;frequencies&quot;</span><span class="p">:</span> <span class="n">frequencies</span><span class="p">,</span>
            <span class="s2">&quot;frequency_mask&quot;</span><span class="p">:</span> <span class="n">frequency_mask</span><span class="p">,</span>
            <span class="s2">&quot;point_estimate_spectrum&quot;</span><span class="p">:</span> <span class="n">point_estimate_spectrum</span><span class="p">,</span>
            <span class="s2">&quot;sigma_spectrum&quot;</span><span class="p">:</span> <span class="n">sigma_spectrum</span><span class="p">,</span>
            <span class="s2">&quot;point_estimate&quot;</span><span class="p">:</span> <span class="n">point_estimate</span><span class="p">,</span>
            <span class="s2">&quot;sigma&quot;</span><span class="p">:</span> <span class="n">sigma</span><span class="p">,</span>
            <span class="s2">&quot;point_estimate_spectrogram&quot;</span><span class="p">:</span> <span class="n">point_estimate_spectrogram</span><span class="p">,</span>
            <span class="s2">&quot;sigma_spectrogram&quot;</span><span class="p">:</span> <span class="n">sigma_spectrogram</span><span class="p">,</span>
            <span class="s2">&quot;badGPStimes&quot;</span><span class="p">:</span> <span class="n">badGPStimes</span><span class="p">,</span>
            <span class="s2">&quot;delta_sigmas&quot;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">delta_sigmas</span><span class="o">.</span><span class="n">items</span><span class="p">()),</span>
            <span class="s2">&quot;ifo_1_gates&quot;</span><span class="p">:</span> <span class="n">ifo_1_gates</span><span class="p">,</span>
            <span class="s2">&quot;ifo_1_gate_pad&quot;</span><span class="p">:</span> <span class="n">ifo_1_gate_pad</span><span class="p">,</span>
            <span class="s2">&quot;ifo_2_gates&quot;</span><span class="p">:</span> <span class="n">ifo_2_gates</span><span class="p">,</span>
            <span class="s2">&quot;ifo_2_gate_pad&quot;</span><span class="p">:</span> <span class="n">ifo_2_gate_pad</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">save_dictionary</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_json_save</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">filename</span><span class="p">,</span>
        <span class="n">frequencies</span><span class="p">,</span>
        <span class="n">frequency_mask</span><span class="p">,</span>
        <span class="n">point_estimate_spectrum</span><span class="p">,</span>
        <span class="n">sigma_spectrum</span><span class="p">,</span>
        <span class="n">point_estimate</span><span class="p">,</span>
        <span class="n">sigma</span><span class="p">,</span>
        <span class="n">point_estimate_spectrogram</span><span class="p">,</span>
        <span class="n">sigma_spectrogram</span><span class="p">,</span>
        <span class="n">badGPStimes</span><span class="p">,</span>
        <span class="n">delta_sigmas</span><span class="p">,</span>
        <span class="n">ifo_1_gates</span><span class="p">,</span>
        <span class="n">ifo_1_gate_pad</span><span class="p">,</span>
        <span class="n">ifo_2_gates</span><span class="p">,</span>
        <span class="n">ifo_2_gate_pad</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="n">list_freqs</span> <span class="o">=</span> <span class="n">frequencies</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">list_freqs_mask</span> <span class="o">=</span> <span class="n">frequency_mask</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">list_point_estimate_spectrum_r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">point_estimate_spectrum</span><span class="o">.</span><span class="n">value</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">list_point_estimate_spectrum_i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">point_estimate_spectrum</span><span class="o">.</span><span class="n">value</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">list_sigma_spectrum</span> <span class="o">=</span> <span class="n">sigma_spectrum</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

        <span class="n">list_point_estimate_segment_r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span>
            <span class="n">point_estimate_spectrogram</span><span class="o">.</span><span class="n">value</span>
        <span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">list_point_estimate_segment_i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span>
            <span class="n">point_estimate_spectrogram</span><span class="o">.</span><span class="n">value</span>
        <span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">point_estimate_segment_times</span> <span class="o">=</span> <span class="n">point_estimate_spectrogram</span><span class="o">.</span><span class="n">times</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

        <span class="n">list_sigma_segment</span> <span class="o">=</span> <span class="n">sigma_spectrogram</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">sigma_segment_times</span> <span class="o">=</span> <span class="n">sigma_spectrogram</span><span class="o">.</span><span class="n">times</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

        <span class="n">badGPStimes_list</span> <span class="o">=</span> <span class="n">badGPStimes</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        
        <span class="n">save_dictionary</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;frequencies&quot;</span><span class="p">:</span> <span class="n">list_freqs</span><span class="p">,</span>
            <span class="s2">&quot;frequency_mask&quot;</span><span class="p">:</span> <span class="n">list_freqs_mask</span><span class="p">,</span>
            <span class="s2">&quot;point_estimate_spectrum_real&quot;</span><span class="p">:</span> <span class="n">list_point_estimate_spectrum_r</span><span class="p">,</span>
            <span class="s2">&quot;point_estimate_spectrum_imag&quot;</span><span class="p">:</span> <span class="n">list_point_estimate_spectrum_i</span><span class="p">,</span>
            <span class="s2">&quot;sigma_spectrum&quot;</span><span class="p">:</span> <span class="n">list_sigma_spectrum</span><span class="p">,</span>
            <span class="s2">&quot;point_estimate&quot;</span><span class="p">:</span> <span class="n">point_estimate</span><span class="p">,</span>
            <span class="s2">&quot;sigma&quot;</span><span class="p">:</span> <span class="n">sigma</span><span class="p">,</span>
            <span class="s2">&quot;point_estimate_spectrogram_real&quot;</span><span class="p">:</span> <span class="n">list_point_estimate_segment_r</span><span class="p">,</span>
            <span class="s2">&quot;point_estimate_spectrogram_imag&quot;</span><span class="p">:</span> <span class="n">list_point_estimate_segment_i</span><span class="p">,</span>
            <span class="s2">&quot;point_estimate_spectrogram_times&quot;</span><span class="p">:</span> <span class="n">point_estimate_segment_times</span><span class="p">,</span>
            <span class="s2">&quot;sigma_spectrogram&quot;</span><span class="p">:</span> <span class="n">list_sigma_segment</span><span class="p">,</span>
            <span class="s2">&quot;sigma_spectrogram_times&quot;</span><span class="p">:</span> <span class="n">sigma_segment_times</span><span class="p">,</span>
            <span class="s2">&quot;badGPStimes&quot;</span><span class="p">:</span> <span class="n">badGPStimes_list</span><span class="p">,</span>
            <span class="s2">&quot;delta_sigma_alphas&quot;</span><span class="p">:</span> <span class="n">delta_sigmas</span><span class="p">[</span><span class="s2">&quot;alphas&quot;</span><span class="p">],</span>
            <span class="s2">&quot;delta_sigma_values&quot;</span><span class="p">:</span> <span class="n">delta_sigmas</span><span class="p">[</span><span class="s2">&quot;values&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
            <span class="s2">&quot;ifo_1_gates&quot;</span><span class="p">:</span> <span class="n">ifo_1_gates</span><span class="p">,</span>
            <span class="s2">&quot;ifo_1_gate_pad&quot;</span><span class="p">:</span> <span class="n">ifo_1_gate_pad</span><span class="p">,</span>
            <span class="s2">&quot;ifo_2_gates&quot;</span><span class="p">:</span> <span class="n">ifo_2_gates</span><span class="p">,</span>
            <span class="s2">&quot;ifo_2_gate_pad&quot;</span><span class="p">:</span> <span class="n">ifo_2_gate_pad</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">save_dictionary</span><span class="p">[</span><span class="s2">&quot;naive_sigma_values&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">delta_sigmas</span><span class="p">[</span>
                <span class="s2">&quot;naive_sigmas&quot;</span>
            <span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
            <span class="n">save_dictionary</span><span class="p">[</span><span class="s2">&quot;slide_sigma_values&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">delta_sigmas</span><span class="p">[</span>
                <span class="s2">&quot;slide_sigmas&quot;</span>
            <span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">outfile</span><span class="p">:</span>
            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">save_dictionary</span><span class="p">,</span> <span class="n">outfile</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_hdf5_save</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">filename</span><span class="p">,</span>
        <span class="n">frequencies</span><span class="p">,</span>
        <span class="n">frequency_mask</span><span class="p">,</span>
        <span class="n">point_estimate_spectrum</span><span class="p">,</span>
        <span class="n">sigma_spectrum</span><span class="p">,</span>
        <span class="n">point_estimate</span><span class="p">,</span>
        <span class="n">sigma</span><span class="p">,</span>
        <span class="n">point_estimate_spectrogram</span><span class="p">,</span>
        <span class="n">sigma_spectrogram</span><span class="p">,</span>
        <span class="n">badGPStimes</span><span class="p">,</span>
        <span class="n">delta_sigmas</span><span class="p">,</span>
        <span class="n">ifo_1_gates</span><span class="p">,</span>
        <span class="n">ifo_1_gate_pad</span><span class="p">,</span>
        <span class="n">ifo_2_gates</span><span class="p">,</span>
        <span class="n">ifo_2_gate_pad</span><span class="p">,</span>
        <span class="n">compress</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="n">hf</span> <span class="o">=</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">compress</span><span class="p">:</span>
            <span class="n">compression</span> <span class="o">=</span> <span class="s2">&quot;gzip&quot;</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Data will be compressed without loss of data&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">compression</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="n">hf</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;freqs&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">frequencies</span><span class="p">,</span> <span class="n">compression</span><span class="o">=</span><span class="n">compression</span><span class="p">)</span>
        <span class="n">hf</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;freqs_mask&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">frequency_mask</span><span class="p">,</span> <span class="n">compression</span><span class="o">=</span><span class="n">compression</span><span class="p">)</span>
        <span class="n">hf</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span>
            <span class="s2">&quot;point_estimate_spectrum&quot;</span><span class="p">,</span>
            <span class="n">data</span><span class="o">=</span><span class="n">point_estimate_spectrum</span><span class="p">,</span>
            <span class="n">compression</span><span class="o">=</span><span class="n">compression</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">hf</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span>
            <span class="s2">&quot;sigma_spectrum&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">sigma_spectrum</span><span class="p">,</span> <span class="n">compression</span><span class="o">=</span><span class="n">compression</span>
        <span class="p">)</span>
        <span class="n">hf</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span>
            <span class="s2">&quot;point_estimate&quot;</span><span class="p">,</span>
            <span class="n">data</span><span class="o">=</span><span class="n">point_estimate</span><span class="p">,</span>
            <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;float&quot;</span><span class="p">,</span>
            <span class="n">compression</span><span class="o">=</span><span class="n">compression</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">hf</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;sigma&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">sigma</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;float&quot;</span><span class="p">,</span> <span class="n">compression</span><span class="o">=</span><span class="n">compression</span><span class="p">)</span>
        <span class="n">hf</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span>
            <span class="s2">&quot;point_estimate_spectrogram&quot;</span><span class="p">,</span>
            <span class="n">data</span><span class="o">=</span><span class="n">point_estimate_spectrogram</span><span class="p">,</span>
            <span class="n">compression</span><span class="o">=</span><span class="n">compression</span><span class="p">,</span>
        <span class="p">),</span>
        <span class="n">hf</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span>
            <span class="s2">&quot;sigma_spectrogram&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">sigma_spectrogram</span><span class="p">,</span> <span class="n">compression</span><span class="o">=</span><span class="n">compression</span>
        <span class="p">)</span>
        <span class="n">hf</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;badGPStimes&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">badGPStimes</span><span class="p">,</span> <span class="n">compression</span><span class="o">=</span><span class="n">compression</span><span class="p">)</span>
        <span class="n">delta_sigmas_group</span> <span class="o">=</span> <span class="n">hf</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="s2">&quot;delta_sigmas&quot;</span><span class="p">)</span>
        <span class="n">delta_sigmas_group</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span>
            <span class="s2">&quot;delta_sigma_alphas&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">delta_sigmas</span><span class="p">[</span><span class="s2">&quot;alphas&quot;</span><span class="p">],</span> <span class="n">compression</span><span class="o">=</span><span class="n">compression</span>
        <span class="p">)</span>
        <span class="n">delta_sigmas_group</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span>
            <span class="s2">&quot;delta_sigma_times&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">delta_sigmas</span><span class="p">[</span><span class="s2">&quot;times&quot;</span><span class="p">],</span> <span class="n">compression</span><span class="o">=</span><span class="n">compression</span>
        <span class="p">)</span>
        <span class="n">delta_sigmas_group</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span>
            <span class="s2">&quot;delta_sigma_values&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">delta_sigmas</span><span class="p">[</span><span class="s2">&quot;values&quot;</span><span class="p">],</span> <span class="n">compression</span><span class="o">=</span><span class="n">compression</span>
        <span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">delta_sigmas_group</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span>
                <span class="s2">&quot;naive_sigma_values&quot;</span><span class="p">,</span>
                <span class="n">data</span><span class="o">=</span><span class="n">delta_sigmas</span><span class="p">[</span><span class="s2">&quot;naive_sigmas&quot;</span><span class="p">],</span>
                <span class="n">compression</span><span class="o">=</span><span class="n">compression</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">delta_sigmas_group</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span>
                <span class="s2">&quot;slide_sigma_values&quot;</span><span class="p">,</span>
                <span class="n">data</span><span class="o">=</span><span class="n">delta_sigmas</span><span class="p">[</span><span class="s2">&quot;slide_sigmas&quot;</span><span class="p">],</span>
                <span class="n">compression</span><span class="o">=</span><span class="n">compression</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="n">gates_group</span> <span class="o">=</span> <span class="n">hf</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="s2">&quot;Gated_Times&quot;</span><span class="p">)</span>
        <span class="n">gates_group</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span>
            <span class="s2">&quot;ifo_1_gates&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">ifo_1_gates</span><span class="p">,</span> <span class="n">compression</span><span class="o">=</span><span class="n">compression</span>
        <span class="p">)</span>
        <span class="n">gates_group</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span>
            <span class="s2">&quot;ifo_2_gates&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">ifo_2_gates</span><span class="p">,</span> <span class="n">compression</span><span class="o">=</span><span class="n">compression</span>
        <span class="p">)</span>

        <span class="n">hf</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_npz_save_csd</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">filename</span><span class="p">,</span>
        <span class="n">freqs</span><span class="p">,</span>
        <span class="n">avg_freqs</span><span class="p">,</span>
        <span class="n">csd</span><span class="p">,</span>
        <span class="n">avg_csd</span><span class="p">,</span>
        <span class="n">psd_1</span><span class="p">,</span>
        <span class="n">psd_2</span><span class="p">,</span>
        <span class="n">avg_psd_1</span><span class="p">,</span>
        <span class="n">avg_psd_2</span><span class="p">,</span>
        <span class="n">coherence</span><span class="p">,</span>
        <span class="n">psd_1_coh</span><span class="p">,</span>
        <span class="n">psd_2_coh</span><span class="p">,</span>
        <span class="n">csd_coh</span><span class="p">,</span>
        <span class="n">n_segs_coh</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="n">np</span><span class="o">.</span><span class="n">savez</span><span class="p">(</span>
            <span class="n">filename</span><span class="p">,</span>
            <span class="n">freqs</span><span class="o">=</span><span class="n">freqs</span><span class="p">,</span>
            <span class="n">avg_freqs</span><span class="o">=</span><span class="n">avg_freqs</span><span class="p">,</span>
            <span class="n">csd</span><span class="o">=</span><span class="n">csd</span><span class="p">,</span>
            <span class="n">avg_csd</span><span class="o">=</span><span class="n">avg_csd</span><span class="p">,</span>
            <span class="n">psd_1</span><span class="o">=</span><span class="n">psd_1</span><span class="p">,</span>
            <span class="n">psd_2</span><span class="o">=</span><span class="n">psd_2</span><span class="p">,</span>
            <span class="n">avg_psd_1</span><span class="o">=</span><span class="n">avg_psd_1</span><span class="p">,</span>
            <span class="n">avg_psd_2</span><span class="o">=</span><span class="n">avg_psd_2</span><span class="p">,</span>
            <span class="n">csd_times</span><span class="o">=</span><span class="n">csd</span><span class="o">.</span><span class="n">times</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
            <span class="n">avg_csd_times</span><span class="o">=</span><span class="n">avg_csd</span><span class="o">.</span><span class="n">times</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
            <span class="n">psd_times</span><span class="o">=</span><span class="n">psd_1</span><span class="o">.</span><span class="n">times</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
            <span class="n">avg_psd_times</span><span class="o">=</span><span class="n">avg_psd_1</span><span class="o">.</span><span class="n">times</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
            <span class="n">coherence</span><span class="o">=</span><span class="n">coherence</span><span class="p">,</span>
            <span class="n">psd_1_coh</span><span class="o">=</span><span class="n">psd_1_coh</span><span class="p">,</span>
            <span class="n">psd_2_coh</span><span class="o">=</span><span class="n">psd_2_coh</span><span class="p">,</span>
            <span class="n">csd_coh</span><span class="o">=</span><span class="n">csd_coh</span><span class="p">,</span>
            <span class="n">n_segs_coh</span><span class="o">=</span><span class="n">n_segs_coh</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_pickle_save_csd</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">filename</span><span class="p">,</span>
        <span class="n">freqs</span><span class="p">,</span>
        <span class="n">avg_freqs</span><span class="p">,</span>
        <span class="n">csd</span><span class="p">,</span>
        <span class="n">avg_csd</span><span class="p">,</span>
        <span class="n">psd_1</span><span class="p">,</span>
        <span class="n">psd_2</span><span class="p">,</span>
        <span class="n">avg_psd_1</span><span class="p">,</span>
        <span class="n">avg_psd_2</span><span class="p">,</span>
        <span class="n">coherence</span><span class="p">,</span>
        <span class="n">psd_1_coh</span><span class="p">,</span>
        <span class="n">psd_2_coh</span><span class="p">,</span>
        <span class="n">csd_coh</span><span class="p">,</span>
        <span class="n">n_segs_coh</span><span class="p">,</span>
    <span class="p">):</span>

        <span class="n">save_dictionary</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;freqs&quot;</span><span class="p">:</span> <span class="n">freqs</span><span class="p">,</span>
            <span class="s2">&quot;avg_freqs&quot;</span><span class="p">:</span> <span class="n">avg_freqs</span><span class="p">,</span>
            <span class="s2">&quot;csd&quot;</span><span class="p">:</span> <span class="n">csd</span><span class="p">,</span>
            <span class="s2">&quot;avg_csd&quot;</span><span class="p">:</span> <span class="n">avg_csd</span><span class="p">,</span>
            <span class="s2">&quot;psd_1&quot;</span><span class="p">:</span> <span class="n">psd_1</span><span class="p">,</span>
            <span class="s2">&quot;psd_2&quot;</span><span class="p">:</span> <span class="n">psd_2</span><span class="p">,</span>
            <span class="s2">&quot;avg_psd_1&quot;</span><span class="p">:</span> <span class="n">avg_psd_1</span><span class="p">,</span>
            <span class="s2">&quot;avg_psd_2&quot;</span><span class="p">:</span> <span class="n">avg_psd_2</span><span class="p">,</span>
            <span class="s2">&quot;coherence&quot;</span><span class="p">:</span> <span class="n">coherence</span><span class="p">,</span>
            <span class="s2">&quot;psd_1_coh&quot;</span><span class="p">:</span> <span class="n">psd_1_coh</span><span class="p">,</span>
            <span class="s2">&quot;psd_2_coh&quot;</span><span class="p">:</span> <span class="n">psd_2_coh</span><span class="p">,</span>
            <span class="s2">&quot;csd_coh&quot;</span><span class="p">:</span> <span class="n">csd_coh</span><span class="p">,</span>
            <span class="s2">&quot;n_segs_coh&quot;</span><span class="p">:</span> <span class="n">n_segs_coh</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="c1"># with open(filename, &quot;wb&quot;) as f:</span>
        <span class="c1">#   pickle.dump(saveObject, f)</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">save_dictionary</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_json_save_csd</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">filename</span><span class="p">,</span>
        <span class="n">freqs</span><span class="p">,</span>
        <span class="n">avg_freqs</span><span class="p">,</span>
        <span class="n">csd</span><span class="p">,</span>
        <span class="n">avg_csd</span><span class="p">,</span>
        <span class="n">psd_1</span><span class="p">,</span>
        <span class="n">psd_2</span><span class="p">,</span>
        <span class="n">avg_psd_1</span><span class="p">,</span>
        <span class="n">avg_psd_2</span><span class="p">,</span>
        <span class="n">coherence</span><span class="p">,</span>
        <span class="n">psd_1_coh</span><span class="p">,</span>
        <span class="n">psd_2_coh</span><span class="p">,</span>
        <span class="n">csd_coh</span><span class="p">,</span>
        <span class="n">n_segs_coh</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        It seems that saving spectrograms in json does not work, hence everything is converted into a list and saved that way in the json file.</span>
<span class="sd">        A second issue is that json does not seem to recognise complex values, hence the csd is split up into a real and imaginary part.</span>
<span class="sd">        When loading in this json file, one needs to &#39;reconstruct&#39; the csd as a spectrogram using these two lists and the times and frequencies.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">list_freqs</span> <span class="o">=</span> <span class="n">freqs</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">list_avg_freqs</span> <span class="o">=</span> <span class="n">avg_freqs</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">list_csd</span> <span class="o">=</span> <span class="n">csd</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">real_csd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">list_csd</span><span class="p">))</span>
        <span class="n">imag_csd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">list_csd</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">list_csd</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">elem</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">row</span><span class="p">):</span>
                <span class="n">real_csd</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">elem</span><span class="o">.</span><span class="n">real</span>
                <span class="n">imag_csd</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">elem</span><span class="o">.</span><span class="n">imag</span>
        <span class="n">real_csd_list</span> <span class="o">=</span> <span class="n">real_csd</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">imag_csd_list</span> <span class="o">=</span> <span class="n">imag_csd</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">csd_times</span> <span class="o">=</span> <span class="n">csd</span><span class="o">.</span><span class="n">times</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">list_avg_csd</span> <span class="o">=</span> <span class="n">avg_csd</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">real_avg_csd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">list_avg_csd</span><span class="p">))</span>
        <span class="n">imag_avg_csd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">list_avg_csd</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">list_avg_csd</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">elem</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">row</span><span class="p">):</span>
                <span class="n">real_avg_csd</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">elem</span><span class="o">.</span><span class="n">real</span>
                <span class="n">imag_avg_csd</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">elem</span><span class="o">.</span><span class="n">imag</span>
        <span class="n">real_avg_csd_list</span> <span class="o">=</span> <span class="n">real_avg_csd</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">imag_avg_csd_list</span> <span class="o">=</span> <span class="n">imag_avg_csd</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">avg_csd_times</span> <span class="o">=</span> <span class="n">avg_csd</span><span class="o">.</span><span class="n">times</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">list_psd_1</span> <span class="o">=</span> <span class="n">psd_1</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">psd_times</span> <span class="o">=</span> <span class="n">psd_1</span><span class="o">.</span><span class="n">times</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">list_psd_2</span> <span class="o">=</span> <span class="n">psd_2</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">psd_2_times</span> <span class="o">=</span> <span class="n">psd_2</span><span class="o">.</span><span class="n">times</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">list_avg_psd_1</span> <span class="o">=</span> <span class="n">avg_psd_1</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">avg_psd_times</span> <span class="o">=</span> <span class="n">avg_psd_1</span><span class="o">.</span><span class="n">times</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">list_avg_psd_2</span> <span class="o">=</span> <span class="n">avg_psd_2</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">avg_psd_2_times</span> <span class="o">=</span> <span class="n">avg_psd_2</span><span class="o">.</span><span class="n">times</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">coherence</span><span class="p">:</span>
            <span class="n">list_coherence</span> <span class="o">=</span> <span class="n">coherence</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
            <span class="n">list_psd_1_coh</span> <span class="o">=</span> <span class="n">psd_1_coh</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
            <span class="n">list_psd_2_coh</span> <span class="o">=</span> <span class="n">psd_2_coh</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
            <span class="n">list_csd_coh</span> <span class="o">=</span> <span class="n">csd_coh</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
            <span class="n">real_csd_coh</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">list_csd_coh</span><span class="p">))</span>
            <span class="n">imag_csd_coh</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">list_csd_coh</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">ix</span><span class="p">,</span> <span class="n">elem</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">list_csd_coh</span><span class="p">):</span>
                    <span class="n">real_csd_coh</span><span class="p">[</span><span class="n">ix</span><span class="p">]</span> <span class="o">=</span> <span class="n">elem</span><span class="o">.</span><span class="n">real</span>
                    <span class="n">imag_csd_coh</span><span class="p">[</span><span class="n">ix</span><span class="p">]</span> <span class="o">=</span> <span class="n">elem</span><span class="o">.</span><span class="n">imag</span>
            <span class="n">real_csd_coh_list</span> <span class="o">=</span> <span class="n">real_csd_coh</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
            <span class="n">imag_csd_coh_list</span> <span class="o">=</span> <span class="n">imag_csd_coh</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
            <span class="n">list_n_segs_coh</span> <span class="o">=</span> <span class="n">n_segs_coh</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">list_coherence</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">list_psd_1_coh</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">list_psd_2_coh</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">list_csd_coh</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">real_csd_coh_list</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">imag_csd_coh_list</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">list_n_segs_coh</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="n">save_dictionary</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;frequencies&quot;</span><span class="p">:</span> <span class="n">list_freqs</span><span class="p">,</span>
            <span class="s2">&quot;avg_frequencies&quot;</span><span class="p">:</span> <span class="n">list_avg_freqs</span><span class="p">,</span>
            <span class="s2">&quot;csd_real&quot;</span><span class="p">:</span> <span class="n">real_csd_list</span><span class="p">,</span>
            <span class="s2">&quot;csd_imag&quot;</span><span class="p">:</span> <span class="n">imag_csd_list</span><span class="p">,</span>
            <span class="s2">&quot;csd_times&quot;</span><span class="p">:</span> <span class="n">csd_times</span><span class="p">,</span>
            <span class="s2">&quot;avg_csd_real&quot;</span><span class="p">:</span> <span class="n">real_avg_csd_list</span><span class="p">,</span>
            <span class="s2">&quot;avg_csd_imag&quot;</span><span class="p">:</span> <span class="n">imag_avg_csd_list</span><span class="p">,</span>
            <span class="s2">&quot;avg_csd_times&quot;</span><span class="p">:</span> <span class="n">avg_csd_times</span><span class="p">,</span>
            <span class="s2">&quot;psd_1&quot;</span><span class="p">:</span> <span class="n">list_psd_1</span><span class="p">,</span>
            <span class="s2">&quot;psd_1_times&quot;</span><span class="p">:</span> <span class="n">psd_times</span><span class="p">,</span>
            <span class="s2">&quot;psd_2&quot;</span><span class="p">:</span> <span class="n">list_psd_2</span><span class="p">,</span>
            <span class="s2">&quot;psd_2_times&quot;</span><span class="p">:</span> <span class="n">psd_2_times</span><span class="p">,</span>
            <span class="s2">&quot;avg_psd_1&quot;</span><span class="p">:</span> <span class="n">list_avg_psd_1</span><span class="p">,</span>
            <span class="s2">&quot;avg_psd_1_times&quot;</span><span class="p">:</span> <span class="n">avg_psd_times</span><span class="p">,</span>
            <span class="s2">&quot;avg_psd_2&quot;</span><span class="p">:</span> <span class="n">list_avg_psd_2</span><span class="p">,</span>
            <span class="s2">&quot;avg_psd_2_times&quot;</span><span class="p">:</span> <span class="n">avg_psd_2_times</span><span class="p">,</span>
            <span class="s2">&quot;coherence&quot;</span><span class="p">:</span> <span class="n">list_coherence</span><span class="p">,</span>
            <span class="s2">&quot;psd_1_coh&quot;</span><span class="p">:</span> <span class="n">list_psd_1_coh</span><span class="p">,</span>
            <span class="s2">&quot;psd_2_coh&quot;</span><span class="p">:</span> <span class="n">list_psd_2_coh</span><span class="p">,</span>
            <span class="s2">&quot;csd_coh_real&quot;</span><span class="p">:</span> <span class="n">real_csd_coh_list</span><span class="p">,</span>
            <span class="s2">&quot;csd_coh_imag&quot;</span><span class="p">:</span> <span class="n">real_csd_coh_list</span><span class="p">,</span>
            <span class="s2">&quot;n_segs_coh&quot;</span><span class="p">:</span> <span class="n">list_n_segs_coh</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">outfile</span><span class="p">:</span>
            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">save_dictionary</span><span class="p">,</span> <span class="n">outfile</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_hdf5_save_csd</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">filename</span><span class="p">,</span>
        <span class="n">freqs</span><span class="p">,</span>
        <span class="n">avg_freqs</span><span class="p">,</span>
        <span class="n">csd</span><span class="p">,</span>
        <span class="n">avg_csd</span><span class="p">,</span>
        <span class="n">psd_1</span><span class="p">,</span>
        <span class="n">psd_2</span><span class="p">,</span>
        <span class="n">avg_psd_1</span><span class="p">,</span>
        <span class="n">avg_psd_2</span><span class="p">,</span>
        <span class="n">coherence</span><span class="p">,</span>
        <span class="n">psd_1_coh</span><span class="p">,</span>
        <span class="n">psd_2_coh</span><span class="p">,</span>
        <span class="n">csd_coh</span><span class="p">,</span>
        <span class="n">n_segs_coh</span><span class="p">,</span>
        <span class="n">compress</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="n">hf</span> <span class="o">=</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>

        <span class="n">csd_times</span> <span class="o">=</span> <span class="n">csd</span><span class="o">.</span><span class="n">times</span><span class="o">.</span><span class="n">value</span>
        <span class="n">psd_1_times</span> <span class="o">=</span> <span class="n">psd_1</span><span class="o">.</span><span class="n">times</span><span class="o">.</span><span class="n">value</span>
        <span class="n">psd_2_times</span> <span class="o">=</span> <span class="n">psd_2</span><span class="o">.</span><span class="n">times</span><span class="o">.</span><span class="n">value</span>
        <span class="n">avg_csd_times</span> <span class="o">=</span> <span class="n">avg_csd</span><span class="o">.</span><span class="n">times</span><span class="o">.</span><span class="n">value</span>
        <span class="n">avg_psd_1_times</span> <span class="o">=</span> <span class="n">avg_psd_1</span><span class="o">.</span><span class="n">times</span><span class="o">.</span><span class="n">value</span>
        <span class="n">avg_psd_2_times</span> <span class="o">=</span> <span class="n">avg_psd_2</span><span class="o">.</span><span class="n">times</span><span class="o">.</span><span class="n">value</span>

        <span class="k">if</span> <span class="n">compress</span><span class="p">:</span>
            <span class="n">compression</span> <span class="o">=</span> <span class="s2">&quot;gzip&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">compression</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="n">hf</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;freqs&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">freqs</span><span class="p">,</span> <span class="n">compression</span><span class="o">=</span><span class="n">compression</span><span class="p">)</span>
        <span class="n">hf</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;avg_freqs&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">avg_freqs</span><span class="p">,</span> <span class="n">compression</span><span class="o">=</span><span class="n">compression</span><span class="p">)</span>

        <span class="n">csd_group</span> <span class="o">=</span> <span class="n">hf</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="s2">&quot;csd_group&quot;</span><span class="p">)</span>
        <span class="n">csd_group</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;csd&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">csd</span><span class="p">,</span> <span class="n">compression</span><span class="o">=</span><span class="n">compression</span><span class="p">)</span>
        <span class="n">csd_group</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;csd_times&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">csd_times</span><span class="p">,</span> <span class="n">compression</span><span class="o">=</span><span class="n">compression</span><span class="p">)</span>

        <span class="n">avg_csd_group</span> <span class="o">=</span> <span class="n">hf</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="s2">&quot;avg_csd_group&quot;</span><span class="p">)</span>
        <span class="n">avg_csd_group</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;avg_csd&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">avg_csd</span><span class="p">,</span> <span class="n">compression</span><span class="o">=</span><span class="n">compression</span><span class="p">)</span>
        <span class="n">avg_csd_group</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span>
            <span class="s2">&quot;avg_csd_times&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">avg_csd_times</span><span class="p">,</span> <span class="n">compression</span><span class="o">=</span><span class="n">compression</span>
        <span class="p">)</span>

        <span class="n">psd_group</span> <span class="o">=</span> <span class="n">hf</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="s2">&quot;psds_group&quot;</span><span class="p">)</span>

        <span class="n">psd_1_group</span> <span class="o">=</span> <span class="n">hf</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="s2">&quot;psds_group/psd_1&quot;</span><span class="p">)</span>
        <span class="n">psd_1_group</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;psd_1&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">psd_1</span><span class="p">,</span> <span class="n">compression</span><span class="o">=</span><span class="n">compression</span><span class="p">)</span>
        <span class="n">psd_1_group</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span>
            <span class="s2">&quot;psd_1_times&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">psd_1_times</span><span class="p">,</span> <span class="n">compression</span><span class="o">=</span><span class="n">compression</span>
        <span class="p">)</span>

        <span class="n">psd_2_group</span> <span class="o">=</span> <span class="n">hf</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="s2">&quot;psds_group/psd_2&quot;</span><span class="p">)</span>
        <span class="n">psd_2_group</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;psd_2&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">psd_2</span><span class="p">,</span> <span class="n">compression</span><span class="o">=</span><span class="n">compression</span><span class="p">)</span>
        <span class="n">psd_2_group</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span>
            <span class="s2">&quot;psd_2_times&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">psd_2_times</span><span class="p">,</span> <span class="n">compression</span><span class="o">=</span><span class="n">compression</span>
        <span class="p">)</span>

        <span class="n">avg_psd_group</span> <span class="o">=</span> <span class="n">hf</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="s2">&quot;avg_psds_group&quot;</span><span class="p">)</span>

        <span class="n">avg_psd_1_group</span> <span class="o">=</span> <span class="n">hf</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="s2">&quot;avg_psds_group/avg_psd_1&quot;</span><span class="p">)</span>
        <span class="n">avg_psd_1_group</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span>
            <span class="s2">&quot;avg_psd_1&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">avg_psd_1</span><span class="p">,</span> <span class="n">compression</span><span class="o">=</span><span class="n">compression</span>
        <span class="p">)</span>
        <span class="n">avg_psd_1_group</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span>
            <span class="s2">&quot;avg_psd_1_times&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">avg_psd_1_times</span><span class="p">,</span> <span class="n">compression</span><span class="o">=</span><span class="n">compression</span>
        <span class="p">)</span>

        <span class="n">avg_psd_2_group</span> <span class="o">=</span> <span class="n">hf</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="s2">&quot;avg_psds_group/avg_psd_2&quot;</span><span class="p">)</span>
        <span class="n">avg_psd_2_group</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span>
            <span class="s2">&quot;avg_psd_2&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">avg_psd_2</span><span class="p">,</span> <span class="n">compression</span><span class="o">=</span><span class="n">compression</span>
        <span class="p">)</span>
        <span class="n">avg_psd_2_group</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span>
            <span class="s2">&quot;avg_psd_2_times&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">avg_psd_2_times</span><span class="p">,</span> <span class="n">compression</span><span class="o">=</span><span class="n">compression</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">coherence</span><span class="p">:</span>
            <span class="n">hf</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;coherence&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">coherence</span><span class="p">,</span> <span class="n">compression</span><span class="o">=</span><span class="n">compression</span><span class="p">)</span>
            <span class="n">hf</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;psd_1_coherence&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">psd_1_coh</span><span class="p">,</span> <span class="n">compression</span><span class="o">=</span><span class="n">compression</span><span class="p">)</span>
            <span class="n">hf</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;psd_2_coherence&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">psd_2_coh</span><span class="p">,</span> <span class="n">compression</span><span class="o">=</span><span class="n">compression</span><span class="p">)</span>
            <span class="n">hf</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;csd_coherence&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">csd_coh</span><span class="p">,</span> <span class="n">compression</span><span class="o">=</span><span class="n">compression</span><span class="p">)</span>
            <span class="n">hf</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;n_segs_coherence&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">n_segs_coh</span><span class="p">,</span> <span class="n">compression</span><span class="o">=</span><span class="n">compression</span><span class="p">)</span>

        <span class="n">hf</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>

<div class="viewcode-block" id="get_baselines"><a class="viewcode-back" href="../../api/pygwb.baseline.get_baselines.html#pygwb.baseline.get_baselines">[docs]</a><span class="k">def</span> <span class="nf">get_baselines</span><span class="p">(</span><span class="n">interferometers</span><span class="p">,</span> <span class="n">frequencies</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get set of Baseline objects given a list of interferometers.</span>

<span class="sd">    Parameters</span>
<span class="sd">    =======</span>

<span class="sd">    interferometers: ``list``</span>
<span class="sd">        List of bilby.interferometer objects.</span>
<span class="sd">    </span>
<span class="sd">    frequencies: ``array_like``, optional</span>
<span class="sd">        Frequencies to construct the baseline with. Defaults to None.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">Nd</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">interferometers</span><span class="p">)</span>

    <span class="n">combo_tuples</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">Nd</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">j</span><span class="p">):</span>
            <span class="n">combo_tuples</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">k</span><span class="p">,</span> <span class="n">j</span><span class="p">))</span>

    <span class="n">baselines</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">combo_tuples</span><span class="p">:</span>
        <span class="n">base_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">interferometers</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">interferometers</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">baselines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="n">Baseline</span><span class="p">(</span>
                <span class="n">base_name</span><span class="p">,</span>
                <span class="n">interferometers</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                <span class="n">interferometers</span><span class="p">[</span><span class="n">j</span><span class="p">],</span>
                <span class="n">frequencies</span><span class="o">=</span><span class="n">frequencies</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>
    <span class="k">return</span> <span class="n">baselines</span></div>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Arianna Renzini, Sylvia Biscoveanu, Shivaraj Khandasamy, Kamiel Janssens, Max Lalleman, Katarina Martinovic, Andrew Matas, Patrick Meyers, Alba Romero, Colm Talbot, Leo Tsukada, Kevin Turbang.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>