<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>pygwb.pe &mdash; pygwb 1.3 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=fa44fd50" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../../_static/tabs.css?v=a5c4661c" />

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js?v=0264ad83"></script>
        <script src="../../_static/doctools.js?v=888ff710"></script>
        <script src="../../_static/sphinx_highlight.js?v=4825356b"></script>
        <script src="../../_static/tabs.js?v=3030b3cb"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="author" title="About these documents" href="../../about.html" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html">
            
              <img src="../../_static/pygwb_logo_plasma_cropped.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                1.3
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../about.html">About <code class="docutils literal notranslate"><span class="pre">pygwb</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorials.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../demos.html">Demos</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api.html">API</a></li>
<li class="toctree-l1"><a class="reference external" href="https://arxiv.org/pdf/2303.15696.pdf">pygwb paper</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../citing.html">Citing <code class="docutils literal notranslate"><span class="pre">pygwb</span></code></a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/a-renzini/pygwb">GitHub</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contributing.html">Contributing guide</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/a-renzini/pygwb/issues/new">Submit an issue</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">pygwb</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Module code</a></li>
      <li class="breadcrumb-item active">pygwb.pe</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for pygwb.pe</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">The ``pe`` module performs parameter estimation (PE) as an integral part of the</span>
<span class="sd">analysis, which naturally follows the computation of the optimal estimate of the gravitational-wave background (GWB). </span>
<span class="sd">The ``pe`` module is a simple and user-friendly toolkit for any model builder to constrain their physical models with gravitational-wave (GW) data.</span>
<span class="sd">The ``pe`` module is built on class inheritance, with ``GWBModel`` as the parent class. The methods of the parent class</span>
<span class="sd">are functions shared between different GWB models, e.g., the likelihood formulation, as well as the noise</span>
<span class="sd">likelihood. It is possible to include a calibration uncertainty by modifying the</span>
<span class="sd">calibration epsilon parameter, which defaults to 0. The GW polarization used for analysis is user-defined, and defaults to standard</span>
<span class="sd">General Relativity (GR) polarization (i.e., tensor).</span>

<span class="sd">In our implementation of ``pe``, we rely on the ``bilby`` package (more information `here &lt;https://lscsoft.docs.ligo.org/bilby/&gt;`_) to perform a parameter space</span>
<span class="sd">exploration, and employ the sampler ``dynesty`` (more information `here &lt;https://dynesty.readthedocs.io/en/stable/&gt;`_) by default. The user has flexibility in choosing the</span>
<span class="sd">sampler as well as the sampler settings.</span>

<span class="sd">Child classes in the ``pe`` module inherit attributes and methods from the ``GWBModel`` class. Each child class represents</span>
<span class="sd">a single GWB model, and combined they form a catalog of available GWB models that may be probed with GW data.</span>
<span class="sd">The inheritance structure of the module makes it straightforward to expand the catalog, allowing users of the ``pygwb``</span>
<span class="sd">package to add their own models. The flexibility of the ``pe`` module allows the user to combine several GWB</span>
<span class="sd">models defined within the module. A particularly useful application of this is the modelling of a GWB in the presence</span>
<span class="sd">of correlated magnetic noise, or the simultaneous estimation of astrophysical and</span>
<span class="sd">cosmological GWBs.</span>

<span class="sd">Additional information about parameter estimation can be found `here &lt;https://arxiv.org/pdf/2303.15696.pdf&gt;`_. For more information on</span>
<span class="sd">how to use this module, we refer the reader to the dedicated tutorials and demos.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">abc</span> <span class="kn">import</span> <span class="n">abstractmethod</span>

<span class="kn">import</span> <span class="nn">bilby</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">scipy.special</span> <span class="kn">import</span> <span class="n">erf</span>

<span class="kn">from</span> <span class="nn">.baseline</span> <span class="kn">import</span> <span class="n">Baseline</span>


<div class="viewcode-block" id="GWBModel"><a class="viewcode-back" href="../../api/pygwb.pe.GWBModel.html#pygwb.pe.GWBModel">[docs]</a><span class="k">class</span> <span class="nc">GWBModel</span><span class="p">(</span><span class="n">bilby</span><span class="o">.</span><span class="n">Likelihood</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generic model, contains the definition of likelihood:</span>

<span class="sd">    .. math::</span>

<span class="sd">        p(\hat{C}^{IJ}(f_k) | \mathbf{\Theta}) \propto\exp\left[  -\frac{1}{2} \sum_{IJ}^N \sum_k \left(\frac{\hat{C}^{IJ}(f_k) - \Omega_{\rm M}(f_k|\mathbf{\Theta})}{\sigma_{IJ}(f_k)}\right)^2  \right],</span>

<span class="sd">    where :math:`\Omega_{\rm M}(f_k|\mathbf{\Theta})` is the model being fit to data, and :math:`\mathbf{\Theta}` are the model&#39;s parameters.</span>

<span class="sd">    The noise likelihood is given by setting :math:`\Omega_{\rm M}(f_k|\mathbf{\Theta})=0`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="GWBModel.__init__"><a class="viewcode-back" href="../../api/pygwb.pe.GWBModel.html#pygwb.pe.GWBModel.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">baselines</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">model_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">polarizations</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        See also</span>
<span class="sd">        --------</span>
<span class="sd">        bilby.Likelihood</span>
<span class="sd">            More information `here &lt;https://lscsoft.docs.ligo.org/bilby/likelihood.html&gt;`_.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">GWBModel</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="c1"># list of baselines</span>
        <span class="k">if</span> <span class="n">baselines</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;List of baselines must be supplied!&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">model_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;model_name must be supplied!&quot;</span><span class="p">)</span>
        <span class="c1"># if single baseline supplied, that&#39;s fine</span>
        <span class="c1"># just make it a list</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">baselines</span><span class="p">,</span> <span class="n">Baseline</span><span class="p">):</span>
            <span class="n">baselines</span> <span class="o">=</span> <span class="p">[</span><span class="n">baselines</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">baselines</span> <span class="o">=</span> <span class="n">baselines</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">orfs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">polarizations</span> <span class="o">=</span> <span class="n">polarizations</span>
        <span class="c1"># if polarizations is not supplied</span>
        <span class="k">if</span> <span class="n">polarizations</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">polarizations</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;tensor&quot;</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">baselines</span><span class="p">))]</span>
        <span class="k">for</span> <span class="n">bline</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">baselines</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">polarizations</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;tensor&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">orfs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bline</span><span class="o">.</span><span class="n">tensor_overlap_reduction_function</span><span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">polarizations</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;vector&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">orfs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bline</span><span class="o">.</span><span class="n">vector_overlap_reduction_function</span><span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">polarizations</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;scalar&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">orfs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bline</span><span class="o">.</span><span class="n">scalar_overlap_reduction_function</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;unexpected type for polarizations </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">polarizations</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>
        <span class="n">bilby</span><span class="o">.</span><span class="n">Likelihood</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">)</span></div>

<div class="viewcode-block" id="GWBModel.parameters"><a class="viewcode-back" href="../../api/pygwb.pe.GWBModel.html#pygwb.pe.GWBModel.parameters">[docs]</a>    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Parameters to be inferred from the data. Should return a dictionary.&quot;&quot;&quot;</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="GWBModel.model_function"><a class="viewcode-back" href="../../api/pygwb.pe.GWBModel.html#pygwb.pe.GWBModel.model_function">[docs]</a>    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">model_function</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Function for evaluating model.&quot;&quot;&quot;</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="GWBModel.log_likelihood_IJ"><a class="viewcode-back" href="../../api/pygwb.pe.GWBModel.html#pygwb.pe.GWBModel.log_likelihood_IJ">[docs]</a>    <span class="k">def</span> <span class="nf">log_likelihood_IJ</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">baseline</span><span class="p">,</span> <span class="n">freq_mask</span><span class="p">,</span> <span class="n">noise</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function for evaluating log likelihood of IJ baseline pair.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        =======</span>
<span class="sd">        </span>
<span class="sd">        baseline: ``pygwb.Baseline``</span>
<span class="sd">            Baseline for which to run parameter estimation on.</span>
<span class="sd">        </span>
<span class="sd">        noise: ``bool``, optional</span>
<span class="sd">            Parameter to indicate whether the likelihood should be evaluated assuming</span>
<span class="sd">            the signal model, or assuming only noise is present in the data.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        =======</span>
<span class="sd">        </span>
<span class="sd">        logL_IJ: ``float``</span>
<span class="sd">            Log likelihood value for the IJ baseline pair.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">noise</span><span class="p">:</span>
            <span class="n">Y_model_f</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">Y_model_f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_function</span><span class="p">(</span><span class="n">baseline</span><span class="p">)</span>

        <span class="c1"># simple likelihood without calibration uncertainty</span>
        <span class="k">if</span> <span class="n">baseline</span><span class="o">.</span><span class="n">calibration_epsilon</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">logL_IJ</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span>
                <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span>
                    <span class="p">(</span><span class="n">baseline</span><span class="o">.</span><span class="n">point_estimate_spectrum</span> <span class="o">-</span> <span class="n">Y_model_f</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
                    <span class="o">/</span> <span class="n">baseline</span><span class="o">.</span><span class="n">sigma_spectrum</span> <span class="o">**</span> <span class="mi">2</span><span class="p">,</span>
                    <span class="n">where</span><span class="o">=</span><span class="n">freq_mask</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">baseline</span><span class="o">.</span><span class="n">sigma_spectrum</span> <span class="o">**</span> <span class="mi">2</span><span class="p">),</span> <span class="n">where</span><span class="o">=</span><span class="n">freq_mask</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="c1"># likelihood with calibration uncertainty marginalizatione done analytically</span>
        <span class="c1"># see https://stochastic-alog.ligo.org/aLOG//index.php?callRep=339711</span>
        <span class="c1"># note \cal{N} = \Prod_j sqrt(2*pi*sigma_j^2)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">A</span> <span class="o">=</span> <span class="n">baseline</span><span class="o">.</span><span class="n">calibration_epsilon</span> <span class="o">**</span> <span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span>
                <span class="n">Y_model_f</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="n">baseline</span><span class="o">.</span><span class="n">sigma_spectrum</span> <span class="o">**</span> <span class="mi">2</span><span class="p">,</span>
                <span class="n">where</span><span class="o">=</span><span class="n">freq_mask</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">B</span> <span class="o">=</span> <span class="n">baseline</span><span class="o">.</span><span class="n">calibration_epsilon</span> <span class="o">**</span> <span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span>
                <span class="n">Y_model_f</span>
                <span class="o">*</span> <span class="n">baseline</span><span class="o">.</span><span class="n">point_estimate_spectrum</span>
                <span class="o">/</span> <span class="n">baseline</span><span class="o">.</span><span class="n">sigma_spectrum</span> <span class="o">**</span> <span class="mi">2</span><span class="p">,</span>
                <span class="n">where</span><span class="o">=</span><span class="n">freq_mask</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">C</span> <span class="o">=</span> <span class="n">baseline</span><span class="o">.</span><span class="n">calibration_epsilon</span> <span class="o">**</span> <span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span>
                <span class="n">baseline</span><span class="o">.</span><span class="n">point_estimate_spectrum</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="n">baseline</span><span class="o">.</span><span class="n">sigma_spectrum</span> <span class="o">**</span> <span class="mi">2</span><span class="p">,</span>
                <span class="n">where</span><span class="o">=</span><span class="n">freq_mask</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">log_norm</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">baseline</span><span class="o">.</span><span class="n">sigma_spectrum</span> <span class="o">**</span> <span class="mi">2</span><span class="p">),</span> <span class="n">where</span><span class="o">=</span><span class="n">freq_mask</span><span class="p">)</span>

            <span class="n">logL_IJ</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">log_norm</span>
                <span class="o">-</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">A</span> <span class="o">*</span> <span class="n">baseline</span><span class="o">.</span><span class="n">calibration_epsilon</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
                <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">erf</span><span class="p">(</span><span class="n">B</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">A</span><span class="p">)))</span>
                <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">erf</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">baseline</span><span class="o">.</span><span class="n">calibration_epsilon</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)))</span>
                <span class="o">-</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">C</span> <span class="o">-</span> <span class="n">B</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="n">A</span><span class="p">)</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">logL_IJ</span></div>

<div class="viewcode-block" id="GWBModel.log_likelihood"><a class="viewcode-back" href="../../api/pygwb.pe.GWBModel.html#pygwb.pe.GWBModel.log_likelihood">[docs]</a>    <span class="k">def</span> <span class="nf">log_likelihood</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function for evaluating log likelihood of detector network.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ll</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">baseline</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">baselines</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">baseline</span><span class="p">,</span><span class="s2">&quot;frequency_mask&quot;</span><span class="p">):</span>
                <span class="n">ll</span> <span class="o">=</span> <span class="n">ll</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_likelihood_IJ</span><span class="p">(</span><span class="n">baseline</span><span class="p">,</span> <span class="n">freq_mask</span><span class="o">=</span><span class="n">baseline</span><span class="o">.</span><span class="n">frequency_mask</span><span class="p">,</span> <span class="n">noise</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ll</span> <span class="o">=</span> <span class="n">ll</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_likelihood_IJ</span><span class="p">(</span>
                    <span class="n">baseline</span><span class="p">,</span>
                    <span class="n">freq_mask</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">baseline</span><span class="o">.</span><span class="n">frequencies</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">),</span>
                    <span class="n">noise</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="p">)</span>
        <span class="k">return</span> <span class="n">ll</span></div>

<div class="viewcode-block" id="GWBModel.noise_log_likelihood"><a class="viewcode-back" href="../../api/pygwb.pe.GWBModel.html#pygwb.pe.GWBModel.noise_log_likelihood">[docs]</a>    <span class="k">def</span> <span class="nf">noise_log_likelihood</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function for evaluating noise log likelihood of detector network.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ll</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">baseline</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">baselines</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">baseline</span><span class="p">,</span><span class="s2">&quot;frequency_mask&quot;</span><span class="p">):</span>
                <span class="n">ll</span> <span class="o">=</span> <span class="n">ll</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_likelihood_IJ</span><span class="p">(</span><span class="n">baseline</span><span class="p">,</span> <span class="n">freq_mask</span><span class="o">=</span><span class="n">baseline</span><span class="o">.</span><span class="n">frequency_mask</span><span class="p">,</span> <span class="n">noise</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ll</span> <span class="o">=</span> <span class="n">ll</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_likelihood_IJ</span><span class="p">(</span>
                    <span class="n">baseline</span><span class="p">,</span>
                    <span class="n">freq_mask</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">baseline</span><span class="o">.</span><span class="n">frequencies</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">),</span>
                    <span class="n">noise</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="p">)</span>
        <span class="k">return</span> <span class="n">ll</span></div></div>

<div class="viewcode-block" id="PowerLawModel"><a class="viewcode-back" href="../../api/pygwb.pe.PowerLawModel.html#pygwb.pe.PowerLawModel">[docs]</a><span class="k">class</span> <span class="nc">PowerLawModel</span><span class="p">(</span><span class="n">GWBModel</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Power law model is defined as:</span>

<span class="sd">    .. math::</span>
<span class="sd">        \Omega(f) = \Omega_{\text{ref}} \left(\frac{f}{f_{\text{ref}}}\right)^{\alpha}</span>
<span class="sd">        </span>
<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    </span>
<span class="sd">    To illustrate how to construct a likelihood with this model, we start by importing the relevant packages:</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; from pygwb.pe import PowerLawModel</span>
<span class="sd">    &gt;&gt;&gt; from pygwb.baseline import Baseline</span>
<span class="sd">    &gt;&gt;&gt; import bilby.gw.detector as bilbydet</span>
<span class="sd">    &gt;&gt;&gt; import numpy as np</span>
<span class="sd">    </span>
<span class="sd">    The model requires a list of baselines on which to run the parameter estimation. For the sake of the example,</span>
<span class="sd">    we consider the LIGO Hanford-Livingston baseline, and create a baseline object:</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; H1 = bilbydet.get_empty_interferometer(&#39;H1&#39;)</span>
<span class="sd">    &gt;&gt;&gt; L1 = bilbydet.get_empty_interferometer(&#39;L1&#39;)</span>
<span class="sd">    &gt;&gt;&gt; HL = Baseline(&#39;H1L1&#39;, H1, L1)</span>
<span class="sd">    </span>
<span class="sd">    The frequencies, point estimate spectrum and sigma spectrum of the baseline need to be set as well. For this</span>
<span class="sd">    example and for simplicity, we populate them with random numbers</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; HL.frequencies = np.linspace(0,100,1000)</span>
<span class="sd">    &gt;&gt;&gt; HL.point_estimate_spectrum = np.random.rand(1000)</span>
<span class="sd">    &gt;&gt;&gt; HL.sigma_spectrum = np.random.rand(1000)</span>
<span class="sd">    </span>
<span class="sd">    The baseline is then added to the other kwargs needed for the model to be instantiated:</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; kwargs_pl = {&quot;baselines&quot;:[HL], &quot;model_name&quot;:&#39;PL&#39;, &quot;fref&quot;:25}</span>
<span class="sd">    &gt;&gt;&gt; model_pl = PowerLawModel(**kwargs_pl)</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="PowerLawModel.__init__"><a class="viewcode-back" href="../../api/pygwb.pe.PowerLawModel.html#pygwb.pe.PowerLawModel.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parameters</span>
<span class="sd">        =======</span>
<span class="sd">        </span>
<span class="sd">        fref : ``float``</span>
<span class="sd">            Reference frequency for defining the model (:math:`f_{\\text{ref}}`)</span>

<span class="sd">        omega_ref : ``float``</span>
<span class="sd">            Amplitude of signal at :math:`f_{\\text{ref}}` (:math:`\Omega_{\\text{ref}}`)</span>

<span class="sd">        alpha : ``float``</span>
<span class="sd">            Spectral index of the power law (:math:`\\alpha`)</span>

<span class="sd">        frequencies : ``array_like``</span>
<span class="sd">            Array of frequencies at which to evaluate the model.</span>
<span class="sd">        </span>
<span class="sd">        See also</span>
<span class="sd">        --------</span>
<span class="sd">        pygwb.pe.GWBModel : The parent class used for the implementation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">fref</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;fref&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s2">&quot;fref must be supplied&quot;</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">PowerLawModel</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fref</span> <span class="o">=</span> <span class="n">fref</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parameters</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># include this so that the parent class GWBModel doesn&#39;t complain</span>
            <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;omega_ref&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;alpha&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">}</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_parameters</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parameters</span>

    <span class="nd">@parameters</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parameters</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">parameters</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_parameters</span> <span class="o">=</span> <span class="n">parameters</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">parameters</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_parameters</span> <span class="o">=</span> <span class="n">parameters</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;unexpected type for parameters </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="PowerLawModel.model_function"><a class="viewcode-back" href="../../api/pygwb.pe.PowerLawModel.html#pygwb.pe.PowerLawModel.model_function">[docs]</a>    <span class="k">def</span> <span class="nf">model_function</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bline</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;omega_ref&quot;</span><span class="p">]</span>
            <span class="o">*</span> <span class="p">(</span><span class="n">bline</span><span class="o">.</span><span class="n">frequencies</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">fref</span><span class="p">)</span> <span class="o">**</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;alpha&quot;</span><span class="p">]</span>
        <span class="p">)</span></div></div>

<div class="viewcode-block" id="BrokenPowerLawModel"><a class="viewcode-back" href="../../api/pygwb.pe.BrokenPowerLawModel.html#pygwb.pe.BrokenPowerLawModel">[docs]</a><span class="k">class</span> <span class="nc">BrokenPowerLawModel</span><span class="p">(</span><span class="n">GWBModel</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Broken Power law model is defined as: </span>
<span class="sd">    </span>
<span class="sd">    .. math:: </span>
<span class="sd">        \Omega(f) = \begin{cases}</span>
<span class="sd">            \Omega_{\text{ref}} \left( \frac{f}{f_{\text{ref}}} \right) ^ {\alpha_1}, f \leqslant f_{\text{ref}} \\</span>
<span class="sd">            \Omega_{\text{ref}} \left( \frac{f}{f_{\text{ref}}} \right) ^ {\alpha_2}, f &gt; f_{\text{ref}}</span>
<span class="sd">        \end{cases}</span>
<span class="sd">        </span>
<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    </span>
<span class="sd">    To illustrate how to construct a likelihood with this model, we start by importing the relevant packages:</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; from pygwb.pe import BrokenPowerLawModel</span>
<span class="sd">    &gt;&gt;&gt; from pygwb.baseline import Baseline</span>
<span class="sd">    &gt;&gt;&gt; import bilby.gw.detector as bilbydet</span>
<span class="sd">    &gt;&gt;&gt; import numpy as np</span>
<span class="sd">    </span>
<span class="sd">    The model requires a list of baselines on which to run the parameter estimation. For the sake of the example,</span>
<span class="sd">    we consider the LIGO Hanford-Livingston baseline, and create a baseline object:</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; H1 = bilbydet.get_empty_interferometer(&#39;H1&#39;)</span>
<span class="sd">    &gt;&gt;&gt; L1 = bilbydet.get_empty_interferometer(&#39;L1&#39;)</span>
<span class="sd">    &gt;&gt;&gt; HL = Baseline(&#39;H1L1&#39;, H1, L1)</span>
<span class="sd">    </span>
<span class="sd">    The frequencies, point estimate spectrum and sigma spectrum of the baseline need to be set as well. For this</span>
<span class="sd">    example and for simplicity, we populate them with random numbers</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; HL.frequencies = np.linspace(0,100,1000)</span>
<span class="sd">    &gt;&gt;&gt; HL.point_estimate_spectrum = np.random.rand(1000)</span>
<span class="sd">    &gt;&gt;&gt; HL.sigma_spectrum = np.random.rand(1000)</span>
<span class="sd">    </span>
<span class="sd">    The baseline is then added to the other kwargs needed for the model to be instantiated:</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; kwargs_bpl = {&quot;baselines&quot;:[HL], &quot;model_name&quot;:&#39;BPL&#39;}</span>
<span class="sd">    &gt;&gt;&gt; model_bpl = BrokenPowerLawModel(**kwargs_bpl)</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="BrokenPowerLawModel.__init__"><a class="viewcode-back" href="../../api/pygwb.pe.BrokenPowerLawModel.html#pygwb.pe.BrokenPowerLawModel.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parameters</span>
<span class="sd">        =======</span>
<span class="sd">        </span>
<span class="sd">        omega_ref : ``float``</span>
<span class="sd">            Amplitude of signal at :math:`f_{\\text{ref}}` (:math:`\Omega_{\\text{ref}}`)</span>

<span class="sd">        alpha_1 : ``float``</span>
<span class="sd">            Spectral index of the broken power law (:math:`\\alpha_1`)</span>

<span class="sd">        alpha_2 : ``float``</span>
<span class="sd">            Spectral index of the broken power law (:math:`\\alpha_2`)</span>

<span class="sd">        fbreak : ``float``</span>
<span class="sd">            Break frequency for the broken power law (:math:`f_{\\text{ref}}`)</span>

<span class="sd">        frequencies : ``array_like``</span>
<span class="sd">            Array of frequencies at which to evaluate the model.</span>

<span class="sd">        See also</span>
<span class="sd">        --------</span>
<span class="sd">        pygwb.pe.GWBModel : The parent class used for the implementation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">BrokenPowerLawModel</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parameters</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># include this so that the parent class GWBModel doesn&#39;t complain</span>
            <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;omega_ref&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;fbreak&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;alpha_1&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;alpha_2&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">}</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_parameters</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parameters</span>

    <span class="nd">@parameters</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parameters</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">parameters</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_parameters</span> <span class="o">=</span> <span class="n">parameters</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">parameters</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_parameters</span> <span class="o">=</span> <span class="n">parameters</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;unexpected type for parameters </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="BrokenPowerLawModel.model_function"><a class="viewcode-back" href="../../api/pygwb.pe.BrokenPowerLawModel.html#pygwb.pe.BrokenPowerLawModel.model_function">[docs]</a>    <span class="k">def</span> <span class="nf">model_function</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bline</span><span class="p">):</span>
        <span class="n">frequencies</span> <span class="o">=</span> <span class="n">bline</span><span class="o">.</span><span class="n">frequencies</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;omega_ref&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">piecewise</span><span class="p">(</span>
                <span class="n">frequencies</span><span class="p">,</span>
                <span class="p">[</span>
                    <span class="n">frequencies</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;fbreak&quot;</span><span class="p">],</span>
                    <span class="n">frequencies</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;fbreak&quot;</span><span class="p">],</span>
                <span class="p">],</span>
                <span class="p">[</span>
                    <span class="k">lambda</span> <span class="n">frequencies</span><span class="p">:</span> <span class="p">(</span><span class="n">frequencies</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;fbreak&quot;</span><span class="p">])</span>
                    <span class="o">**</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;alpha_1&quot;</span><span class="p">]),</span>
                    <span class="k">lambda</span> <span class="n">frequencies</span><span class="p">:</span> <span class="p">(</span><span class="n">frequencies</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;fbreak&quot;</span><span class="p">])</span>
                    <span class="o">**</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;alpha_2&quot;</span><span class="p">]),</span>
                <span class="p">],</span>
            <span class="p">)</span>
        <span class="p">)</span></div></div>

<div class="viewcode-block" id="TripleBrokenPowerLawModel"><a class="viewcode-back" href="../../api/pygwb.pe.TripleBrokenPowerLawModel.html#pygwb.pe.TripleBrokenPowerLawModel">[docs]</a><span class="k">class</span> <span class="nc">TripleBrokenPowerLawModel</span><span class="p">(</span><span class="n">GWBModel</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The triple broken power law is defined as: </span>
<span class="sd">    </span>
<span class="sd">    .. math:: </span>
<span class="sd">        \Omega(f) = \begin{cases}</span>
<span class="sd">            \Omega_{\text{ref}} \left( \frac{f}{f_1} \right) ^ {\alpha_1}, f \leqslant f_1 \\</span>
<span class="sd">            \Omega_{\text{ref}} \left( \frac{f}{f_1} \right) ^ {\alpha_2}, f_1 &lt; f \leqslant f_2  \\</span>
<span class="sd">            \Omega_{\text{ref}} \left( \frac{f_2}{f_1} \right) ^{\alpha_2} \left( \frac{f}{f_2} \right)^{\alpha_3}, f &gt; f_2</span>
<span class="sd">        \end{cases}</span>
<span class="sd">        </span>
<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    </span>
<span class="sd">    To illustrate how to construct a likelihood with this model, we start by importing the relevant packages:</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; from pygwb.pe import TripleBrokenPowerLawModel</span>
<span class="sd">    &gt;&gt;&gt; from pygwb.baseline import Baseline</span>
<span class="sd">    &gt;&gt;&gt; import bilby.gw.detector as bilbydet</span>
<span class="sd">    &gt;&gt;&gt; import numpy as np</span>
<span class="sd">    </span>
<span class="sd">    The model requires a list of baselines on which to run the parameter estimation. For the sake of the example,</span>
<span class="sd">    we consider the LIGO Hanford-Livingston baseline, and create a baseline object:</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; H1 = bilbydet.get_empty_interferometer(&#39;H1&#39;)</span>
<span class="sd">    &gt;&gt;&gt; L1 = bilbydet.get_empty_interferometer(&#39;L1&#39;)</span>
<span class="sd">    &gt;&gt;&gt; HL = Baseline(&#39;H1L1&#39;, H1, L1)</span>
<span class="sd">    </span>
<span class="sd">    The frequencies, point estimate spectrum and sigma spectrum of the baseline need to be set as well. For this</span>
<span class="sd">    example and for simplicity, we populate them with random numbers</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; HL.frequencies = np.linspace(0,100,1000)</span>
<span class="sd">    &gt;&gt;&gt; HL.point_estimate_spectrum = np.random.rand(1000)</span>
<span class="sd">    &gt;&gt;&gt; HL.sigma_spectrum = np.random.rand(1000)</span>
<span class="sd">    </span>
<span class="sd">    The baseline is then added to the other kwargs needed for the model to be instantiated:</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; kwargs_tbpl = {&quot;baselines&quot;:[HL], &quot;model_name&quot;:&#39;TBPL&#39;}</span>
<span class="sd">    &gt;&gt;&gt; model_tbpl = TripleBrokenPowerLawModel(**kwargs_tbpl)</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="TripleBrokenPowerLawModel.__init__"><a class="viewcode-back" href="../../api/pygwb.pe.TripleBrokenPowerLawModel.html#pygwb.pe.TripleBrokenPowerLawModel.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parameters</span>
<span class="sd">        =======</span>
<span class="sd">        </span>
<span class="sd">        omega_ref : ``float``</span>
<span class="sd">            Amplitude of signal at :math:`f_{\\text{ref}}` (:math:`\Omega_{\\text{ref}}`) </span>

<span class="sd">        alpha_1 : ``float``</span>
<span class="sd">            Spectral index of the broken power law (:math:`\\alpha_1`)</span>

<span class="sd">        alpha_2 : ``float``</span>
<span class="sd">            Spectral index of the broken power law (:math:`\\alpha_2`)</span>

<span class="sd">        alpha_3 : ``float``</span>
<span class="sd">            Spectral index of the broken power law (:math:`\\alpha_3`)</span>

<span class="sd">        fbreak1 : ``float``</span>
<span class="sd">            First break frequency for the triple broken power law (:math:`f_1`)</span>

<span class="sd">        fbreak2 : ``float``</span>
<span class="sd">            Second break frequency for the triple broken power law (:math:`f_2`)</span>

<span class="sd">        frequencies : ``array_like``</span>
<span class="sd">            Array of frequencies at which to evaluate the model.</span>

<span class="sd">        See also</span>
<span class="sd">        --------</span>
<span class="sd">        pygwb.pe.GWBModel : The parent class used for the implementation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">TripleBrokenPowerLawModel</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parameters</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># include this so that the parent class GWBModel doesn&#39;t complain</span>
            <span class="k">return</span> <span class="p">{</span>
                <span class="s2">&quot;omega_ref&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                <span class="s2">&quot;alpha_1&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                <span class="s2">&quot;alpha_2&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                <span class="s2">&quot;alpha_3&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                <span class="s2">&quot;fbreak1&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                <span class="s2">&quot;fbreak2&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_parameters</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parameters</span>

    <span class="nd">@parameters</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parameters</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">parameters</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_parameters</span> <span class="o">=</span> <span class="n">parameters</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">parameters</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_parameters</span> <span class="o">=</span> <span class="n">parameters</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;unexpected type for parameters </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="TripleBrokenPowerLawModel.model_function"><a class="viewcode-back" href="../../api/pygwb.pe.TripleBrokenPowerLawModel.html#pygwb.pe.TripleBrokenPowerLawModel.model_function">[docs]</a>    <span class="k">def</span> <span class="nf">model_function</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bline</span><span class="p">):</span>
        <span class="n">frequencies</span> <span class="o">=</span> <span class="n">bline</span><span class="o">.</span><span class="n">frequencies</span>
        <span class="n">piecewise</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">piecewise</span><span class="p">(</span>
            <span class="n">frequencies</span><span class="p">,</span>
            <span class="p">[</span>
                <span class="n">frequencies</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;fbreak1&quot;</span><span class="p">],</span>
                <span class="p">(</span><span class="n">frequencies</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;fbreak2&quot;</span><span class="p">])</span>
                <span class="o">&amp;</span> <span class="p">(</span><span class="n">frequencies</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;fbreak1&quot;</span><span class="p">]),</span>
            <span class="p">],</span>
            <span class="p">[</span>
                <span class="k">lambda</span> <span class="n">frequencies</span><span class="p">:</span> <span class="p">(</span><span class="n">frequencies</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;fbreak1&quot;</span><span class="p">])</span>
                <span class="o">**</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;alpha_1&quot;</span><span class="p">]),</span>
                <span class="k">lambda</span> <span class="n">frequencies</span><span class="p">:</span> <span class="p">(</span><span class="n">frequencies</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;fbreak1&quot;</span><span class="p">])</span>
                <span class="o">**</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;alpha_2&quot;</span><span class="p">]),</span>
                <span class="k">lambda</span> <span class="n">frequencies</span><span class="p">:</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;fbreak2&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;fbreak1&quot;</span><span class="p">]</span>
                <span class="p">)</span>
                <span class="o">**</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;alpha_2&quot;</span><span class="p">])</span>
                <span class="o">*</span> <span class="p">(</span><span class="n">frequencies</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;fbreak2&quot;</span><span class="p">])</span>
                <span class="o">**</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;alpha_3&quot;</span><span class="p">]),</span>
            <span class="p">],</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;omega_ref&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">piecewise</span></div></div>

<div class="viewcode-block" id="SmoothBrokenPowerLawModel"><a class="viewcode-back" href="../../api/pygwb.pe.SmoothBrokenPowerLawModel.html#pygwb.pe.SmoothBrokenPowerLawModel">[docs]</a><span class="k">class</span> <span class="nc">SmoothBrokenPowerLawModel</span><span class="p">(</span><span class="n">GWBModel</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    The smooth broken power law is defined as:</span>

<span class="sd">    .. math::</span>
<span class="sd">        \Omega(f) = \Omega_{\text{ref}}\left(\frac{f}{f_{\text{ref}}}\right) ^{\alpha_1} \left[1+\left(\frac{f}{f_{\text{ref}}}\right)^{\Delta}\right]^{\frac{\alpha_2-\alpha_1}{\Delta}}</span>
<span class="sd">        </span>
<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    </span>
<span class="sd">    To illustrate how to construct a likelihood with this model, we start by importing the relevant packages:</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; from pygwb.pe import SmoothBrokenPowerLawModel</span>
<span class="sd">    &gt;&gt;&gt; from pygwb.baseline import Baseline</span>
<span class="sd">    &gt;&gt;&gt; import bilby.gw.detector as bilbydet</span>
<span class="sd">    &gt;&gt;&gt; import numpy as np</span>
<span class="sd">    </span>
<span class="sd">    The model requires a list of baselines on which to run the parameter estimation. For the sake of the example,</span>
<span class="sd">    we consider the LIGO Hanford-Livingston baseline, and create a baseline object:</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; H1 = bilbydet.get_empty_interferometer(&#39;H1&#39;)</span>
<span class="sd">    &gt;&gt;&gt; L1 = bilbydet.get_empty_interferometer(&#39;L1&#39;)</span>
<span class="sd">    &gt;&gt;&gt; HL = Baseline(&#39;H1L1&#39;, H1, L1)</span>
<span class="sd">    </span>
<span class="sd">    The frequencies, point estimate spectrum and sigma spectrum of the baseline need to be set as well. For this</span>
<span class="sd">    example and for simplicity, we populate them with random numbers</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; HL.frequencies = np.linspace(0,100,1000)</span>
<span class="sd">    &gt;&gt;&gt; HL.point_estimate_spectrum = np.random.rand(1000)</span>
<span class="sd">    &gt;&gt;&gt; HL.sigma_spectrum = np.random.rand(1000)</span>
<span class="sd">    </span>
<span class="sd">    The baseline is then added to the other kwargs needed for the model to be instantiated:</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; kwargs_sbpl = {&quot;baselines&quot;:[HL], &quot;model_name&quot;:&#39;SBPL&#39;}</span>
<span class="sd">    &gt;&gt;&gt; model_sbpl = SmoothBrokenPowerLawModel(**kwargs_sbpl)</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="SmoothBrokenPowerLawModel.__init__"><a class="viewcode-back" href="../../api/pygwb.pe.SmoothBrokenPowerLawModel.html#pygwb.pe.SmoothBrokenPowerLawModel.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parameters</span>
<span class="sd">        =======</span>
<span class="sd">        </span>
<span class="sd">        omega_ref : ``float``</span>
<span class="sd">            Amplitude of signal (:math:`\\Omega_{\\rm ref}`)</span>

<span class="sd">        Delta : ``float``</span>
<span class="sd">            Smoothing variable for the smooth broken power law (:math:`\Delta`)</span>

<span class="sd">        alpha_1 : ``float``</span>
<span class="sd">            Low-frequency spectral index of the smooth broken power law (:math:`\\alpha_1`)</span>

<span class="sd">        alpha_2 : ``float``</span>
<span class="sd">            High-frequency spectral index of the smooth broken power law (:math:`\\alpha_2`)</span>

<span class="sd">        fbreak : ``float``</span>
<span class="sd">            Break frequency for the smooth broken power law (:math:`f_{\\text{ref}}`)</span>

<span class="sd">        frequencies : ``array_like``</span>
<span class="sd">            Array of frequencies at which to evaluate the model.</span>

<span class="sd">        See also</span>
<span class="sd">        --------</span>
<span class="sd">        pygwb.pe.GWBModel : The parent class used for the implementation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">SmoothBrokenPowerLawModel</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parameters</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># include this so that the parent class GWBModel doesn&#39;t complain</span>
            <span class="k">return</span> <span class="p">{</span>
                <span class="s2">&quot;omega_ref&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                <span class="s2">&quot;fbreak&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                <span class="s2">&quot;alpha_1&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                <span class="s2">&quot;alpha_2&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                <span class="s2">&quot;delta&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_parameters</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parameters</span>

    <span class="nd">@parameters</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parameters</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">parameters</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_parameters</span> <span class="o">=</span> <span class="n">parameters</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">parameters</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_parameters</span> <span class="o">=</span> <span class="n">parameters</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;unexpected type for parameters </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="SmoothBrokenPowerLawModel.model_function"><a class="viewcode-back" href="../../api/pygwb.pe.SmoothBrokenPowerLawModel.html#pygwb.pe.SmoothBrokenPowerLawModel.model_function">[docs]</a>    <span class="k">def</span> <span class="nf">model_function</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bline</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;omega_ref&quot;</span><span class="p">]</span>
            <span class="o">*</span> <span class="p">(</span><span class="n">bline</span><span class="o">.</span><span class="n">frequencies</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;fbreak&quot;</span><span class="p">])</span>
            <span class="o">**</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;alpha_1&quot;</span><span class="p">]</span>
            <span class="o">*</span> <span class="p">(</span>
                <span class="mi">1</span>
                <span class="o">+</span> <span class="p">(</span><span class="n">bline</span><span class="o">.</span><span class="n">frequencies</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;fbreak&quot;</span><span class="p">])</span>
                <span class="o">**</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;delta&quot;</span><span class="p">])</span>
            <span class="p">)</span>
            <span class="o">**</span> <span class="p">(</span>
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;alpha_2&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;alpha_1&quot;</span><span class="p">])</span>
                <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;delta&quot;</span><span class="p">]</span>
            <span class="p">)</span>
        <span class="p">)</span></div></div>

<div class="viewcode-block" id="SchumannModel"><a class="viewcode-back" href="../../api/pygwb.pe.SchumannModel.html#pygwb.pe.SchumannModel">[docs]</a><span class="k">class</span> <span class="nc">SchumannModel</span><span class="p">(</span><span class="n">GWBModel</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    The Schumann model is defined as:</span>


<span class="sd">    .. math::</span>
<span class="sd">         \Omega(f) = \sum_{ij} \kappa_i \kappa_j \left(\frac{f}{f_{\text{ref}}}\right)^{-\beta_i-\beta_j} M_{ij}(f) \times 10^{-46}</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="SchumannModel.__init__"><a class="viewcode-back" href="../../api/pygwb.pe.SchumannModel.html#pygwb.pe.SchumannModel.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parameters</span>
<span class="sd">        =======</span>
<span class="sd">        </span>
<span class="sd">        fref : ``float``</span>
<span class="sd">            Reference frequency for defining the model (:math:`f_{\\text{ref}}`)</span>

<span class="sd">        kappa_i : ``float``</span>
<span class="sd">            Amplitude of coupling function of interferometer i at 10 Hz (:math:`\kappa_i`)</span>

<span class="sd">        beta_i : ``float``</span>
<span class="sd">            Spectral index of coupling function of interferometer i (:math:`\\beta_i`)</span>

<span class="sd">        frequencies : ``array_like``</span>
<span class="sd">            Array of frequencies at which to evaluate the model</span>

<span class="sd">        See also</span>
<span class="sd">        --------</span>
<span class="sd">        pygwb.pe.GWBModel : The parent class used for the implementation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Set valid ifos</span>
        <span class="c1"># get ifo&#39;s associated with this set of</span>
        <span class="c1"># baselines.</span>
        <span class="n">valid_ifos</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;H&quot;</span><span class="p">,</span> <span class="s2">&quot;L&quot;</span><span class="p">,</span> <span class="s2">&quot;V&quot;</span><span class="p">,</span> <span class="s2">&quot;K&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ifos</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">bline</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;baselines&quot;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">bline</span><span class="o">.</span><span class="n">name</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">valid_ifos</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;baseline names must be two ifo letters from list of H, L, V, K&quot;</span>
                <span class="p">)</span>
            <span class="k">if</span> <span class="n">bline</span><span class="o">.</span><span class="n">name</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">valid_ifos</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;baseline names must be two ifo letters from list of H, L, V, K&quot;</span>
                <span class="p">)</span>
        <span class="c1"># get list of ifos</span>
        <span class="k">for</span> <span class="n">bline</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;baselines&quot;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ifos</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bline</span><span class="o">.</span><span class="n">name</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ifos</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bline</span><span class="o">.</span><span class="n">name</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">SchumannModel</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="c1"># set error handling to make sure baselines</span>
        <span class="c1"># are named properly</span>
        <span class="c1"># make it unique</span>
        <span class="c1"># be careful, this doesn&#39;t preserve</span>
        <span class="c1"># the order!</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ifos</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ifos</span><span class="p">))</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parameters</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">schu_params</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">ifo</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ifos</span><span class="p">:</span>
                <span class="n">schu_params</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;kappa_</span><span class="si">{</span><span class="n">ifo</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">schu_params</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;beta_</span><span class="si">{</span><span class="n">ifo</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">return</span> <span class="n">schu_params</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_parameters</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parameters</span>

    <span class="nd">@parameters</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parameters</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">parameters</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_parameters</span> <span class="o">=</span> <span class="n">parameters</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">parameters</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_parameters</span> <span class="o">=</span> <span class="n">parameters</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;unexpected type for parameters </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="SchumannModel.model_function"><a class="viewcode-back" href="../../api/pygwb.pe.SchumannModel.html#pygwb.pe.SchumannModel.model_function">[docs]</a>    <span class="k">def</span> <span class="nf">model_function</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bline</span><span class="p">):</span>
        <span class="c1"># assumes simple power law model for transfer function</span>
        <span class="n">ifo1</span> <span class="o">=</span> <span class="n">bline</span><span class="o">.</span><span class="n">name</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">ifo2</span> <span class="o">=</span> <span class="n">bline</span><span class="o">.</span><span class="n">name</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">TF1</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;kappa_</span><span class="si">{</span><span class="n">ifo1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>
            <span class="o">*</span> <span class="p">(</span><span class="n">bline</span><span class="o">.</span><span class="n">frequencies</span> <span class="o">/</span> <span class="mi">10</span><span class="p">)</span> <span class="o">**</span> <span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;beta_</span><span class="si">{</span><span class="n">ifo1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">])</span>
            <span class="o">*</span> <span class="mf">1e-23</span>
        <span class="p">)</span>
        <span class="n">TF2</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;kappa_</span><span class="si">{</span><span class="n">ifo2</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>
            <span class="o">*</span> <span class="p">(</span><span class="n">bline</span><span class="o">.</span><span class="n">frequencies</span> <span class="o">/</span> <span class="mi">10</span><span class="p">)</span> <span class="o">**</span> <span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;beta_</span><span class="si">{</span><span class="n">ifo2</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">])</span>
            <span class="o">*</span> <span class="mf">1e-23</span>
        <span class="p">)</span>
        <span class="c1"># units of transfer function strain/pT</span>
        <span class="k">return</span> <span class="n">TF1</span> <span class="o">*</span> <span class="n">TF2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">bline</span><span class="o">.</span><span class="n">M_f</span><span class="p">)</span></div></div>

<div class="viewcode-block" id="TVSPowerLawModel"><a class="viewcode-back" href="../../api/pygwb.pe.TVSPowerLawModel.html#pygwb.pe.TVSPowerLawModel">[docs]</a><span class="k">class</span> <span class="nc">TVSPowerLawModel</span><span class="p">(</span><span class="n">GWBModel</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The Tensor-Vector-Scalar polarization (T,V,S) power-law model is defined as:</span>

<span class="sd">    .. math::</span>

<span class="sd">        \Omega(f) = \Omega _T + \Omega _V + \Omega _S</span>

<span class="sd">        \Omega _T = \Omega _{{\text{ref}},T} \left( \frac{f}{f_{\text{ref}}}\right)^{\alpha _T}</span>

<span class="sd">        \Omega _V = (\gamma _V/\gamma_T)~\Omega _{{\text{ref}},V} \left( \frac{f}{f_{\text{ref}}}\right)^{\alpha _V}</span>

<span class="sd">        \Omega _S = (\gamma_S/\gamma_T)~\Omega _{{\text{ref}},S} \left( \frac{f}{f_{\text{ref}}}\right)^{\alpha _S}</span>
<span class="sd">        </span>
<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    </span>
<span class="sd">    To illustrate how to construct a likelihood with this model, we start by importing the relevant packages:</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; from pygwb.pe import TVSPowerLawModel</span>
<span class="sd">    &gt;&gt;&gt; from pygwb.baseline import Baseline</span>
<span class="sd">    &gt;&gt;&gt; import bilby.gw.detector as bilbydet</span>
<span class="sd">    &gt;&gt;&gt; import numpy as np</span>
<span class="sd">    </span>
<span class="sd">    The model requires a list of baselines on which to run the parameter estimation. For the sake of the example,</span>
<span class="sd">    we consider the LIGO Hanford-Livingston baseline, and create a baseline object:</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; H1 = bilbydet.get_empty_interferometer(&#39;H1&#39;)</span>
<span class="sd">    &gt;&gt;&gt; L1 = bilbydet.get_empty_interferometer(&#39;L1&#39;)</span>
<span class="sd">    &gt;&gt;&gt; HL = Baseline(&#39;H1L1&#39;, H1, L1)</span>
<span class="sd">    </span>
<span class="sd">    The frequencies, point estimate spectrum and sigma spectrum of the baseline need to be set as well. For this</span>
<span class="sd">    example and for simplicity, we populate them with random numbers</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; HL.frequencies = np.linspace(0,100,1000)</span>
<span class="sd">    &gt;&gt;&gt; HL.point_estimate_spectrum = np.random.rand(1000)</span>
<span class="sd">    &gt;&gt;&gt; HL.sigma_spectrum = np.random.rand(1000)</span>
<span class="sd">    </span>
<span class="sd">    The baseline is then added to the other kwargs needed for the model to be instantiated:</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; kwargs_pl_sv = {&quot;baselines&quot;:[HL], &quot;model_name&quot;:&#39;PL_SV&#39;, &quot;polarizations&quot;:[&#39;scalar&#39;, &#39;vector&#39;]}</span>
<span class="sd">    &gt;&gt;&gt; model_pl_sv = TVSPowerLawModel(**kwargs_pl_sv)</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="TVSPowerLawModel.__init__"><a class="viewcode-back" href="../../api/pygwb.pe.TVSPowerLawModel.html#pygwb.pe.TVSPowerLawModel.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parameters</span>
<span class="sd">        =======</span>
<span class="sd">        </span>
<span class="sd">        fref : ``float``</span>
<span class="sd">            Reference frequency for defining the model (:math:`f_{\\text{ref}}`)</span>
<span class="sd">            </span>
<span class="sd">        omega_ref_pol : ``float``</span>
<span class="sd">            Amplitude of signal at :math:`f_{\\text{ref}}` for polarization pol (:math:`\Omega_{\\text{ref},\\text{pol}}`)</span>

<span class="sd">        alpha_pol : ``float``</span>
<span class="sd">            Spectral index of the power law for polarization pol (:math:`\\alpha_{\\text{pol}}`)</span>

<span class="sd">        frequencies : ``array_like``</span>
<span class="sd">            Array of frequencies at which to evaluate the model.</span>

<span class="sd">        See also</span>
<span class="sd">        --------</span>
<span class="sd">        pygwb.pe.GWBModel : The parent class used for the implementation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">fref</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;fref&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s2">&quot;fref must be supplied&quot;</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">TVSPowerLawModel</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fref</span> <span class="o">=</span> <span class="n">fref</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parameters</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">params</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">pol</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">polarizations</span><span class="p">:</span>
                <span class="n">params</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;omega_ref_</span><span class="si">{</span><span class="n">pol</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">params</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;alpha_</span><span class="si">{</span><span class="n">pol</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">return</span> <span class="n">params</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_parameters</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parameters</span>

    <span class="nd">@parameters</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parameters</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">parameters</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_parameters</span> <span class="o">=</span> <span class="n">parameters</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">parameters</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_parameters</span> <span class="o">=</span> <span class="n">parameters</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;unexpected type for parameters </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="TVSPowerLawModel.model_function"><a class="viewcode-back" href="../../api/pygwb.pe.TVSPowerLawModel.html#pygwb.pe.TVSPowerLawModel.model_function">[docs]</a>    <span class="k">def</span> <span class="nf">model_function</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bline</span><span class="p">):</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">bline</span><span class="o">.</span><span class="n">frequencies</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">pol</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">polarizations</span><span class="p">:</span>
            <span class="n">orf_pol</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">bline</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">pol</span><span class="si">}</span><span class="s2">_overlap_reduction_function&quot;</span><span class="p">)</span>
            <span class="n">orf_parent</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">bline</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">polarizations</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">_overlap_reduction_function&quot;</span><span class="p">)</span>
            <span class="n">model</span> <span class="o">+=</span> <span class="p">(</span>
                <span class="n">orf_pol</span>
                <span class="o">/</span> <span class="n">orf_parent</span>
                <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;omega_ref_</span><span class="si">{</span><span class="n">pol</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>
                <span class="o">*</span> <span class="p">(</span><span class="n">bline</span><span class="o">.</span><span class="n">frequencies</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">fref</span><span class="p">)</span> <span class="o">**</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;alpha_</span><span class="si">{</span><span class="n">pol</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">])</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">model</span></div></div>

<span class="c1"># Parity violation models</span>

<div class="viewcode-block" id="PVPowerLawModel"><a class="viewcode-back" href="../../api/pygwb.pe.PVPowerLawModel.html#pygwb.pe.PVPowerLawModel">[docs]</a><span class="k">class</span> <span class="nc">PVPowerLawModel</span><span class="p">(</span><span class="n">GWBModel</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The parity violation model can be defined as:</span>

<span class="sd">    .. math::</span>
<span class="sd">        \Omega(f) = \left(1 + \Pi \frac{\gamma _V}{\gamma _I}\right) \Omega_{\text{ref}} \left( \frac{f}{f_{\text{ref}}} \right)^{\alpha}</span>
<span class="sd">        </span>
<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    </span>
<span class="sd">    To illustrate how to construct a likelihood with this model, we start by importing the relevant packages:</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; from pygwb.pe import PVPowerLawModel</span>
<span class="sd">    &gt;&gt;&gt; from pygwb.baseline import Baseline</span>
<span class="sd">    &gt;&gt;&gt; import bilby.gw.detector as bilbydet</span>
<span class="sd">    &gt;&gt;&gt; import numpy as np</span>
<span class="sd">    </span>
<span class="sd">    The model requires a list of baselines on which to run the parameter estimation. For the sake of the example,</span>
<span class="sd">    we consider the LIGO Hanford-Livingston baseline, and create a baseline object:</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; H1 = bilbydet.get_empty_interferometer(&#39;H1&#39;)</span>
<span class="sd">    &gt;&gt;&gt; L1 = bilbydet.get_empty_interferometer(&#39;L1&#39;)</span>
<span class="sd">    &gt;&gt;&gt; HL = Baseline(&#39;H1L1&#39;, H1, L1)</span>
<span class="sd">    </span>
<span class="sd">    The frequencies, point estimate spectrum and sigma spectrum of the baseline need to be set as well. For this</span>
<span class="sd">    example and for simplicity, we populate them with random numbers</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; HL.frequencies = np.linspace(0,100,1000)</span>
<span class="sd">    &gt;&gt;&gt; HL.point_estimate_spectrum = np.random.rand(1000)</span>
<span class="sd">    &gt;&gt;&gt; HL.sigma_spectrum = np.random.rand(1000)</span>
<span class="sd">    </span>
<span class="sd">    The baseline is then added to the other kwargs needed for the model to be instantiated:</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; kwargs_pl_pv = {&quot;baselines&quot;:[HL], &quot;model_name&quot;:&#39;PL_PV&#39;, &#39;fref&#39;: 25}</span>
<span class="sd">    &gt;&gt;&gt; model_pl_pv = PVPowerLawModel(**kwargs_pl_pv)</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="PVPowerLawModel.__init__"><a class="viewcode-back" href="../../api/pygwb.pe.PVPowerLawModel.html#pygwb.pe.PVPowerLawModel.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parameters</span>
<span class="sd">        =======</span>
<span class="sd">        </span>
<span class="sd">        fref : ``float``</span>
<span class="sd">            Reference frequency for defining the model (:math:`f_{\\text{ref}}`)</span>

<span class="sd">        omega_ref : ``float``</span>
<span class="sd">            Amplitude of signal at :math:`f_{\\text{ref}}` (:math:`\Omega_{\\text{ref}}`)</span>

<span class="sd">        alpha : ``float``</span>
<span class="sd">            Spectral index of the power law (:math:`\\alpha`)</span>

<span class="sd">        Pi : ``float``</span>
<span class="sd">            Degree of parity violation (:math:`\Pi`)</span>

<span class="sd">        frequencies : ``array_like``</span>
<span class="sd">            Array of frequencies at which to evaluate the model.</span>

<span class="sd">        See also</span>
<span class="sd">        --------</span>
<span class="sd">        pygwb.pe.GWBModel : The parent class used for the implementation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">fref</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;fref&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s2">&quot;fref must be supplied&quot;</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">PVPowerLawModel</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fref</span> <span class="o">=</span> <span class="n">fref</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parameters</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># include this so that the parent class GWBModel doesn&#39;t complain</span>
            <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;omega_ref&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;alpha&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;Pi&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">}</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_parameters</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parameters</span>

    <span class="nd">@parameters</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parameters</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">parameters</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_parameters</span> <span class="o">=</span> <span class="n">parameters</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">parameters</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_parameters</span> <span class="o">=</span> <span class="n">parameters</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;unexpected type for parameters </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="PVPowerLawModel.model_function"><a class="viewcode-back" href="../../api/pygwb.pe.PVPowerLawModel.html#pygwb.pe.PVPowerLawModel.model_function">[docs]</a>    <span class="k">def</span> <span class="nf">model_function</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bline</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="p">(</span>
                <span class="mi">1</span>
                <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;Pi&quot;</span><span class="p">]</span>
                <span class="o">*</span> <span class="n">bline</span><span class="o">.</span><span class="n">gamma_v</span>
                <span class="o">/</span> <span class="n">bline</span><span class="o">.</span><span class="n">overlap_reduction_function</span>
            <span class="p">)</span>
            <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;omega_ref&quot;</span><span class="p">]</span>
            <span class="o">*</span> <span class="p">(</span><span class="n">bline</span><span class="o">.</span><span class="n">frequencies</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">fref</span><span class="p">)</span> <span class="o">**</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;alpha&quot;</span><span class="p">])</span>
        <span class="p">)</span></div></div>

<div class="viewcode-block" id="PVPowerLawModel2"><a class="viewcode-back" href="../../api/pygwb.pe.PVPowerLawModel2.html#pygwb.pe.PVPowerLawModel2">[docs]</a><span class="k">class</span> <span class="nc">PVPowerLawModel2</span><span class="p">(</span><span class="n">GWBModel</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The parity violation model 2 can be defined as:</span>

<span class="sd">    .. math::</span>
<span class="sd">         \Omega(f) = \left(1 + f^{\beta} \frac{\gamma_V}{\gamma _I}\right) \Omega_{\text{ref}}\left(\frac{f}{f_{\text{ref}}} \right)^{\alpha}</span>
<span class="sd">         </span>
<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    </span>
<span class="sd">    To illustrate how to construct a likelihood with this model, we start by importing the relevant packages:</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; from pygwb.pe import PVPowerLawModel2</span>
<span class="sd">    &gt;&gt;&gt; from pygwb.baseline import Baseline</span>
<span class="sd">    &gt;&gt;&gt; import bilby.gw.detector as bilbydet</span>
<span class="sd">    &gt;&gt;&gt; import numpy as np</span>
<span class="sd">    </span>
<span class="sd">    The model requires a list of baselines on which to run the parameter estimation. For the sake of the example,</span>
<span class="sd">    we consider the LIGO Hanford-Livingston baseline, and create a baseline object:</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; H1 = bilbydet.get_empty_interferometer(&#39;H1&#39;)</span>
<span class="sd">    &gt;&gt;&gt; L1 = bilbydet.get_empty_interferometer(&#39;L1&#39;)</span>
<span class="sd">    &gt;&gt;&gt; HL = Baseline(&#39;H1L1&#39;, H1, L1)</span>
<span class="sd">    </span>
<span class="sd">    The frequencies, point estimate spectrum and sigma spectrum of the baseline need to be set as well. For this</span>
<span class="sd">    example and for simplicity, we populate them with random numbers</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; HL.frequencies = np.linspace(0,100,1000)</span>
<span class="sd">    &gt;&gt;&gt; HL.point_estimate_spectrum = np.random.rand(1000)</span>
<span class="sd">    &gt;&gt;&gt; HL.sigma_spectrum = np.random.rand(1000)</span>
<span class="sd">    </span>
<span class="sd">    The baseline is then added to the other kwargs needed for the model to be instantiated:</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; kwargs_pl_pv_2 = {&quot;baselines&quot;:[HL], &quot;model_name&quot;:&#39;PL_PV_2&#39;, &#39;fref&#39;: 25}</span>
<span class="sd">    &gt;&gt;&gt; model_pl_pv_2 = PVPowerLawModel2(**kwargs_pl_pv_2)</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="PVPowerLawModel2.__init__"><a class="viewcode-back" href="../../api/pygwb.pe.PVPowerLawModel2.html#pygwb.pe.PVPowerLawModel2.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parameters</span>
<span class="sd">        =======</span>
<span class="sd">        </span>
<span class="sd">        fref : ``float``</span>
<span class="sd">            Reference frequency for defining the model (:math:`f_{\\text{ref}}`)</span>

<span class="sd">        omega_ref : ``float``</span>
<span class="sd">            Amplitude of signal at :math:`f_{\\text{ref}}` (:math:`\Omega_{\\text{ref}}`)</span>

<span class="sd">        alpha : ``float``</span>
<span class="sd">            Spectral index of the power law (:math:`\\alpha`)</span>

<span class="sd">        beta : ``float``</span>
<span class="sd">            Spectral index of the degree of parity violation (:math:`\\beta`)</span>

<span class="sd">        frequencies : ``array_like``</span>
<span class="sd">            Array of frequencies at which to evaluate the model.</span>

<span class="sd">        See also</span>
<span class="sd">        --------</span>
<span class="sd">        pygwb.pe.GWBModel : The parent class used for the implementation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">fref</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;fref&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s2">&quot;fref must be supplied&quot;</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">PVPowerLawModel2</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fref</span> <span class="o">=</span> <span class="n">fref</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parameters</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># include this so that the parent class GWBModel doesn&#39;t complain</span>
            <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;omega_ref&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;alpha&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;beta&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">}</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_parameters</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parameters</span>

    <span class="nd">@parameters</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parameters</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">parameters</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_parameters</span> <span class="o">=</span> <span class="n">parameters</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">parameters</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_parameters</span> <span class="o">=</span> <span class="n">parameters</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;unexpected type for parameters </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="PVPowerLawModel2.model_function"><a class="viewcode-back" href="../../api/pygwb.pe.PVPowerLawModel2.html#pygwb.pe.PVPowerLawModel2.model_function">[docs]</a>    <span class="k">def</span> <span class="nf">model_function</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bline</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="p">(</span>
                <span class="mi">1</span>
                <span class="o">+</span> <span class="p">((</span><span class="n">bline</span><span class="o">.</span><span class="n">frequencies</span><span class="p">)</span> <span class="o">**</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;beta&quot;</span><span class="p">]))</span>
                <span class="o">*</span> <span class="n">bline</span><span class="o">.</span><span class="n">gamma_v</span>
                <span class="o">/</span> <span class="p">(</span><span class="n">bline</span><span class="o">.</span><span class="n">overlap_reduction_function</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;omega_ref&quot;</span><span class="p">]</span>
            <span class="o">*</span> <span class="p">(</span><span class="n">bline</span><span class="o">.</span><span class="n">frequencies</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">fref</span><span class="p">)</span> <span class="o">**</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;alpha&quot;</span><span class="p">])</span>
        <span class="p">)</span></div></div>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Arianna Renzini, Sylvia Biscoveanu, Shivaraj Khandasamy, Kamiel Janssens, Max Lalleman, Katarina Martinovic, Andrew Matas, Patrick Meyers, Alba Romero, Colm Talbot, Leo Tsukada, Kevin Turbang.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>