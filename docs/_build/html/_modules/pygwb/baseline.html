<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>pygwb.baseline &mdash; pygwb 0.0 documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/tabs.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/tabs.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html" class="icon icon-home"> pygwb
          </a>
              <div class="version">
                0.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contributing.html">Contributing guide</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../api/pygwb.detector.html">pygwb.detector</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/pygwb.baseline.html">pygwb.baseline</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/pygwb.network.html">pygwb.network</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/pygwb.spectral.html">pygwb.spectral</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/pygwb.postprocessing.html">pygwb.postprocessing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/pygwb.pe.html">pygwb.pe</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/pygwb.statistical_checks.html">pygwb.statistical_checks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/pygwb.simulator.html">pygwb.simulator</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/pygwb.delta_sigma_cut.html">pygwb.delta_sigma_cut</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/pygwb.notch.html">pygwb.notch</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/pygwb.constants.html">pygwb.constants</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/pygwb.orfs.html">pygwb.orfs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/pygwb.parameters.html">pygwb.parameters</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/pygwb.util.html">pygwb.util</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">pygwb</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../index.html">Module code</a> &raquo;</li>
      <li>pygwb.baseline</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for pygwb.baseline</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">pickle</span>
<span class="kn">import</span> <span class="nn">warnings</span>

<span class="kn">import</span> <span class="nn">gwpy.frequencyseries</span>
<span class="kn">import</span> <span class="nn">gwpy.spectrogram</span>
<span class="kn">import</span> <span class="nn">h5py</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">bilby.core.utils</span> <span class="kn">import</span> <span class="n">create_frequency_series</span>
<span class="kn">from</span> <span class="nn">loguru</span> <span class="kn">import</span> <span class="n">logger</span>

<span class="kn">from</span> <span class="nn">.delta_sigma_cut</span> <span class="kn">import</span> <span class="n">run_dsc</span>
<span class="kn">from</span> <span class="nn">.notch</span> <span class="kn">import</span> <span class="n">StochNotchList</span>
<span class="kn">from</span> <span class="nn">.orfs</span> <span class="kn">import</span> <span class="n">calc_orf</span>
<span class="kn">from</span> <span class="nn">.postprocessing</span> <span class="kn">import</span> <span class="n">postprocess_Y_sigma</span>
<span class="kn">from</span> <span class="nn">.spectral</span> <span class="kn">import</span> <span class="n">coarse_grain_spectrogram</span><span class="p">,</span> <span class="n">cross_spectral_density</span>
<span class="kn">from</span> <span class="nn">.util</span> <span class="kn">import</span> <span class="n">calc_Y_sigma_from_Yf_varf</span><span class="p">,</span> <span class="n">calculate_point_estimate_sigma_spectrogram</span>


<div class="viewcode-block" id="Baseline"><a class="viewcode-back" href="../../api/pygwb.baseline.Baseline.html#pygwb.baseline.Baseline">[docs]</a><span class="k">class</span> <span class="nc">Baseline</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<div class="viewcode-block" id="Baseline.__init__"><a class="viewcode-back" href="../../api/pygwb.baseline.Baseline.html#pygwb.baseline.Baseline.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">name</span><span class="p">,</span>
        <span class="n">interferometer_1</span><span class="p">,</span>
        <span class="n">interferometer_2</span><span class="p">,</span>
        <span class="n">duration</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">frequencies</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">calibration_epsilon</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">notch_list_path</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">overlap_factor</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
        <span class="n">zeropad_csd</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">window_fftgram</span><span class="o">=</span><span class="s2">&quot;hann&quot;</span><span class="p">,</span>
        <span class="n">overlap_factor_welch_psd</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">N_average_segments_welch_psd</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
        <span class="n">sampling_frequency</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        name: str</span>
<span class="sd">            Name for the baseline, e.g H1H2</span>
<span class="sd">        interferometer_1/2: bilby Interferometer object</span>
<span class="sd">            the two detectors spanning the baseline</span>
<span class="sd">        duration: float, optional</span>
<span class="sd">            the duration in seconds of each data segment in the interferometers.</span>
<span class="sd">            None by default, in which case duration is inherited from the interferometers.</span>
<span class="sd">        frequencies: array_like, optional</span>
<span class="sd">            the frequency array for the Baseline and</span>
<span class="sd">            interferometers</span>
<span class="sd">        calibration_epsilon: float, optional</span>
<span class="sd">            calibration uncertainty for this baseline</span>
<span class="sd">        notch_list_path: str, optional</span>
<span class="sd">            file path of the baseline notch list</span>
<span class="sd">        overlap_factor: float, optional</span>
<span class="sd">            factor by which to overlap the segments in the psd and csd estimation.</span>
<span class="sd">            Default is 1/2, if set to 0 no overlap is performed.</span>
<span class="sd">        zeropad_csd: bool, optional</span>
<span class="sd">            if True, applies zeropadding in the csd estimation. True by default.</span>
<span class="sd">        window_fftgram: str, optional</span>
<span class="sd">            what type of window to use to produce the fftgrams</span>
<span class="sd">        overlap_factor_welch_psd: float, optional</span>
<span class="sd">            Amount of overlap between data blocks used in pwelch method (range between 0 and 1)</span>
<span class="sd">            (default 0, no overlap)</span>
<span class="sd">        N_average_segments_welch_psd: int, optional</span>
<span class="sd">            Number of segments used for PSD averaging (from both sides of the segment of interest)</span>
<span class="sd">            N_avg_segs should be even and &gt;= 2</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interferometer_1</span> <span class="o">=</span> <span class="n">interferometer_1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interferometer_2</span> <span class="o">=</span> <span class="n">interferometer_2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">calibration_epsilon</span> <span class="o">=</span> <span class="n">calibration_epsilon</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">notch_list_path</span> <span class="o">=</span> <span class="n">notch_list_path</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">overlap_factor</span> <span class="o">=</span> <span class="n">overlap_factor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">zeropad_csd</span> <span class="o">=</span> <span class="n">zeropad_csd</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">window_fftgram</span> <span class="o">=</span> <span class="n">window_fftgram</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">overlap_factor_welch_psd</span> <span class="o">=</span> <span class="n">overlap_factor_welch_psd</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">N_average_segments_welch_psd</span> <span class="o">=</span> <span class="n">N_average_segments_welch_psd</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tensor_orf_calculated</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_vector_orf_calculated</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_scalar_orf_calculated</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_gamma_v_calculated</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sampling_frequency</span> <span class="o">=</span> <span class="n">sampling_frequency</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">duration</span> <span class="o">=</span> <span class="n">duration</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frequencies</span> <span class="o">=</span> <span class="n">frequencies</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">minimum_frequency</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span>
            <span class="n">interferometer_1</span><span class="o">.</span><span class="n">minimum_frequency</span><span class="p">,</span> <span class="n">interferometer_2</span><span class="o">.</span><span class="n">minimum_frequency</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">maximum_frequency</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span>
            <span class="n">interferometer_1</span><span class="o">.</span><span class="n">maximum_frequency</span><span class="p">,</span> <span class="n">interferometer_2</span><span class="o">.</span><span class="n">maximum_frequency</span>
        <span class="p">)</span></div>

    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">==</span> <span class="nb">type</span><span class="p">(</span><span class="n">other</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">all</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span> <span class="o">==</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span>
                        <span class="s2">&quot;name&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;interferometer_1&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;interferometer_2&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;calibration_epsilon&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;duration&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;frequencies&quot;</span><span class="p">,</span>
                    <span class="p">]</span>
                <span class="p">]</span>
            <span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">tensor_overlap_reduction_function</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tensor_orf_calculated</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_tensor_orf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calc_baseline_orf</span><span class="p">(</span><span class="s2">&quot;tensor&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_tensor_orf_calculated</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tensor_orf</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">overlap_reduction_function</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">tensor_overlap_reduction_function</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">vector_overlap_reduction_function</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vector_orf_calculated</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_vector_orf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calc_baseline_orf</span><span class="p">(</span><span class="s2">&quot;vector&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_vector_orf_calculated</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vector_orf</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">scalar_overlap_reduction_function</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scalar_orf_calculated</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_scalar_orf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calc_baseline_orf</span><span class="p">(</span><span class="s2">&quot;scalar&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_scalar_orf_calculated</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scalar_orf</span>

    <span class="k">def</span> <span class="nf">set_frequency_mask</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">notch_list_path</span><span class="p">):</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frequencies</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">minimum_frequency</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">frequencies</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">maximum_frequency</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">notch_list_path</span><span class="p">:</span>
            <span class="n">notch_list</span> <span class="o">=</span> <span class="n">StochNotchList</span><span class="o">.</span><span class="n">load_from_file</span><span class="p">(</span><span class="n">notch_list_path</span><span class="p">)</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">notch_mask</span> <span class="o">=</span> <span class="n">notch_list</span><span class="o">.</span><span class="n">get_idxs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frequencies</span><span class="p">)</span>
            <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">notch_mask</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">mask</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">gamma_v</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_gamma_v_calculated</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_gamma_v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calc_baseline_orf</span><span class="p">(</span><span class="s2">&quot;right_left&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_gamma_v_calculated</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_gamma_v</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">duration</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_duration_set</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_duration</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Duration not yet set&quot;</span><span class="p">)</span>

    <span class="nd">@duration</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">duration</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dur</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets the duration for the Baseline and interferometers</span>

<span class="sd">        If `duration` is passed, check that it matches the `duration`</span>
<span class="sd">        in the interferometers, if present.</span>
<span class="sd">        If not passed, check that the durations in the interferometers</span>
<span class="sd">        match each other, if present, and set the Baseline duration from</span>
<span class="sd">        the interferometer durations.</span>
<span class="sd">        If not passed and only one of the interferometers has the duration</span>
<span class="sd">        set, set the Baseline duration and duration for the other</span>
<span class="sd">        interferometer from that.</span>
<span class="sd">        Requires that either `duration` is not None or at least one of the</span>
<span class="sd">        interferometers has the `duration` set.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ==========</span>
<span class="sd">        duration: float, optional</span>
<span class="sd">            The duration to set for the Baseline and interferometers</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">dur</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">check_durations_match_baseline_ifos</span><span class="p">(</span><span class="n">dur</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_duration</span> <span class="o">=</span> <span class="n">dur</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">interferometer_1</span><span class="o">.</span><span class="n">duration</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">interferometer_1</span><span class="o">.</span><span class="n">duration</span> <span class="o">=</span> <span class="n">dur</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">interferometer_2</span><span class="o">.</span><span class="n">duration</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">interferometer_2</span><span class="o">.</span><span class="n">duration</span> <span class="o">=</span> <span class="n">dur</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_duration_set</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">interferometer_1</span><span class="o">.</span><span class="n">duration</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">interferometer_2</span><span class="o">.</span><span class="n">duration</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">check_ifo_durations_match</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">duration</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">interferometer_1</span><span class="o">.</span><span class="n">duration</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_duration_set</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">interferometer_1</span><span class="o">.</span><span class="n">duration</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">duration</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">interferometer_1</span><span class="o">.</span><span class="n">duration</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">interferometer_2</span><span class="o">.</span><span class="n">duration</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">interferometer_1</span><span class="o">.</span><span class="n">duration</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_duration_set</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">interferometer_2</span><span class="o">.</span><span class="n">duration</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">duration</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">interferometer_2</span><span class="o">.</span><span class="n">duration</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">interferometer_1</span><span class="o">.</span><span class="n">duration</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">interferometer_2</span><span class="o">.</span><span class="n">duration</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_duration_set</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Neither baseline nor interferometer duration is set.&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_duration</span> <span class="o">=</span> <span class="n">dur</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_duration_set</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">frequencies</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_frequencies_set</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_frequencies</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;frequencies have not yet been set&quot;</span><span class="p">)</span>

    <span class="nd">@frequencies</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">frequencies</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">freqs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_frequencies</span> <span class="o">=</span> <span class="n">freqs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_frequencies_set</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="c1"># delete the orfs, set the calculated flag to zero</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tensor_orf_calculated</span><span class="p">:</span>
            <span class="nb">delattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_tensor_orf&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_tensor_orf_calculated</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scalar_orf_calculated</span><span class="p">:</span>
            <span class="nb">delattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_scalar_orf&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_scalar_orf_calculated</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vector_orf_calculated</span><span class="p">:</span>
            <span class="nb">delattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_vector_orf&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_vector_orf_calculated</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">check_durations_match_baseline_ifos</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">duration</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">interferometer_1</span><span class="o">.</span><span class="n">duration</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">interferometer_2</span><span class="o">.</span><span class="n">duration</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">check_ifo_durations_match</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">duration</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">interferometer_1</span><span class="o">.</span><span class="n">duration</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span>
                    <span class="s2">&quot;Interferometer durations do not match given Baseline duration!&quot;</span>
                <span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">interferometer_1</span><span class="o">.</span><span class="n">duration</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">duration</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">interferometer_1</span><span class="o">.</span><span class="n">duration</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span>
                    <span class="s2">&quot;Interferometer_1 duration does not match given Baseline duration!&quot;</span>
                <span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">interferometer_2</span><span class="o">.</span><span class="n">duration</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">duration</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">interferometer_2</span><span class="o">.</span><span class="n">duration</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span>
                    <span class="s2">&quot;Interferometer_2 duration does not match given Baseline duration!&quot;</span>
                <span class="p">)</span>

    <span class="k">def</span> <span class="nf">check_ifo_durations_match</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">interferometer_1</span><span class="o">.</span><span class="n">duration</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">interferometer_2</span><span class="o">.</span><span class="n">duration</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span><span class="s2">&quot;Interferometer durations do not match each other!&quot;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">sampling_frequency</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_sampling_frequency&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sampling_frequency</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;sampling frequency not set&quot;</span><span class="p">)</span>

    <span class="nd">@sampling_frequency</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">sampling_frequency</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sampling_frequency</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets the sampling_frequency for the Baseline and interferometers</span>

<span class="sd">        If `sampling_frequency` is passed, check that it matches the `sampling_frequency`</span>
<span class="sd">        in the interferometers, if present.</span>
<span class="sd">        If not passed, check that the sampling_frequencies in the interferometers</span>
<span class="sd">        match each other, if present, and set the Baseline sampling_frequency from</span>
<span class="sd">        the sampling_frequencies.</span>
<span class="sd">        If not passed and only one of the interferometers has the sampling_frequency</span>
<span class="sd">        set, set the Baseline sampling_frequency and sampling_frequency for the other</span>
<span class="sd">        interferometer from that.</span>
<span class="sd">        Requires that either `sampling_frequency` is not None or at least one of the</span>
<span class="sd">        interferometers has the `sampling_frequency` set.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ==========</span>
<span class="sd">        sampling_frequency: float, optional</span>
<span class="sd">            The sampling_frequency to set for the Baseline and interferometers</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">sampling_frequency</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">check_sampling_frequencies_match_baseline_ifos</span><span class="p">(</span><span class="n">sampling_frequency</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_sampling_frequency</span> <span class="o">=</span> <span class="n">sampling_frequency</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">interferometer_1</span><span class="o">.</span><span class="n">sampling_frequency</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">interferometer_1</span><span class="o">.</span><span class="n">sampling_frequency</span> <span class="o">=</span> <span class="n">sampling_frequency</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">interferometer_2</span><span class="o">.</span><span class="n">sampling_frequency</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">interferometer_2</span><span class="o">.</span><span class="n">sampling_frequency</span> <span class="o">=</span> <span class="n">sampling_frequency</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_sampling_frequency_set</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">interferometer_1</span><span class="o">.</span><span class="n">sampling_frequency</span>
            <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">interferometer_2</span><span class="o">.</span><span class="n">sampling_frequency</span>
        <span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">check_ifo_sampling_frequencies_match</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_sampling_frequency</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">interferometer_1</span><span class="o">.</span><span class="n">sampling_frequency</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_sampling_frequency_set</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">interferometer_1</span><span class="o">.</span><span class="n">sampling_frequency</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sampling_frequency</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">interferometer_1</span><span class="o">.</span><span class="n">sampling_frequency</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">interferometer_2</span><span class="o">.</span><span class="n">sampling_frequency</span> <span class="o">=</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">interferometer_1</span><span class="o">.</span><span class="n">sampling_frequency</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_sampling_frequency_set</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">interferometer_2</span><span class="o">.</span><span class="n">sampling_frequency</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_sampling_frequency</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">interferometer_2</span><span class="o">.</span><span class="n">sampling_frequency</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">interferometer_1</span><span class="o">.</span><span class="n">sampling_frequency</span> <span class="o">=</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">interferometer_2</span><span class="o">.</span><span class="n">sampling_frequency</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_sampling_frequency_set</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="s2">&quot;Neither baseline nor interferometer sampling_frequency is set.&quot;</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_sampling_frequency</span> <span class="o">=</span> <span class="n">sampling_frequency</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_sampling_frequency_set</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">badGPStimes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_badGPStimes&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_badGPStimes</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;bad GPS times are not set - need to run delta_sigma_cut first.&quot;</span>
            <span class="p">)</span>

    <span class="nd">@badGPStimes</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">badGPStimes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">badGPStimes</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_badGPStimes</span> <span class="o">=</span> <span class="n">badGPStimes</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">delta_sigmas</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;delta_sigmas&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_delta_sigmas</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;delta_sigmas are not set - need to run delta_sigma_cut first.&quot;</span>
            <span class="p">)</span>

    <span class="nd">@delta_sigmas</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">delta_sigmas</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">delta_sigmas</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_delta_sigmas</span> <span class="o">=</span> <span class="n">delta_sigmas</span>

    <span class="k">def</span> <span class="nf">check_sampling_frequencies_match_baseline_ifos</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sampling_frequency</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">interferometer_1</span><span class="o">.</span><span class="n">sampling_frequency</span>
            <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">interferometer_2</span><span class="o">.</span><span class="n">sampling_frequency</span>
        <span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">check_ifo_sampling_frequencies_match</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">sampling_frequency</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">interferometer_1</span><span class="o">.</span><span class="n">sampling_frequency</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span>
                    <span class="s2">&quot;Interferometer sampling_frequencies do not match given Baseline sampling_frequency!&quot;</span>
                <span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">interferometer_1</span><span class="o">.</span><span class="n">sampling_frequency</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">sampling_frequency</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">interferometer_1</span><span class="o">.</span><span class="n">sampling_frequency</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span>
                    <span class="s2">&quot;Interferometer_1 sampling_frequency does not match given Baseline sampling_frequency!&quot;</span>
                <span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">interferometer_2</span><span class="o">.</span><span class="n">sampling_frequency</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">sampling_frequency</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">interferometer_2</span><span class="o">.</span><span class="n">sampling_frequency</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span>
                    <span class="s2">&quot;Interferometer_2 sampling_frequency does not match given Baseline sampling_frequency!&quot;</span>
                <span class="p">)</span>

    <span class="k">def</span> <span class="nf">check_ifo_sampling_frequencies_match</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">interferometer_1</span><span class="o">.</span><span class="n">sampling_frequency</span>
            <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">interferometer_2</span><span class="o">.</span><span class="n">sampling_frequency</span>
        <span class="p">):</span>
            <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span>
                <span class="s2">&quot;Interferometer sampling_frequencies do not match each other!&quot;</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="nf">calc_baseline_orf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">polarization</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">calc_orf</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">frequencies</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">interferometer_1</span><span class="o">.</span><span class="n">vertex</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">interferometer_2</span><span class="o">.</span><span class="n">vertex</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">interferometer_1</span><span class="o">.</span><span class="n">x</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">interferometer_2</span><span class="o">.</span><span class="n">x</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">interferometer_1</span><span class="o">.</span><span class="n">y</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">interferometer_2</span><span class="o">.</span><span class="n">y</span><span class="p">,</span>
            <span class="n">polarization</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_interferometers</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">interferometers</span><span class="p">,</span>
        <span class="n">duration</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">calibration_epsilon</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">ifo</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">ifo</span> <span class="ow">in</span> <span class="n">interferometers</span><span class="p">])</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
            <span class="n">interferometer_1</span><span class="o">=</span><span class="n">interferometers</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="n">interferometer_2</span><span class="o">=</span><span class="n">interferometers</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
            <span class="n">duration</span><span class="o">=</span><span class="n">duration</span><span class="p">,</span>
            <span class="n">calibration_epsilon</span><span class="o">=</span><span class="n">calibration_epsilon</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_parameters</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">interferometer_1</span><span class="p">,</span>
        <span class="n">interferometer_2</span><span class="p">,</span>
        <span class="n">parameters</span><span class="p">,</span>
        <span class="n">frequencies</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">interferometer_1</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="n">interferometer_2</span><span class="o">.</span><span class="n">name</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
            <span class="n">interferometer_1</span><span class="o">=</span><span class="n">interferometer_1</span><span class="p">,</span>
            <span class="n">interferometer_2</span><span class="o">=</span><span class="n">interferometer_2</span><span class="p">,</span>
            <span class="n">duration</span><span class="o">=</span><span class="n">parameters</span><span class="o">.</span><span class="n">segment_duration</span><span class="p">,</span>
            <span class="n">calibration_epsilon</span><span class="o">=</span><span class="n">parameters</span><span class="o">.</span><span class="n">calibration_epsilon</span><span class="p">,</span>
            <span class="n">frequencies</span><span class="o">=</span><span class="n">frequencies</span><span class="p">,</span>
            <span class="n">notch_list_path</span><span class="o">=</span><span class="n">parameters</span><span class="o">.</span><span class="n">notch_list_path</span><span class="p">,</span>
            <span class="n">overlap_factor</span><span class="o">=</span><span class="n">parameters</span><span class="o">.</span><span class="n">overlap_factor</span><span class="p">,</span>
            <span class="n">zeropad_csd</span><span class="o">=</span><span class="n">parameters</span><span class="o">.</span><span class="n">zeropad_csd</span><span class="p">,</span>
            <span class="n">window_fftgram</span><span class="o">=</span><span class="n">parameters</span><span class="o">.</span><span class="n">window_fftgram</span><span class="p">,</span>
            <span class="n">overlap_factor_welch_psd</span><span class="o">=</span><span class="n">parameters</span><span class="o">.</span><span class="n">overlap_factor_welch_psd</span><span class="p">,</span>
            <span class="n">N_average_segments_welch_psd</span><span class="o">=</span><span class="n">parameters</span><span class="o">.</span><span class="n">N_average_segments_welch_psd</span><span class="p">,</span>
            <span class="n">sampling_frequency</span><span class="o">=</span><span class="n">parameters</span><span class="o">.</span><span class="n">new_sample_rate</span><span class="p">,</span>
        <span class="p">)</span>

<div class="viewcode-block" id="Baseline.load_from_pickle"><a class="viewcode-back" href="../../api/pygwb.baseline.Baseline.html#pygwb.baseline.Baseline.load_from_pickle">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">load_from_pickle</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Loads entire baseline object from pickle file&quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span></div>

<div class="viewcode-block" id="Baseline.save_to_pickle"><a class="viewcode-back" href="../../api/pygwb.baseline.Baseline.html#pygwb.baseline.Baseline.save_to_pickle">[docs]</a>    <span class="k">def</span> <span class="nf">save_to_pickle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Saves entire baseline object to pickle file&quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span></div>

<div class="viewcode-block" id="Baseline.set_cross_and_power_spectral_density"><a class="viewcode-back" href="../../api/pygwb.baseline.Baseline.html#pygwb.baseline.Baseline.set_cross_and_power_spectral_density">[docs]</a>    <span class="k">def</span> <span class="nf">set_cross_and_power_spectral_density</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frequency_resolution</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets the power spectral density in each interferometer</span>
<span class="sd">        and the cross spectral density for the baseline object when data are available</span>

<span class="sd">        Parameters</span>
<span class="sd">        ==========</span>
<span class="sd">        frequency_resolution: float</span>
<span class="sd">            the frequency resolution at which the cross and power spectral densities are calculated.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">interferometer_1</span><span class="o">.</span><span class="n">set_psd_spectrogram</span><span class="p">(</span>
                <span class="n">frequency_resolution</span><span class="p">,</span>
                <span class="n">overlap_factor</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">overlap_factor</span><span class="p">,</span>
                <span class="n">window_fftgram</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">window_fftgram</span><span class="p">,</span>
                <span class="n">overlap_factor_welch_psd</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">overlap_factor_welch_psd</span><span class="p">,</span>
                <span class="n">N_average_segments_welch_psd</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">N_average_segments_welch_psd</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span>
                <span class="s2">&quot;Interferometer </span><span class="si">{self.interferometer_1.name}</span><span class="s2"> has no timeseries data! Need to set timeseries data in the interferometer first.&quot;</span>
            <span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">interferometer_2</span><span class="o">.</span><span class="n">set_psd_spectrogram</span><span class="p">(</span>
                <span class="n">frequency_resolution</span><span class="p">,</span>
                <span class="n">overlap_factor</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">overlap_factor</span><span class="p">,</span>
                <span class="n">window_fftgram</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">window_fftgram</span><span class="p">,</span>
                <span class="n">overlap_factor_welch_psd</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">overlap_factor_welch_psd</span><span class="p">,</span>
                <span class="n">N_average_segments_welch_psd</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">N_average_segments_welch_psd</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span>
                <span class="s2">&quot;Interferometer </span><span class="si">{self.interferometer_2.name}</span><span class="s2"> has no timeseries data! Need to set timeseries data in the interferometer first.&quot;</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">csd</span> <span class="o">=</span> <span class="n">cross_spectral_density</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">interferometer_1</span><span class="o">.</span><span class="n">timeseries</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">interferometer_2</span><span class="o">.</span><span class="n">timeseries</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">duration</span><span class="p">,</span>
            <span class="n">frequency_resolution</span><span class="p">,</span>
            <span class="n">overlap_factor</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">overlap_factor</span><span class="p">,</span>
            <span class="n">zeropad</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">zeropad_csd</span><span class="p">,</span>
            <span class="n">window_fftgram</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">window_fftgram</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># TODO: make this less fragile.</span>
        <span class="c1"># For now, reset frequencies,</span>
        <span class="c1"># recalculate ORF in case frequencies have changed.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tensor_orf_calculated</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frequencies</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">csd</span><span class="o">.</span><span class="n">frequencies</span><span class="o">.</span><span class="n">value</span></div>

<div class="viewcode-block" id="Baseline.set_average_power_spectral_densities"><a class="viewcode-back" href="../../api/pygwb.baseline.Baseline.html#pygwb.baseline.Baseline.set_average_power_spectral_densities">[docs]</a>    <span class="k">def</span> <span class="nf">set_average_power_spectral_densities</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;If psds have been calculated, sets the average psd in each ifo&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">interferometer_1</span><span class="o">.</span><span class="n">set_average_psd</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N_average_segments_welch_psd</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">interferometer_2</span><span class="o">.</span><span class="n">set_average_psd</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N_average_segments_welch_psd</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="s2">&quot;PSDs have not been calculated yet! Need to set_cross_and_power_spectral_density first.&quot;</span>
            <span class="p">)</span>

        <span class="c1"># TODO: make this less fragile.</span>
        <span class="c1"># For now, recalculate ORF in case frequencies have changed.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tensor_orf_calculated</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frequencies</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">csd</span><span class="o">.</span><span class="n">frequencies</span><span class="o">.</span><span class="n">value</span></div>

<div class="viewcode-block" id="Baseline.set_average_cross_spectral_density"><a class="viewcode-back" href="../../api/pygwb.baseline.Baseline.html#pygwb.baseline.Baseline.set_average_cross_spectral_density">[docs]</a>    <span class="k">def</span> <span class="nf">set_average_cross_spectral_density</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;If csd has been calculated, sets the average csd for the baseline&quot;&quot;&quot;</span>
        <span class="n">stride</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">duration</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">overlap_factor</span><span class="p">)</span>
        <span class="n">csd_segment_offset</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">duration</span> <span class="o">/</span> <span class="n">stride</span><span class="p">))</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">average_csd</span> <span class="o">=</span> <span class="n">coarse_grain_spectrogram</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">csd</span><span class="p">)[</span>
                <span class="n">csd_segment_offset</span> <span class="p">:</span> <span class="o">-</span><span class="p">(</span><span class="n">csd_segment_offset</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="p">]</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="s2">&quot;CSD has not been calculated yet! Need to set_cross_and_power_spectral_density first.&quot;</span>
            <span class="p">)</span>
        <span class="c1"># TODO: make this less fragile.</span>
        <span class="c1"># For now, recalculate ORF in case frequencies have changed.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tensor_orf_calculated</span> <span class="o">=</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="Baseline.crop_frequencies_average_psd_csd"><a class="viewcode-back" href="../../api/pygwb.baseline.Baseline.html#pygwb.baseline.Baseline.crop_frequencies_average_psd_csd">[docs]</a>    <span class="k">def</span> <span class="nf">crop_frequencies_average_psd_csd</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">flow</span><span class="p">,</span> <span class="n">fhigh</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;crop frequencies of average PSDs and CSDS. Done in place. This is not completely implemented yet.</span>

<span class="sd">        Parameters:</span>
<span class="sd">        ===========</span>
<span class="sd">            flow: float</span>
<span class="sd">                low frequency</span>
<span class="sd">            fhigh: float</span>
<span class="sd">                high frequency</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">deltaF</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequencies</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequencies</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">indexes</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frequencies</span> <span class="o">&gt;=</span> <span class="n">flow</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frequencies</span> <span class="o">&lt;=</span> <span class="n">fhigh</span><span class="p">)</span>
        <span class="c1"># reset frequencies</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frequencies</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequencies</span><span class="p">[</span><span class="n">indexes</span><span class="p">]</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">interferometer_1</span><span class="p">,</span> <span class="s2">&quot;average_psd&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">interferometer_1</span><span class="o">.</span><span class="n">average_psd</span> <span class="o">=</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">interferometer_1</span><span class="o">.</span><span class="n">average_psd</span><span class="o">.</span><span class="n">crop_frequencies</span><span class="p">(</span><span class="n">flow</span><span class="p">,</span> <span class="n">fhigh</span> <span class="o">+</span> <span class="n">deltaF</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">interferometer_2</span><span class="p">,</span> <span class="s2">&quot;average_psd&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">interferometer_2</span><span class="o">.</span><span class="n">average_psd</span> <span class="o">=</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">interferometer_2</span><span class="o">.</span><span class="n">average_psd</span><span class="o">.</span><span class="n">crop_frequencies</span><span class="p">(</span><span class="n">flow</span><span class="p">,</span> <span class="n">fhigh</span> <span class="o">+</span> <span class="n">deltaF</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;average_csd&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">average_csd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">average_csd</span><span class="o">.</span><span class="n">crop_frequencies</span><span class="p">(</span><span class="n">flow</span><span class="p">,</span> <span class="n">fhigh</span> <span class="o">+</span> <span class="n">deltaF</span><span class="p">)</span></div>

<div class="viewcode-block" id="Baseline.set_point_estimate_sigma_spectrogram"><a class="viewcode-back" href="../../api/pygwb.baseline.Baseline.html#pygwb.baseline.Baseline.set_point_estimate_sigma_spectrogram">[docs]</a>    <span class="k">def</span> <span class="nf">set_point_estimate_sigma_spectrogram</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">weight_spectrogram</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">fref</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span> <span class="n">flow</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">fhigh</span><span class="o">=</span><span class="mi">1726</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set point estimate and sigma spectrogram. Resulting spectrogram</span>
<span class="sd">        *does not include frequency weighting for alpha*.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># set CSD if not set</span>
        <span class="c1"># self.set_average_cross_spectral_density()</span>

        <span class="c1"># set PSDs if not set</span>
        <span class="c1"># self.set_average_power_spectral_densities()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">crop_frequencies_average_psd_csd</span><span class="p">(</span><span class="n">flow</span><span class="p">,</span> <span class="n">fhigh</span><span class="p">)</span>

        <span class="c1"># don&#39;t get rid of information unless we need to.</span>
        <span class="n">Y_fs</span><span class="p">,</span> <span class="n">var_fs</span> <span class="o">=</span> <span class="n">calculate_point_estimate_sigma_spectrogram</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">frequencies</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">average_csd</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">interferometer_1</span><span class="o">.</span><span class="n">average_psd</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">interferometer_2</span><span class="o">.</span><span class="n">average_psd</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">overlap_reduction_function</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sampling_frequency</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">duration</span><span class="p">,</span>
            <span class="n">weight_spectrogram</span><span class="o">=</span><span class="n">weight_spectrogram</span><span class="p">,</span>
            <span class="n">fref</span><span class="o">=</span><span class="n">fref</span><span class="p">,</span>
            <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">weight_spectrogram</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">spectrogram_alpha_weight</span> <span class="o">=</span> <span class="n">alpha</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">spectrogram_alpha_weight</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="n">sigma_name</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot; sigma spectrogram alpha=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">spectrogram_alpha_weight</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">point_estimate_spectrogram</span> <span class="o">=</span> <span class="n">gwpy</span><span class="o">.</span><span class="n">spectrogram</span><span class="o">.</span><span class="n">Spectrogram</span><span class="p">(</span>
            <span class="n">Y_fs</span><span class="p">,</span>
            <span class="n">times</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">average_csd</span><span class="o">.</span><span class="n">times</span><span class="p">,</span>
            <span class="n">frequencies</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">average_csd</span><span class="o">.</span><span class="n">frequencies</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot; with alpha=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">spectrogram_alpha_weight</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sigma_spectrogram</span> <span class="o">=</span> <span class="n">gwpy</span><span class="o">.</span><span class="n">spectrogram</span><span class="o">.</span><span class="n">Spectrogram</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">var_fs</span><span class="p">),</span>
            <span class="n">times</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">average_csd</span><span class="o">.</span><span class="n">times</span><span class="p">,</span>
            <span class="n">frequencies</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">average_csd</span><span class="o">.</span><span class="n">frequencies</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="n">sigma_name</span><span class="p">,</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="Baseline.set_point_estimate_sigma_spectrum"><a class="viewcode-back" href="../../api/pygwb.baseline.Baseline.html#pygwb.baseline.Baseline.set_point_estimate_sigma_spectrum">[docs]</a>    <span class="k">def</span> <span class="nf">set_point_estimate_sigma_spectrum</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">badtimes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">weight_spectrogram</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">alpha</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">fref</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span>
        <span class="n">flow</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
        <span class="n">fhigh</span><span class="o">=</span><span class="mi">1726</span><span class="p">,</span>
        <span class="n">notch_list_path</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets time-integrated point estimate spectrum and variance in each frequency bin.</span>
<span class="sd">        Point estimate is *unweighted* by alpha.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ==========</span>
<span class="sd">        badtimes: np.array, optional</span>
<span class="sd">            array of times to exclude from point estimate/sigma calculation. If no times are passed, none will be excluded.</span>
<span class="sd">        weight_spectrogram: bool, optional</span>
<span class="sd">            weight spectrogram flag; if True, the spectrogram will be re-weighted using the alpha passed here.Default is False.</span>
<span class="sd">        alpha: float, optional</span>
<span class="sd">            spectral index to use in the re-weighting. Default is 0.</span>
<span class="sd">        fref: float, optional</span>
<span class="sd">            reference frequency to use in the re-weighting. Default is 25.</span>
<span class="sd">        flow: float, optional</span>
<span class="sd">            low frequency. Default is 20 Hz.</span>
<span class="sd">        fhigh: float, optional</span>
<span class="sd">            high frequency. Default is 1726 Hz.</span>
<span class="sd">        notch_list_path: str, optional</span>
<span class="sd">            path to the notch list to use in the spectrum. If none is passed no notches will be applied - even if set in the baseline. This is to ensure notching isn&#39;t applied automatically to spectra; it is applied automatically only when integrating over frequencies.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># set unweighted point estimate and sigma spectrograms</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;point_estimate_spectrogram&quot;</span><span class="p">):</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="s2">&quot;Point estimate and sigma spectrograms are not set yet. setting now...&quot;</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_point_estimate_sigma_spectrogram</span><span class="p">(</span>
                <span class="n">weight_spectrogram</span><span class="o">=</span><span class="n">weight_spectrogram</span><span class="p">,</span>
                <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span>
                <span class="n">fref</span><span class="o">=</span><span class="n">fref</span><span class="p">,</span>
                <span class="n">flow</span><span class="o">=</span><span class="n">flow</span><span class="p">,</span>
                <span class="n">fhigh</span><span class="o">=</span><span class="n">fhigh</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="n">deltaF</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequencies</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequencies</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">notch_list_path</span><span class="p">:</span>
            <span class="n">lines_object</span> <span class="o">=</span> <span class="n">StochNotchList</span><span class="o">.</span><span class="n">load_from_file</span><span class="p">(</span><span class="n">notch_list_path</span><span class="p">)</span>
            <span class="n">notches</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">lines_object</span><span class="o">.</span><span class="n">get_idxs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frequencies</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">notches</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">badtimes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;badGPStimes&quot;</span><span class="p">):</span>
                <span class="n">badtimes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">badGPStimes</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">badtimes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>

        <span class="c1"># should be True for each bad time</span>
        <span class="n">bad_times_indexes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
            <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">t</span> <span class="o">==</span> <span class="n">badtimes</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">point_estimate_spectrogram</span><span class="o">.</span><span class="n">times</span><span class="o">.</span><span class="n">value</span><span class="p">]</span>
        <span class="p">)</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">bad_times_indexes</span><span class="p">)</span><span class="si">}</span><span class="s2"> bad segments removed.&quot;</span><span class="p">)</span>

        <span class="c1"># start time, for metadata</span>
        <span class="n">epoch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">point_estimate_spectrogram</span><span class="o">.</span><span class="n">times</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">point_estimate_spectrogram</span><span class="p">[</span><span class="n">bad_times_indexes</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sigma_spectrogram</span><span class="p">[</span><span class="n">bad_times_indexes</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sampling_frequency</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;the sampling frequency is not set! Cannot proceed with spectrum calculation.&quot;</span>
            <span class="p">)</span>

        <span class="n">point_estimate</span><span class="p">,</span> <span class="n">sigma</span> <span class="o">=</span> <span class="n">postprocess_Y_sigma</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">point_estimate_spectrogram</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sigma_spectrogram</span><span class="o">.</span><span class="n">value</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">duration</span><span class="p">,</span>
            <span class="n">deltaF</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sampling_frequency</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># REWEIGHT FUNCTION, self.spectrogram_alpha_weight is old weight, supplied alpha is new weight.</span>
        <span class="c1"># apply notches now - if passed.</span>
        <span class="n">point_estimate</span><span class="p">[</span><span class="n">notches</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">sigma</span><span class="p">[</span><span class="n">notches</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">point_estimate_spectrum</span> <span class="o">=</span> <span class="n">gwpy</span><span class="o">.</span><span class="n">frequencyseries</span><span class="o">.</span><span class="n">FrequencySeries</span><span class="p">(</span>
            <span class="n">point_estimate</span><span class="p">,</span>
            <span class="n">frequencies</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">frequencies</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;unweighted point estimate spectrum&quot;</span><span class="p">,</span>
            <span class="n">epoch</span><span class="o">=</span><span class="n">epoch</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sigma_spectrum</span> <span class="o">=</span> <span class="n">gwpy</span><span class="o">.</span><span class="n">frequencyseries</span><span class="o">.</span><span class="n">FrequencySeries</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">sigma</span><span class="p">),</span>
            <span class="n">frequencies</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">frequencies</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;unweighted sigma spectrum&quot;</span><span class="p">,</span>
            <span class="n">epoch</span><span class="o">=</span><span class="n">epoch</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">point_estimate_alpha</span> <span class="o">=</span> <span class="mi">0</span></div>

<div class="viewcode-block" id="Baseline.set_point_estimate_sigma"><a class="viewcode-back" href="../../api/pygwb.baseline.Baseline.html#pygwb.baseline.Baseline.set_point_estimate_sigma">[docs]</a>    <span class="k">def</span> <span class="nf">set_point_estimate_sigma</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">badtimes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">apply_weighting</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">alpha</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">fref</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span>
        <span class="n">flow</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
        <span class="n">fhigh</span><span class="o">=</span><span class="mi">1726</span><span class="p">,</span>
        <span class="n">notch_list_path</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set point estimate sigma based on a set of parameters. This is estimate of omega_gw in each frequency bin.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ==========</span>
<span class="sd">        badtimes: np.array, optional</span>
<span class="sd">            array of times to exclude from point estimate/sigma calculation. If no times are passed, none will be excluded.</span>
<span class="sd">        apply_weighting: bool, optional</span>
<span class="sd">            apply weighting flag; if True, the point estimate and sigma will be weighted using the alpha passed here. Default is True.</span>
<span class="sd">        alpha: float, optional</span>
<span class="sd">            spectral index to use in the re-weighting. Default is 0.</span>
<span class="sd">        fref: float, optional</span>
<span class="sd">            reference frequency to use in the re-weighting. Default is 25.</span>
<span class="sd">        flow: float, optional</span>
<span class="sd">            low frequency. Default is 20 Hz.</span>
<span class="sd">        fhigh: float, optional</span>
<span class="sd">            high frequency. Default is 1726 Hz.</span>
<span class="sd">        notch_list_path: str, optional</span>
<span class="sd">            path to the notch list to use in the spectrum; if the notch_list isn&#39;t set in the baseline, user can pass it directly here. If it is not set and if none is passed no notches will be applied.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># TODO: Add check if badtimes is passed and point estimate spectrum</span>
        <span class="c1"># already exists...</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;point_estimate_spectrum&quot;</span><span class="p">):</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="s2">&quot;Point estimate and sigma spectra have not been set before. Setting it now...&quot;</span>
            <span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                <span class="s2">&quot;No weighting supplied in setting of spectrum. Supplied when combining for final sigma&quot;</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_point_estimate_sigma_spectrum</span><span class="p">(</span>
                <span class="n">badtimes</span><span class="o">=</span><span class="n">badtimes</span><span class="p">,</span>
                <span class="c1"># notch_list_path=notch_list_path,</span>
                <span class="n">weight_spectrogram</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span>
                <span class="n">fref</span><span class="o">=</span><span class="n">fref</span><span class="p">,</span>
                <span class="n">flow</span><span class="o">=</span><span class="n">flow</span><span class="p">,</span>
                <span class="n">fhigh</span><span class="o">=</span><span class="n">fhigh</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="c1"># crop frequencies according to params before combining over them</span>
        <span class="n">deltaF</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequencies</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequencies</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">Y_spec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">point_estimate_spectrum</span><span class="o">.</span><span class="n">crop</span><span class="p">(</span><span class="n">flow</span><span class="p">,</span> <span class="n">fhigh</span> <span class="o">+</span> <span class="n">deltaF</span><span class="p">)</span>
        <span class="n">sigma_spec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sigma_spectrum</span><span class="o">.</span><span class="n">crop</span><span class="p">(</span><span class="n">flow</span><span class="p">,</span> <span class="n">fhigh</span> <span class="o">+</span> <span class="n">deltaF</span><span class="p">)</span>
        <span class="n">freq_band_cut</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frequencies</span> <span class="o">&gt;=</span> <span class="n">flow</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frequencies</span> <span class="o">&lt;=</span> <span class="n">fhigh</span><span class="p">)</span>
        <span class="c1"># self.frequencies = self.frequencies[freq_band_cut]</span>

        <span class="c1"># check notch list</span>
        <span class="c1"># TODO: make this less fragile...at the moment these indexes</span>
        <span class="c1"># must agree with those after cropping, so the notches must agree with the params</span>
        <span class="c1"># struct in some way. Seems dangerous</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">notch_list_path</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;loading notches from&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">notch_list_path</span><span class="p">)</span>
            <span class="n">lines_object</span> <span class="o">=</span> <span class="n">StochNotchList</span><span class="o">.</span><span class="n">load_from_file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">notch_list_path</span><span class="p">)</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">notch_indexes</span> <span class="o">=</span> <span class="n">lines_object</span><span class="o">.</span><span class="n">get_idxs</span><span class="p">(</span><span class="n">Y_spec</span><span class="o">.</span><span class="n">frequencies</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">notch_list_path</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;loading notches from&quot;</span><span class="p">,</span> <span class="n">notch_list_path</span><span class="p">)</span>
            <span class="n">lines_object</span> <span class="o">=</span> <span class="n">StochNotchList</span><span class="o">.</span><span class="n">load_from_file</span><span class="p">(</span><span class="n">notch_list_path</span><span class="p">)</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">notch_indexes</span> <span class="o">=</span> <span class="n">lines_object</span><span class="o">.</span><span class="n">get_idxs</span><span class="p">(</span><span class="n">Y_spec</span><span class="o">.</span><span class="n">frequencies</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">notch_indexes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">Y_spec</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>

        <span class="c1"># get Y, sigma</span>
        <span class="k">if</span> <span class="n">apply_weighting</span><span class="p">:</span>
            <span class="n">Y</span><span class="p">,</span> <span class="n">sigma</span> <span class="o">=</span> <span class="n">calc_Y_sigma_from_Yf_varf</span><span class="p">(</span>
                <span class="n">Y_spec</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="n">notch_indexes</span><span class="p">],</span>
                <span class="n">sigma_spec</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="n">notch_indexes</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span><span class="p">,</span>
                <span class="n">freqs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">frequencies</span><span class="p">[</span><span class="n">notch_indexes</span><span class="p">],</span>
                <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span>
                <span class="n">fref</span><span class="o">=</span><span class="n">fref</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="s2">&quot;Be careful, in general weighting is not applied until this point&quot;</span>
            <span class="p">)</span>
            <span class="n">Y</span><span class="p">,</span> <span class="n">sigma</span> <span class="o">=</span> <span class="n">calc_Y_sigma_from_Yf_varf</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">point_estimate_spectrum</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sigma_spectrogram</span><span class="o">.</span><span class="n">value</span><span class="o">**</span><span class="mi">2</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">point_estimate</span> <span class="o">=</span> <span class="n">Y</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sigma</span> <span class="o">=</span> <span class="n">sigma</span></div>

<div class="viewcode-block" id="Baseline.calculate_delta_sigma_cut"><a class="viewcode-back" href="../../api/pygwb.baseline.Baseline.html#pygwb.baseline.Baseline.calculate_delta_sigma_cut">[docs]</a>    <span class="k">def</span> <span class="nf">calculate_delta_sigma_cut</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">delta_sigma_cut</span><span class="p">,</span>
        <span class="n">alphas</span><span class="p">,</span>
        <span class="n">flow</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
        <span class="n">fhigh</span><span class="o">=</span><span class="mi">1726</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Calculates the delta sigma cut using the naive and average psds, if set in the baseline.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ==========</span>
<span class="sd">        delta_sigma_cut: float</span>
<span class="sd">            the cutoff to implement in the delta sigma cut.</span>
<span class="sd">        alphas: list</span>
<span class="sd">            set of spectral indices to use in the delta sigma cut calculation.</span>
<span class="sd">        flow: float, optional</span>
<span class="sd">            low frequency. Default is 20 Hz.</span>
<span class="sd">        fhigh: float, optional</span>
<span class="sd">            high frequency. Default is 1726 Hz.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">deltaF</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequencies</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequencies</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">crop_frequencies_average_psd_csd</span><span class="p">(</span><span class="n">flow</span><span class="o">=</span><span class="n">flow</span><span class="p">,</span> <span class="n">fhigh</span><span class="o">=</span><span class="n">fhigh</span><span class="p">)</span>
        <span class="n">naive_psd_1_cropped</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">interferometer_1</span><span class="o">.</span><span class="n">psd_spectrogram</span><span class="o">.</span><span class="n">crop_frequencies</span><span class="p">(</span>
            <span class="n">flow</span><span class="p">,</span> <span class="n">fhigh</span> <span class="o">+</span> <span class="n">deltaF</span>
        <span class="p">)</span>
        <span class="n">naive_psd_2_cropped</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">interferometer_2</span><span class="o">.</span><span class="n">psd_spectrogram</span><span class="o">.</span><span class="n">crop_frequencies</span><span class="p">(</span>
            <span class="n">flow</span><span class="p">,</span> <span class="n">fhigh</span> <span class="o">+</span> <span class="n">deltaF</span>
        <span class="p">)</span>

        <span class="n">badGPStimes</span><span class="p">,</span> <span class="n">delta_sigmas</span> <span class="o">=</span> <span class="n">run_dsc</span><span class="p">(</span>
            <span class="n">delta_sigma_cut</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">duration</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sampling_frequency</span><span class="p">,</span>
            <span class="n">naive_psd_1_cropped</span><span class="p">,</span>
            <span class="n">naive_psd_2_cropped</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">interferometer_1</span><span class="o">.</span><span class="n">average_psd</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">interferometer_2</span><span class="o">.</span><span class="n">average_psd</span><span class="p">,</span>
            <span class="n">alphas</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">notch_list_path</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">badGPStimes</span> <span class="o">=</span> <span class="n">badGPStimes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">delta_sigmas</span> <span class="o">=</span> <span class="n">delta_sigmas</span></div>

<div class="viewcode-block" id="Baseline.save_data"><a class="viewcode-back" href="../../api/pygwb.baseline.Baseline.html#pygwb.baseline.Baseline.save_data">[docs]</a>    <span class="k">def</span> <span class="nf">save_data</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">save_data_type</span><span class="p">,</span>
        <span class="n">filename</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Saves the overall point estimate Y, its error bar sigma,</span>
<span class="sd">        the frequency-dependent estimates and variances and the corresponding frequencies</span>
<span class="sd">        in the required save_data_type, which can be npz, pickle, json or hdf5.</span>
<span class="sd">        You can call upon this data afterwards when loaoding in using the [&#39;key&#39;] dictionary format.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ==========</span>
<span class="sd">        save_data_type: str</span>
<span class="sd">            The required type of data file where the information will be stored</span>
<span class="sd">        filename: str</span>
<span class="sd">            the path/name of the file in which you want to save</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">save_data_type</span> <span class="o">==</span> <span class="s2">&quot;pickle&quot;</span><span class="p">:</span>
            <span class="n">save</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pickle_save</span>
            <span class="n">save_csd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pickle_save_csd</span>
            <span class="n">ext</span> <span class="o">=</span> <span class="s2">&quot;.p&quot;</span>

        <span class="k">elif</span> <span class="n">save_data_type</span> <span class="o">==</span> <span class="s2">&quot;npz&quot;</span><span class="p">:</span>
            <span class="n">save</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">npz_save</span>
            <span class="n">save_csd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">npz_save_csd</span>
            <span class="n">ext</span> <span class="o">=</span> <span class="s2">&quot;.npz&quot;</span>

        <span class="k">elif</span> <span class="n">save_data_type</span> <span class="o">==</span> <span class="s2">&quot;json&quot;</span><span class="p">:</span>
            <span class="n">save</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">json_save</span>
            <span class="n">save_csd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">json_save_csd</span>
            <span class="n">ext</span> <span class="o">=</span> <span class="s2">&quot;.json&quot;</span>

        <span class="k">elif</span> <span class="n">save_data_type</span> <span class="o">==</span> <span class="s2">&quot;hdf5&quot;</span><span class="p">:</span>
            <span class="n">save</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hdf5_save</span>
            <span class="n">save_csd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hdf5_save_csd</span>
            <span class="n">ext</span> <span class="o">=</span> <span class="s2">&quot;.h5&quot;</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;The provided data type is not supported, try using &#39;pickle&#39;, &#39;npz&#39;, &#39;json&#39; or &#39;hdf5&#39; instead.&quot;</span>
            <span class="p">)</span>

        <span class="n">save</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">filename</span><span class="si">}{</span><span class="n">ext</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">frequencies</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">point_estimate_spectrum</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sigma_spectrum</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">point_estimate</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sigma</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">point_estimate_spectrogram</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sigma_spectrogram</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">save_csd</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;psds_csds_</span><span class="si">{</span><span class="n">filename</span><span class="si">}{</span><span class="n">ext</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">frequencies</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">average_csd</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">interferometer_1</span><span class="o">.</span><span class="n">average_psd</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">interferometer_2</span><span class="o">.</span><span class="n">average_psd</span><span class="p">,</span>
        <span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">npz_save</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">filename</span><span class="p">,</span>
        <span class="n">frequencies</span><span class="p">,</span>
        <span class="n">point_estimate_spectrum</span><span class="p">,</span>
        <span class="n">sigma_spectrum</span><span class="p">,</span>
        <span class="n">point_estimate</span><span class="p">,</span>
        <span class="n">sigma</span><span class="p">,</span>
        <span class="n">point_estimate_spectrogram</span><span class="p">,</span>
        <span class="n">sigma_spectrogram</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="n">np</span><span class="o">.</span><span class="n">savez</span><span class="p">(</span>
            <span class="n">filename</span><span class="p">,</span>
            <span class="n">frequencies</span><span class="o">=</span><span class="n">frequencies</span><span class="p">,</span>
            <span class="n">point_estimate_spectrum</span><span class="o">=</span><span class="n">point_estimate_spectrum</span><span class="p">,</span>
            <span class="n">sigma_spectrum</span><span class="o">=</span><span class="n">sigma_spectrum</span><span class="p">,</span>
            <span class="n">point_estimate</span><span class="o">=</span><span class="n">point_estimate</span><span class="p">,</span>
            <span class="n">sigma</span><span class="o">=</span><span class="n">sigma</span><span class="p">,</span>
            <span class="n">point_estimate_spectrogram</span><span class="o">=</span><span class="n">point_estimate_spectrogram</span><span class="p">,</span>
            <span class="n">sigma_spectrogram</span><span class="o">=</span><span class="n">sigma_spectrogram</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">pickle_save</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">filename</span><span class="p">,</span>
        <span class="n">frequencies</span><span class="p">,</span>
        <span class="n">point_estimate_spectrum</span><span class="p">,</span>
        <span class="n">sigma_spectrum</span><span class="p">,</span>
        <span class="n">point_estimate</span><span class="p">,</span>
        <span class="n">sigma</span><span class="p">,</span>
        <span class="n">point_estimate_spectrogram</span><span class="p">,</span>
        <span class="n">sigma_spectrogram</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="n">save_dictionary</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;frequencies&quot;</span><span class="p">:</span> <span class="n">frequencies</span><span class="p">,</span>
            <span class="s2">&quot;point_estimate_spectrum&quot;</span><span class="p">:</span> <span class="n">point_estimate_spectrum</span><span class="p">,</span>
            <span class="s2">&quot;sigma_spectrum&quot;</span><span class="p">:</span> <span class="n">sigma_spectrum</span><span class="p">,</span>
            <span class="s2">&quot;point_estimate&quot;</span><span class="p">:</span> <span class="n">point_estimate</span><span class="p">,</span>
            <span class="s2">&quot;sigma&quot;</span><span class="p">:</span> <span class="n">sigma</span><span class="p">,</span>
            <span class="s2">&quot;point_estimate_spectrogram&quot;</span><span class="p">:</span> <span class="n">point_estimate_spectrogram</span><span class="p">,</span>
            <span class="s2">&quot;sigma_spectrogram&quot;</span><span class="p">:</span> <span class="n">sigma_spectrogram</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">save_dictionary</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">json_save</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">filename</span><span class="p">,</span>
        <span class="n">frequencies</span><span class="p">,</span>
        <span class="n">point_estimate_spectrum</span><span class="p">,</span>
        <span class="n">sigma_spectrum</span><span class="p">,</span>
        <span class="n">point_estimate</span><span class="p">,</span>
        <span class="n">sigma</span><span class="p">,</span>
        <span class="n">point_estimate_spectrogram</span><span class="p">,</span>
        <span class="n">sigma_spectrogram</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="n">list_freqs</span> <span class="o">=</span> <span class="n">frequencies</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">list_point_estimate_spectrum</span> <span class="o">=</span> <span class="n">point_estimate_spectrum</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">list_sigma_spectrum</span> <span class="o">=</span> <span class="n">sigma_spectrum</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

        <span class="n">list_point_estimate_segment</span> <span class="o">=</span> <span class="n">point_estimate_spectrogram</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">point_estimate_segment_times</span> <span class="o">=</span> <span class="n">point_estimate_spectrogram</span><span class="o">.</span><span class="n">times</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

        <span class="n">list_sigma_segment</span> <span class="o">=</span> <span class="n">sigma_spectrogram</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">sigma_segment_times</span> <span class="o">=</span> <span class="n">sigma_spectrogram</span><span class="o">.</span><span class="n">times</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

        <span class="n">save_dictionary</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;frequencies&quot;</span><span class="p">:</span> <span class="n">list_freqs</span><span class="p">,</span>
            <span class="s2">&quot;point_estimate_spectrum&quot;</span><span class="p">:</span> <span class="n">list_point_estimate_spectrum</span><span class="p">,</span>
            <span class="s2">&quot;sigma_spectrum&quot;</span><span class="p">:</span> <span class="n">list_sigma_spectrum</span><span class="p">,</span>
            <span class="s2">&quot;point_estimate&quot;</span><span class="p">:</span> <span class="n">point_estimate</span><span class="p">,</span>
            <span class="s2">&quot;sigma&quot;</span><span class="p">:</span> <span class="n">sigma</span><span class="p">,</span>
            <span class="s2">&quot;point_estimate_spectrogram&quot;</span><span class="p">:</span> <span class="n">list_point_estimate_segment</span><span class="p">,</span>
            <span class="s2">&quot;point_estimate_spectrogram_times&quot;</span><span class="p">:</span> <span class="n">point_estimate_segment_times</span><span class="p">,</span>
            <span class="s2">&quot;sigma_spectrogram&quot;</span><span class="p">:</span> <span class="n">list_sigma_segment</span><span class="p">,</span>
            <span class="s2">&quot;sigma_spectrogram_times&quot;</span><span class="p">:</span> <span class="n">sigma_segment_times</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">outfile</span><span class="p">:</span>
            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">save_dictionary</span><span class="p">,</span> <span class="n">outfile</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">hdf5_save</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">filename</span><span class="p">,</span>
        <span class="n">frequencies</span><span class="p">,</span>
        <span class="n">point_estimate_spectrum</span><span class="p">,</span>
        <span class="n">sigma_spectrum</span><span class="p">,</span>
        <span class="n">point_estimate</span><span class="p">,</span>
        <span class="n">sigma</span><span class="p">,</span>
        <span class="n">point_estimate_spectrogram</span><span class="p">,</span>
        <span class="n">sigma_spectrogram</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="n">hf</span> <span class="o">=</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>

        <span class="n">hf</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;freqs&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">frequencies</span><span class="p">)</span>
        <span class="n">hf</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;point_estimate_spectrum&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">point_estimate_spectrum</span><span class="p">)</span>
        <span class="n">hf</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;sigma_spectrum&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">sigma_spectrum</span><span class="p">)</span>
        <span class="n">hf</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;point_estimate&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">point_estimate</span><span class="p">)</span>
        <span class="n">hf</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;sigma&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">sigma</span><span class="p">)</span>
        <span class="n">hf</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span>
            <span class="s2">&quot;point_estimate_spectrogram&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">point_estimate_spectrogram</span>
        <span class="p">),</span>
        <span class="n">hf</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;sigma_spectrogram&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">sigma_spectrogram</span><span class="p">)</span>

        <span class="n">hf</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">npz_save_csd</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">freqs</span><span class="p">,</span> <span class="n">csd</span><span class="p">,</span> <span class="n">avg_psd_1</span><span class="p">,</span> <span class="n">avg_psd_2</span><span class="p">):</span>
        <span class="n">np</span><span class="o">.</span><span class="n">savez</span><span class="p">(</span>
            <span class="n">filename</span><span class="p">,</span> <span class="n">freqs</span><span class="o">=</span><span class="n">freqs</span><span class="p">,</span> <span class="n">csd</span><span class="o">=</span><span class="n">csd</span><span class="p">,</span> <span class="n">avg_psd_1</span><span class="o">=</span><span class="n">avg_psd_1</span><span class="p">,</span> <span class="n">avg_psd_2</span><span class="o">=</span><span class="n">avg_psd_2</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">pickle_save_csd</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">freqs</span><span class="p">,</span> <span class="n">csd</span><span class="p">,</span> <span class="n">psd_1</span><span class="p">,</span> <span class="n">psd_2</span><span class="p">):</span>

        <span class="n">save_dictionary</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;freqs&quot;</span><span class="p">:</span> <span class="n">freqs</span><span class="p">,</span>
            <span class="s2">&quot;csd&quot;</span><span class="p">:</span> <span class="n">csd</span><span class="p">,</span>
            <span class="s2">&quot;avg_psd_1&quot;</span><span class="p">:</span> <span class="n">psd_1</span><span class="p">,</span>
            <span class="s2">&quot;avg_psd_2&quot;</span><span class="p">:</span> <span class="n">psd_2</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="c1"># with open(filename, &quot;wb&quot;) as f:</span>
        <span class="c1">#   pickle.dump(saveObject, f)</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">save_dictionary</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>

<div class="viewcode-block" id="Baseline.json_save_csd"><a class="viewcode-back" href="../../api/pygwb.baseline.Baseline.html#pygwb.baseline.Baseline.json_save_csd">[docs]</a>    <span class="k">def</span> <span class="nf">json_save_csd</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">freqs</span><span class="p">,</span> <span class="n">csd</span><span class="p">,</span> <span class="n">psd_1</span><span class="p">,</span> <span class="n">psd_2</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        It seems that saving spectrograms in json does not work, hence everything is converted into a list and saved that way in the json file.</span>
<span class="sd">        A second issue is that json does not seem to recognise complex values, hence the csd is split up into a real and imaginary part.</span>
<span class="sd">        When loading in this json file, one needs to &#39;reconstruct&#39; the csd as a spectrogram using these two lists and the times and frequencies.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">list_freqs</span> <span class="o">=</span> <span class="n">freqs</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">list_csd</span> <span class="o">=</span> <span class="n">csd</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">real_csd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">list_csd</span><span class="p">))</span>
        <span class="n">imag_csd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">list_csd</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">list_csd</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">elem</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">row</span><span class="p">):</span>
                <span class="n">real_csd</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">elem</span><span class="o">.</span><span class="n">real</span>
                <span class="n">imag_csd</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">elem</span><span class="o">.</span><span class="n">imag</span>
        <span class="n">real_csd_list</span> <span class="o">=</span> <span class="n">real_csd</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">imag_csd_list</span> <span class="o">=</span> <span class="n">imag_csd</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">csd_times</span> <span class="o">=</span> <span class="n">csd</span><span class="o">.</span><span class="n">times</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">list_psd_1</span> <span class="o">=</span> <span class="n">psd_1</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">psd_times</span> <span class="o">=</span> <span class="n">psd_1</span><span class="o">.</span><span class="n">times</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">list_psd_2</span> <span class="o">=</span> <span class="n">psd_2</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">psd_2_times</span> <span class="o">=</span> <span class="n">psd_2</span><span class="o">.</span><span class="n">times</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

        <span class="n">save_dictionary</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;freqs&quot;</span><span class="p">:</span> <span class="n">list_freqs</span><span class="p">,</span>
            <span class="s2">&quot;csd_real&quot;</span><span class="p">:</span> <span class="n">real_csd_list</span><span class="p">,</span>
            <span class="s2">&quot;csd_imag&quot;</span><span class="p">:</span> <span class="n">imag_csd_list</span><span class="p">,</span>
            <span class="s2">&quot;csd_times&quot;</span><span class="p">:</span> <span class="n">csd_times</span><span class="p">,</span>
            <span class="s2">&quot;avg_psd_1&quot;</span><span class="p">:</span> <span class="n">list_psd_1</span><span class="p">,</span>
            <span class="s2">&quot;psd_1_times&quot;</span><span class="p">:</span> <span class="n">psd_times</span><span class="p">,</span>
            <span class="s2">&quot;avg_psd_2&quot;</span><span class="p">:</span> <span class="n">list_psd_2</span><span class="p">,</span>
            <span class="s2">&quot;psd_2_times&quot;</span><span class="p">:</span> <span class="n">psd_2_times</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">outfile</span><span class="p">:</span>
            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">save_dictionary</span><span class="p">,</span> <span class="n">outfile</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">hdf5_save_csd</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">freqs</span><span class="p">,</span> <span class="n">csd</span><span class="p">,</span> <span class="n">psd_1</span><span class="p">,</span> <span class="n">psd_2</span><span class="p">):</span>
        <span class="n">hf</span> <span class="o">=</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>

        <span class="n">csd_times</span> <span class="o">=</span> <span class="n">csd</span><span class="o">.</span><span class="n">times</span><span class="o">.</span><span class="n">value</span>
        <span class="n">psd_1_times</span> <span class="o">=</span> <span class="n">psd_1</span><span class="o">.</span><span class="n">times</span><span class="o">.</span><span class="n">value</span>
        <span class="n">psd_2_times</span> <span class="o">=</span> <span class="n">psd_2</span><span class="o">.</span><span class="n">times</span><span class="o">.</span><span class="n">value</span>

        <span class="n">hf</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;freqs&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">freqs</span><span class="p">)</span>

        <span class="n">csd_group</span> <span class="o">=</span> <span class="n">hf</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="s2">&quot;csd_group&quot;</span><span class="p">)</span>

        <span class="n">csd_group</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;csd&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">csd</span><span class="p">)</span>
        <span class="n">csd_group</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;csd_times&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">csd_times</span><span class="p">)</span>

        <span class="n">psd_group</span> <span class="o">=</span> <span class="n">hf</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="s2">&quot;psds_group&quot;</span><span class="p">)</span>

        <span class="n">psd_1_group</span> <span class="o">=</span> <span class="n">hf</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="s2">&quot;psds_group/psd_1&quot;</span><span class="p">)</span>
        <span class="n">psd_1_group</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;psd_1&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">psd_1</span><span class="p">)</span>
        <span class="n">psd_1_group</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;psd_1_times&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">psd_1_times</span><span class="p">)</span>

        <span class="n">psd_2_group</span> <span class="o">=</span> <span class="n">hf</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="s2">&quot;psds_group/psd_2&quot;</span><span class="p">)</span>
        <span class="n">psd_2_group</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;psd_2&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">psd_2</span><span class="p">)</span>
        <span class="n">psd_2_group</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;psd_2_times&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">psd_2_times</span><span class="p">)</span>

        <span class="n">hf</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>


<div class="viewcode-block" id="get_baselines"><a class="viewcode-back" href="../../api/pygwb.baseline.get_baselines.html#pygwb.baseline.get_baselines">[docs]</a><span class="k">def</span> <span class="nf">get_baselines</span><span class="p">(</span><span class="n">interferometers</span><span class="p">,</span> <span class="n">frequencies</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Parameters</span>
<span class="sd">    ==========</span>
<span class="sd">    interferometers: list of bilby interferometer objects</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">Nd</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">interferometers</span><span class="p">)</span>

    <span class="n">combo_tuples</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">Nd</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">j</span><span class="p">):</span>
            <span class="n">combo_tuples</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">k</span><span class="p">,</span> <span class="n">j</span><span class="p">))</span>

    <span class="n">baselines</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">combo_tuples</span><span class="p">:</span>
        <span class="n">base_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">interferometers</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">interferometers</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">baselines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="n">Baseline</span><span class="p">(</span>
                <span class="n">base_name</span><span class="p">,</span>
                <span class="n">interferometers</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                <span class="n">interferometers</span><span class="p">[</span><span class="n">j</span><span class="p">],</span>
                <span class="n">frequencies</span><span class="o">=</span><span class="n">frequencies</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>
    <span class="k">return</span> <span class="n">baselines</span></div>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Arianna Renzini, Sylvia Biscoveanu, Shivaraj Khandasamy, Kamiel Janssens, Max Lalleman, Katarina Martinovic, Andrew Matas, Patrick Meyers, Alba Romero, Colm Talbot, Leo Tsukada, Kevin Turbang.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>