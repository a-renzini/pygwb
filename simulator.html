<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Simulating data with pygwb.simulator &mdash; pygwb 1.3 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=fa44fd50" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="_static/tabs.css?v=a5c4661c" />

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="_static/jquery.js?v=5d32c60e"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js?v=0264ad83"></script>
        <script src="_static/doctools.js?v=888ff710"></script>
        <script src="_static/sphinx_highlight.js?v=4825356b"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="author" title="About these documents" href="about.html" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Demos" href="demos.html" />
    <link rel="prev" title="Parameter estimation using pygwb_pe" href="pe.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html">
            
              <img src="_static/pygwb_logo_plasma_cropped.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                1.3
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="about.html">About <code class="docutils literal notranslate"><span class="pre">pygwb</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="tutorials.html">Tutorials</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="pipeline.html">Using <code class="docutils literal notranslate"><span class="pre">pygwb_pipe</span></code>: a quickstart manual</a></li>
<li class="toctree-l2"><a class="reference internal" href="multiple_jobs.html">Running multiple <code class="docutils literal notranslate"><span class="pre">pygwb_pipe</span></code> jobs</a></li>
<li class="toctree-l2"><a class="reference internal" href="stat_checks.html">Running statistical checks with <code class="docutils literal notranslate"><span class="pre">pygwb_stats</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="workflow.html">The <code class="docutils literal notranslate"><span class="pre">pygwb</span></code> workflow</a></li>
<li class="toctree-l2"><a class="reference internal" href="pe.html">Parameter estimation using <code class="docutils literal notranslate"><span class="pre">pygwb_pe</span></code></a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Simulating data with <code class="docutils literal notranslate"><span class="pre">pygwb.simulator</span></code></a><ul>
<li class="toctree-l3"><a class="reference internal" href="#simulating-a-stochastic-gravitational-wave-background"><strong>1. Simulating a stochastic gravitational-wave background</strong></a><ul>
<li class="toctree-l4"><a class="reference internal" href="#injecting-a-power-spectrum-in-random-ligo-noise"><strong>1.1 Injecting a power spectrum in random LIGO noise</strong></a></li>
<li class="toctree-l4"><a class="reference internal" href="#injecting-a-power-spectrum-in-real-data"><strong>1.2 Injecting a power spectrum in real data</strong></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#injecting-individual-cbc-events"><strong>2. Injecting individual CBC events</strong></a><ul>
<li class="toctree-l4"><a class="reference internal" href="#initialising-empty-interferometers-and-parameters-for-simulation"><strong>2.1 Initialising empty interferometers and parameters for simulation</strong></a></li>
<li class="toctree-l4"><a class="reference internal" href="#specifying-the-cbc-population"><strong>2.2 Specifying the CBC population</strong></a></li>
<li class="toctree-l4"><a class="reference internal" href="#simulating-cbcs-and-gaussian-noise"><strong>2.3 Simulating CBCs and Gaussian noise</strong></a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="demos.html">Demos</a></li>
<li class="toctree-l1"><a class="reference internal" href="api.html">API</a></li>
<li class="toctree-l1"><a class="reference external" href="https://arxiv.org/pdf/2303.15696.pdf">pygwb paper</a></li>
<li class="toctree-l1"><a class="reference internal" href="citing.html">Citing <code class="docutils literal notranslate"><span class="pre">pygwb</span></code></a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/a-renzini/pygwb">GitHub</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributing.html">Contributing guide</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/a-renzini/pygwb/issues/new">Submit an issue</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">pygwb</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="tutorials.html">Tutorials</a></li>
      <li class="breadcrumb-item active">Simulating data with <code class="docutils literal notranslate"><span class="pre">pygwb.simulator</span></code></li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/simulator.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="simulating-data-with-pygwb-simulator">
<h1>Simulating data with <code class="docutils literal notranslate"><span class="pre">pygwb.simulator</span></code><a class="headerlink" href="#simulating-data-with-pygwb-simulator" title="Permalink to this heading"></a></h1>
<p>In this tutorial, we show how the <code class="docutils literal notranslate"><span class="pre">pygwb.simulator</span></code> module can be used to simulate a gravitational-wave background. We consider both the case
where a power-law spectrum is injected, and where individual compact binary coalescences (CBCs) are injected. For more information about the module, we refer
the reader to the <code class="docutils literal notranslate"><span class="pre">pygwb.simulator</span></code> <a class="reference external" href="api/pygwb.simulator.html">documentation page</a>.</p>
<section id="simulating-a-stochastic-gravitational-wave-background">
<h2><strong>1. Simulating a stochastic gravitational-wave background</strong><a class="headerlink" href="#simulating-a-stochastic-gravitational-wave-background" title="Permalink to this heading"></a></h2>
<section id="injecting-a-power-spectrum-in-random-ligo-noise">
<h3><strong>1.1 Injecting a power spectrum in random LIGO noise</strong><a class="headerlink" href="#injecting-a-power-spectrum-in-random-ligo-noise" title="Permalink to this heading"></a></h3>
<p>For concreteness, we consider a broken power-law signal power spectral density (PSD) to be injected in random LIGO Gaussian noise.
The <code class="docutils literal notranslate"><span class="pre">simulator</span></code> module takes a <code class="docutils literal notranslate"><span class="pre">gwpy.FrequencySeries</span></code> as input for the signal PSD to be injected.
We start by building a custom input signal by defining an <code class="docutils literal notranslate"><span class="pre">IntensityGW</span></code> function, which outputs the
desired signal PSD in the form of a <code class="docutils literal notranslate"><span class="pre">gwpy.FrequencySeries</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">frequencies_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="mi">10000</span><span class="p">)</span>

<span class="n">alpha1</span> <span class="o">=</span> <span class="mi">6</span>
<span class="n">alpha2</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">fref</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">omegaRef</span> <span class="o">=</span> <span class="mf">5.e-5</span>

<span class="k">def</span> <span class="nf">IntensityGW</span><span class="p">(</span><span class="n">freqs</span><span class="p">,</span> <span class="n">omegaRef</span><span class="p">,</span> <span class="n">alpha1</span><span class="p">,</span> <span class="n">fref</span><span class="p">,</span> <span class="n">alpha2</span> <span class="o">=</span> <span class="mi">2</span><span class="o">/</span><span class="mi">3</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39; GW Intensity function from broken power law in OmegaGW</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    freqs: np.array</span>
<span class="sd">        frequency array</span>
<span class="sd">    fref:</span>
<span class="sd">        reference frequency</span>
<span class="sd">    omegaRef:</span>
<span class="sd">        Value of OmegaGW at reference frequency</span>
<span class="sd">    alpha1:</span>
<span class="sd">        first spectral index</span>
<span class="sd">    alpha2:</span>
<span class="sd">        second spectral index</span>

<span class="sd">    Return</span>
<span class="sd">    ------</span>
<span class="sd">    FrequencySeries</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="kn">from</span> <span class="nn">pygwb.constants</span> <span class="kn">import</span> <span class="n">H0</span>
    <span class="n">H_theor</span> <span class="o">=</span> <span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">H0</span><span class="o">.</span><span class="n">si</span><span class="o">.</span><span class="n">value</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">10</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>

    <span class="n">fknee</span> <span class="o">=</span> <span class="n">fref</span>

    <span class="n">power</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">freqs</span><span class="p">)</span>

    <span class="n">power</span><span class="p">[</span><span class="n">freqs</span><span class="o">&lt;</span><span class="n">fknee</span><span class="p">]</span> <span class="o">=</span> <span class="n">H_theor</span> <span class="o">*</span> <span class="n">omegaRef</span> <span class="o">*</span> <span class="p">(</span><span class="n">freqs</span><span class="p">[</span><span class="n">freqs</span><span class="o">&lt;</span><span class="n">fknee</span><span class="p">])</span> <span class="o">**</span> <span class="p">(</span><span class="n">alpha1</span> <span class="o">-</span><span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="n">fref</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">alpha1</span><span class="p">)</span>
    <span class="n">power</span><span class="p">[</span><span class="n">freqs</span><span class="o">&gt;</span><span class="n">fknee</span><span class="p">]</span> <span class="o">=</span> <span class="n">H_theor</span> <span class="o">*</span> <span class="n">omegaRef</span> <span class="o">*</span> <span class="p">(</span><span class="n">freqs</span><span class="p">[</span><span class="n">freqs</span><span class="o">&gt;</span><span class="n">fknee</span><span class="p">])</span> <span class="o">**</span> <span class="p">(</span><span class="n">alpha2</span> <span class="o">-</span> <span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="n">fref</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">alpha2</span><span class="p">)</span>
    <span class="n">power</span><span class="p">[</span><span class="n">freqs</span><span class="o">==</span><span class="n">fknee</span><span class="p">]</span> <span class="o">=</span> <span class="n">H_theor</span> <span class="o">*</span> <span class="n">omegaRef</span> <span class="o">*</span> <span class="p">(</span><span class="n">fknee</span><span class="p">)</span> <span class="o">**</span> <span class="p">(</span><span class="n">alpha2</span> <span class="o">-</span><span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="n">fref</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">alpha2</span><span class="p">)</span>

    <span class="n">power</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">power</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">gwpy</span><span class="o">.</span><span class="n">frequencyseries</span><span class="o">.</span><span class="n">FrequencySeries</span><span class="p">(</span><span class="n">power</span><span class="p">,</span> <span class="n">frequencies</span><span class="o">=</span><span class="n">freqs</span><span class="p">)</span>

<span class="n">Intensity_GW_inject</span> <span class="o">=</span> <span class="n">IntensityGW</span><span class="p">(</span><span class="n">frequencies_x</span><span class="p">,</span> <span class="n">omegaRef</span> <span class="o">=</span> <span class="n">omegaRef</span><span class="p">,</span> <span class="n">alpha1</span> <span class="o">=</span> <span class="n">alpha1</span><span class="p">,</span> <span class="n">fref</span> <span class="o">=</span> <span class="n">fref</span><span class="p">)</span>
</pre></div>
</div>
<p>Note that the above signal PSD was chosen for illustrative purposes. However, in practice, any
signal PSD can be chosen to be injected, and one does not need to restrict themselves to a broken power-law.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p>More information about <code class="docutils literal notranslate"><span class="pre">gwpy.frequencyseries.FrequencySeries</span></code> can be found <a class="reference external" href="https://gwpy.github.io/docs/stable/api/gwpy.frequencyseries.FrequencySeries/">here</a>.</p>
</div>
<p>One also needs to specify the parameters that will serve as input to the <code class="docutils literal notranslate"><span class="pre">simulator</span></code>. Concretely, we specify
the duration of each simulated segment, the number of segments, and the sampling frequency.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">duration</span> <span class="o">=</span> <span class="mi">60</span> <span class="c1"># duration of each segment of data (s)</span>
<span class="n">N_segs</span> <span class="o">=</span> <span class="mi">10</span>  <span class="c1"># number of data segments to generate</span>
<span class="n">sampling_frequency</span> <span class="o">=</span> <span class="mi">1024</span> <span class="c1"># Hz</span>
</pre></div>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Not sure about what the above parameters do? Make sure to check out the <a class="reference external" href="api/pygwb.simulator.html">documentation</a> of the <code class="docutils literal notranslate"><span class="pre">simulator</span></code> module.</p>
</div>
<p>The detectors for which data with the above signal PSD need to be simulated, have to be passed
to the <code class="docutils literal notranslate"><span class="pre">simulator</span></code> module. By relying on the <code class="docutils literal notranslate"><span class="pre">detector</span></code> module, we instantiate various detectors below.
In addition, we note that these detectors are <code class="docutils literal notranslate"><span class="pre">Interferometer</span></code> objects, but are based on <code class="docutils literal notranslate"><span class="pre">bilby</span></code> detectors,
which have default noise PSDs saved in them, in the <code class="docutils literal notranslate"><span class="pre">power_spectral_density</span></code> attribute of the <code class="docutils literal notranslate"><span class="pre">bilby</span></code> detector.
Below, we load in this noise PSD and make sure the duration and sampling frequency of the detector are set to the desired value of
these parameters.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">H1</span> <span class="o">=</span> <span class="n">Interferometer</span><span class="o">.</span><span class="n">get_empty_interferometer</span><span class="p">(</span><span class="s2">&quot;H1&quot;</span><span class="p">)</span> <span class="c1">#LIGO Hanford detector</span>
<span class="n">L1</span> <span class="o">=</span> <span class="n">Interferometer</span><span class="o">.</span><span class="n">get_empty_interferometer</span><span class="p">(</span><span class="s2">&quot;L1&quot;</span><span class="p">)</span> <span class="c1">#LIGO Livingston detector</span>

<span class="n">ifo_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">H1</span><span class="p">,</span> <span class="n">L1</span><span class="p">]</span>

<span class="k">for</span> <span class="n">ifo</span> <span class="ow">in</span> <span class="n">ifo_list</span><span class="p">:</span>
    <span class="n">ifo</span><span class="o">.</span><span class="n">duration</span> <span class="o">=</span> <span class="n">duration</span>
    <span class="n">ifo</span><span class="o">.</span><span class="n">sampling_frequency</span> <span class="o">=</span> <span class="n">sampling_frequency</span>
    <span class="n">ifo</span><span class="o">.</span><span class="n">power_spectral_density</span> <span class="o">=</span> <span class="n">bilby</span><span class="o">.</span><span class="n">gw</span><span class="o">.</span><span class="n">detector</span><span class="o">.</span><span class="n">PowerSpectralDensity</span><span class="p">(</span><span class="n">ifo</span><span class="o">.</span><span class="n">frequency_array</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span><span class="n">ifo</span><span class="o">.</span><span class="n">power_spectral_density_array</span><span class="p">,</span> <span class="n">posinf</span><span class="o">=</span><span class="mf">1.e-41</span><span class="p">))</span>

 <span class="n">net_HL</span> <span class="o">=</span> <span class="n">Network</span><span class="p">(</span><span class="s1">&#39;HL&#39;</span><span class="p">,</span> <span class="n">ifo_list</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p>Additional information about the <code class="docutils literal notranslate"><span class="pre">Interferometer</span></code> object can be found <a class="reference external" href="api/pygwb.detector.Interferometer.html">here</a>. For more information, we also refer the user to the <code class="docutils literal notranslate"><span class="pre">bilby</span></code>
<a class="reference external" href="https://lscsoft.docs.ligo.org/bilby/api/bilby.gw.detector.html">documentation</a>.</p>
</div>
<p>We are now ready to simulate the data, consisting of a signal and Gaussian noise, colored by the noise PSD saved in each of the detectors.
We rely on the <code class="docutils literal notranslate"><span class="pre">network</span></code> module to simulate the data by calling the <code class="docutils literal notranslate"><span class="pre">set_interferometer_data_from_simulator()</span></code> method (which uses the <code class="docutils literal notranslate"><span class="pre">simulator</span></code> module).
More information on the method can be found <a class="reference external" href="api/pygwb.network.Network.html#pygwb.network.Network.set_interferometer_data_from_simulator">here</a>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">net_HL</span><span class="o">.</span><span class="n">set_interferometer_data_from_simulator</span><span class="p">(</span><span class="n">N_segments</span><span class="o">=</span><span class="n">N_segs</span><span class="p">,</span> <span class="n">GWB_intensity</span><span class="o">=</span><span class="n">Intensity_GW_inject</span><span class="p">,</span> <span class="n">sampling_frequency</span><span class="o">=</span><span class="n">sampling_frequency</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>One may save the data by calling <code class="docutils literal notranslate"><span class="pre">pygwb.network.save_interferometer_data_to_file()</span></code> (see <a class="reference external" href="api/pygwb.network.Network.html#pygwb.network.Network.save_interferometer_data_to_file">here</a>)
and specifying the file format as an argument. This wraps the <code class="docutils literal notranslate"><span class="pre">gwpy.TimeSeries.write()</span></code> method (more details can be found
<a class="reference external" href="https://gwpy.github.io/docs/stable/api/gwpy.timeseries.TimeSeries/#gwpy.timeseries.TimeSeries.write">here</a>).</p>
</div>
</section>
<section id="injecting-a-power-spectrum-in-real-data">
<h3><strong>1.2 Injecting a power spectrum in real data</strong><a class="headerlink" href="#injecting-a-power-spectrum-in-real-data" title="Permalink to this heading"></a></h3>
<p>Alternatively, one could decide to inject a SGWB in real detector data. To illustrate this functionality, we inject the same signal as above
in real LIGO data. The detectors are instantiated through the <code class="docutils literal notranslate"><span class="pre">parameters</span></code> module, which allows to load the parameters, including the GPS
times used to retrieve real data.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">params</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">()</span>
<span class="n">params</span><span class="o">.</span><span class="n">update_from_file</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="s2">&quot;../test/test_data/parameters_baseline_test.ini&quot;</span><span class="p">)</span>
<span class="n">params</span><span class="o">.</span><span class="n">t0</span><span class="o">=</span><span class="mi">1247644204</span>
<span class="n">params</span><span class="o">.</span><span class="n">tf</span><span class="o">=</span><span class="mi">1247645100</span>
<span class="n">params</span><span class="o">.</span><span class="n">segment_duration</span><span class="o">=</span><span class="mi">128</span>
</pre></div>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Not sure how the <code class="docutils literal notranslate"><span class="pre">parameters</span></code> module works anymore? Make sure to check out the <a class="reference external" href="api/pygwb.parameters.html">documentation</a>.</p>
</div>
<p>We now create the two <code class="docutils literal notranslate"><span class="pre">Interferometer</span></code> objects that will be used for the data simulation (LIGO Hanford (H1) and LIGO Livingstn (L1) for this concrete example).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">H1</span> <span class="o">=</span> <span class="n">Interferometer</span><span class="o">.</span><span class="n">from_parameters</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">interferometer_list</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">params</span><span class="p">)</span>
<span class="n">L1</span> <span class="o">=</span> <span class="n">Interferometer</span><span class="o">.</span><span class="n">from_parameters</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">interferometer_list</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">params</span><span class="p">)</span>

<span class="n">ifo_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">H1</span><span class="p">,</span> <span class="n">L1</span><span class="p">]</span>
</pre></div>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p>Additional informational information about the <code class="docutils literal notranslate"><span class="pre">Interferometer</span></code> object can be found <a class="reference external" href="api/pygwb.detector.Interferometer.html">here</a>.</p>
</div>
<p>Note that the interferometers above contain the desired data in which we want to inject the signal. We now make sure the
duration and sampling frequency of the detector are set to the desired value of these parameters, as specified in the parameters
object defined at the start of this example.  The strain data in the interferometer is also set to the real data considered in this example.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">ifo</span> <span class="ow">in</span> <span class="n">ifo_list</span><span class="p">:</span>
    <span class="n">ifo</span><span class="o">.</span><span class="n">sampling_frequency</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">new_sample_rate</span>
    <span class="n">ifo</span><span class="o">.</span><span class="n">set_strain_data_from_gwpy_timeseries</span><span class="p">(</span><span class="n">gwpy</span><span class="o">.</span><span class="n">timeseries</span><span class="o">.</span><span class="n">TimeSeries</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">ifo</span><span class="o">.</span><span class="n">timeseries</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">times</span><span class="o">=</span><span class="n">ifo</span><span class="o">.</span><span class="n">timeseries</span><span class="o">.</span><span class="n">times</span><span class="p">))</span>
    <span class="n">ifo</span><span class="o">.</span><span class="n">duration</span><span class="o">=</span><span class="n">params</span><span class="o">.</span><span class="n">segment_duration</span>
</pre></div>
</div>
<p>To inject a signal in real data, we rely on the <code class="docutils literal notranslate"><span class="pre">network</span></code> module, for which an object is instantiated below. To simulate the data, one calls
<code class="docutils literal notranslate"><span class="pre">set_interferometer_data_from_simulator()</span></code> method (which uses the <code class="docutils literal notranslate"><span class="pre">simulator</span></code> module). More information on the method can be found
<a class="reference external" href="api/pygwb.network.Network.html#pygwb.network.Network.set_interferometer_data_from_simulator">here</a>. Note that the <code class="docutils literal notranslate"><span class="pre">inject_into_data_flag</span></code> is
set to <code class="docutils literal notranslate"><span class="pre">True</span></code>, indicating the data will be injected in real data, and that additional Gaussian colored noise therefore does not need to be simulated, nor injected on top of the signal.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">HL_baseline</span> <span class="o">=</span> <span class="n">Baseline</span><span class="o">.</span><span class="n">from_parameters</span><span class="p">(</span><span class="n">H1</span><span class="p">,</span> <span class="n">L1</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
<span class="n">net_HL</span> <span class="o">=</span> <span class="n">Network</span><span class="o">.</span><span class="n">from_baselines</span><span class="p">(</span><span class="s2">&quot;HL_network&quot;</span><span class="p">,</span> <span class="p">[</span><span class="n">HL_baseline</span><span class="p">])</span>

<span class="n">net_HL</span><span class="o">.</span><span class="n">set_interferometer_data_from_simulator</span><span class="p">(</span><span class="n">N_segments</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span> <span class="n">GWB_intensity</span><span class="o">=</span><span class="n">Intensity_GW_inject</span><span class="p">,</span> <span class="n">sampling_frequency</span><span class="o">=</span><span class="n">H1</span><span class="o">.</span><span class="n">sampling_frequency</span><span class="p">,</span> <span class="n">inject_into_data_flag</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>One may save the data by calling <code class="docutils literal notranslate"><span class="pre">pygwb.network.save_interferometer_data_to_file()</span></code> (see <a class="reference external" href="api/pygwb.network.Network.html#pygwb.network.Network.save_interferometer_data_to_file">here</a>)
and specifying the file format as an argument. This wraps the <code class="docutils literal notranslate"><span class="pre">gwpy.TimeSeries.write()</span></code> method (more details can be found
<a class="reference external" href="https://gwpy.github.io/docs/stable/api/gwpy.timeseries.TimeSeries/#gwpy.timeseries.TimeSeries.write">here</a>).</p>
</div>
</section>
</section>
<section id="injecting-individual-cbc-events">
<h2><strong>2. Injecting individual CBC events</strong><a class="headerlink" href="#injecting-individual-cbc-events" title="Permalink to this heading"></a></h2>
<section id="initialising-empty-interferometers-and-parameters-for-simulation">
<h3><strong>2.1 Initialising empty interferometers and parameters for simulation</strong><a class="headerlink" href="#initialising-empty-interferometers-and-parameters-for-simulation" title="Permalink to this heading"></a></h3>
<p>We start by specifying the parameters that will serve as input to the <code class="docutils literal notranslate"><span class="pre">simulator</span></code>.
Concretely, we specify the duration of each simulated segment, the number of segments, and the sampling frequency.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">duration</span> <span class="o">=</span> <span class="mi">64</span> <span class="c1"># duration of each segment of data (s)</span>
<span class="n">N_segs</span> <span class="o">=</span> <span class="mi">5</span>  <span class="c1"># number of data segments to generate</span>
<span class="n">sampling_frequency</span> <span class="o">=</span> <span class="mi">1024</span> <span class="c1"># Hz</span>
</pre></div>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Not sure about what the above parameters do? Make sure to check out the <a class="reference external" href="api/pygwb.simulator.html">documentation</a> of the <code class="docutils literal notranslate"><span class="pre">simulator</span></code> module.</p>
</div>
<p>The detectors for which data need to be simulated, have to be passed to the simulator module.
By relying on the detector module, we instantiate various detectors below. We decide to use H1 and L1
as an example. However, note that the data can be simulated for an arbitrary amount of detectors. One would simply add more
detectors to the <code class="docutils literal notranslate"><span class="pre">ifo_list</span></code> below.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">ifo_H1</span> <span class="o">=</span> <span class="n">Interferometer</span><span class="o">.</span><span class="n">get_empty_interferometer</span><span class="p">(</span><span class="s1">&#39;H1&#39;</span><span class="p">)</span>
<span class="n">ifo_L1</span> <span class="o">=</span> <span class="n">Interferometer</span><span class="o">.</span><span class="n">get_empty_interferometer</span><span class="p">(</span><span class="s1">&#39;L1&#39;</span><span class="p">)</span>

<span class="n">ifo_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">ifo_H1</span><span class="p">,</span> <span class="n">ifo_L1</span><span class="p">]</span>
</pre></div>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p>Additional informational information about the <code class="docutils literal notranslate"><span class="pre">Interferometer</span></code> object can be found <a class="reference external" href="api/pygwb.detector.Interferometer.html">here</a>. For more information, we also refer the reader to the <code class="docutils literal notranslate"><span class="pre">bilby</span></code>
<a class="reference external" href="https://lscsoft.docs.ligo.org/bilby/api/bilby.gw.detector.html">documentation</a>.</p>
</div>
<p>The above detectors are <code class="docutils literal notranslate"><span class="pre">Interferometer</span></code> objects, but are based on <code class="docutils literal notranslate"><span class="pre">bilby</span></code> detectors, which have default noise PSDs saved in
them, in the <code class="docutils literal notranslate"><span class="pre">power_spectral_density</span></code> attribute of the <code class="docutils literal notranslate"><span class="pre">bilby</span></code> detector. Below, we load in this noise PSD and make sure the
duration and sampling frequency of the detector are set to the desired value of these parameters.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">ifo</span> <span class="ow">in</span> <span class="n">ifo_list</span><span class="p">:</span>
    <span class="n">ifo</span><span class="o">.</span><span class="n">duration</span> <span class="o">=</span> <span class="n">duration</span>
    <span class="n">ifo</span><span class="o">.</span><span class="n">sampling_frequency</span> <span class="o">=</span> <span class="n">sampling_frequency</span>
    <span class="n">ifo</span><span class="o">.</span><span class="n">power_spectral_density</span> <span class="o">=</span> <span class="n">bilby</span><span class="o">.</span><span class="n">gw</span><span class="o">.</span><span class="n">detector</span><span class="o">.</span><span class="n">PowerSpectralDensity</span><span class="p">(</span><span class="n">ifo</span><span class="o">.</span><span class="n">frequency_array</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span><span class="n">ifo</span><span class="o">.</span><span class="n">power_spectral_density_array</span><span class="p">,</span> <span class="n">posinf</span><span class="o">=</span><span class="mf">1.e-41</span><span class="p">))</span>
<span class="n">net_HL</span> <span class="o">=</span> <span class="n">Network</span><span class="p">(</span><span class="s1">&#39;HL&#39;</span><span class="p">,</span> <span class="n">ifo_list</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="specifying-the-cbc-population">
<h3><strong>2.2 Specifying the CBC population</strong><a class="headerlink" href="#specifying-the-cbc-population" title="Permalink to this heading"></a></h3>
<p>Before being able to simulate CBCs, we need to specify which population the CBC events are drawn from. This is done by using <code class="docutils literal notranslate"><span class="pre">bilby</span></code> priors.
This allows the user to specify the distributions of the various parameters that come into play in CBC waveforms. A few examples are given below.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">priors</span> <span class="o">=</span> <span class="n">bilby</span><span class="o">.</span><span class="n">gw</span><span class="o">.</span><span class="n">prior</span><span class="o">.</span><span class="n">BBHPriorDict</span><span class="p">(</span><span class="n">aligned_spin</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">priors</span><span class="p">[</span><span class="s1">&#39;chirp_mass&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bilby</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">prior</span><span class="o">.</span><span class="n">Uniform</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;chirp_mass&quot;</span><span class="p">)</span>
<span class="n">priors</span><span class="p">[</span><span class="s1">&#39;mass_ratio&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="n">priors</span><span class="p">[</span><span class="s1">&#39;chi_1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">priors</span><span class="p">[</span><span class="s1">&#39;chi_2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">priors</span><span class="p">[</span><span class="s1">&#39;luminosity_distance&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bilby</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">prior</span><span class="o">.</span><span class="n">PowerLaw</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;luminosity_distance&#39;</span><span class="p">,</span>
                                                      <span class="n">minimum</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">maximum</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
                                                      <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;Mpc&#39;</span><span class="p">)</span>
<span class="n">priors</span><span class="p">[</span><span class="s2">&quot;geocent_time&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bilby</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">prior</span><span class="o">.</span><span class="n">Uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">duration</span><span class="o">*</span><span class="n">N_segs</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;geocent_time&quot;</span><span class="p">)</span>

<span class="c1"># create 20 injections</span>
<span class="n">injections</span> <span class="o">=</span> <span class="n">priors</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p>For additional information on <code class="docutils literal notranslate"><span class="pre">bilby</span></code> prior dictionaries, we refer the user to the <a class="reference external" href="https://lscsoft.docs.ligo.org/bilby/api/bilby.gw.prior.BBHPriorDict.html">documentation</a>.</p>
</div>
<p>The output of the cell above is a dictionary containing the injections, which will serve as input for the <code class="docutils literal notranslate"><span class="pre">simulator</span></code>.
It can be very useful to save these injections to file for later use. This is done by executing the following lines of code:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">json</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;injections.json&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
    <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span>
        <span class="n">injections</span><span class="p">,</span> <span class="n">file</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="n">bilby</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">result</span><span class="o">.</span><span class="n">BilbyJsonEncoder</span>
    <span class="p">)</span>
</pre></div>
</div>
</section>
<section id="simulating-cbcs-and-gaussian-noise">
<h3><strong>2.3 Simulating CBCs and Gaussian noise</strong><a class="headerlink" href="#simulating-cbcs-and-gaussian-noise" title="Permalink to this heading"></a></h3>
<p>We are now ready to simulate the data, consisting of CBCs and Gaussian noise, colored by the noise PSD saved in each of the detectors.
We rely on the <code class="docutils literal notranslate"><span class="pre">pygwb.network</span></code> module to simulate the data by calling the <code class="docutils literal notranslate"><span class="pre">set_interferometer_data_from_simulator()</span></code> method (which uses the <code class="docutils literal notranslate"><span class="pre">pygwb.simulator</span></code> module).
More information on the method can be found <a class="reference external" href="api/pygwb.network.Network.html#pygwb.network.Network.set_interferometer_data_from_simulator">here</a>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">net_HL</span><span class="o">.</span><span class="n">set_interferometer_data_from_simulator</span><span class="p">(</span><span class="n">N_segs</span><span class="p">,</span> <span class="n">CBC_dict</span><span class="o">=</span><span class="n">injections</span><span class="p">,</span> <span class="n">sampling_frequency</span> <span class="o">=</span> <span class="n">sampling_frequency</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>One may save the data by calling <code class="docutils literal notranslate"><span class="pre">pygwb.network.save_interferometer_data_to_file()</span></code> (see <a class="reference external" href="api/pygwb.network.Network.html#pygwb.network.Network.save_interferometer_data_to_file">here</a>)
and specifying the file format as an argument. This wraps the <code class="docutils literal notranslate"><span class="pre">gwpy.TimeSeries.write()</span></code> method (more details can be found
<a class="reference external" href="https://gwpy.github.io/docs/stable/api/gwpy.timeseries.TimeSeries/#gwpy.timeseries.TimeSeries.write">here</a>).</p>
</div>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="pe.html" class="btn btn-neutral float-left" title="Parameter estimation using pygwb_pe" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="demos.html" class="btn btn-neutral float-right" title="Demos" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Arianna Renzini, Sylvia Biscoveanu, Shivaraj Khandasamy, Kamiel Janssens, Max Lalleman, Katarina Martinovic, Andrew Matas, Patrick Meyers, Alba Romero, Colm Talbot, Leo Tsukada, Kevin Turbang.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>